# ğŸ¯ Planning Agent System - Complete Visual Architecture

## ğŸ—ï¸ **High-Level System Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ğŸŒ± SASYA CHIKITSA PLANNING AGENT                      â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ğŸ“± MOBILE     â”‚    â”‚   ğŸŒ WEB APP    â”‚    â”‚   ğŸ”Œ API CLIENTS           â”‚ â”‚
â”‚  â”‚   ANDROID APP   â”‚    â”‚   INTERFACE     â”‚    â”‚   THIRD PARTY               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                       â”‚                            â”‚               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                   â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸš€ FASTAPI APPLICATION LAYER                                â”‚
â”‚                                   â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        ğŸ“¡ API ENDPOINTS                                    â”‚ â”‚
â”‚  â”‚  /planning/chat          /planning/chat-stream     /planning/session/{}   â”‚ â”‚
â”‚  â”‚  /planning/migrate       /planning/restart         /planning/actions      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ¯ PLANNING AGENT CORE SYSTEM                              â”‚
â”‚                                   â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    ğŸ­ PLANNING AGENT ORCHESTRATOR                         â”‚ â”‚
â”‚  â”‚                                                                           â”‚ â”‚
â”‚  â”‚  â€¢ Request Analysis & Intent Recognition                                   â”‚ â”‚
â”‚  â”‚  â€¢ Component Selection & Execution                                        â”‚ â”‚
â”‚  â”‚  â€¢ State Management & Flow Control                                        â”‚ â”‚
â”‚  â”‚  â€¢ Response Generation & User Guidance                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â”‚                                 â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    ğŸ“Š SESSION MANAGER     â”‚    â”‚        ğŸ”€ WORKFLOW CONTROLLER        â”‚ â”‚
â”‚  â”‚                           â”‚    â”‚                                      â”‚ â”‚
â”‚  â”‚  â€¢ State Persistence      â”‚    â”‚  â€¢ Dynamic State Transitions         â”‚ â”‚
â”‚  â”‚  â€¢ Activity Logging       â”‚    â”‚  â€¢ Branching Logic Management        â”‚ â”‚
â”‚  â”‚  â€¢ History Management     â”‚    â”‚  â€¢ Next Step Determination          â”‚ â”‚
â”‚  â”‚  â€¢ Context Storage        â”‚    â”‚  â€¢ Available Actions Generation     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â”‚                                 â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    ğŸ§© COMPONENT EXECUTION LAYER                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   â”‚       ğŸ® COMPONENT HANDLERS      â”‚                       â”‚
â”‚                   â”‚                                 â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“‹ Intent Capture â”‚  â”‚ ğŸ’¬ LLM   â”‚   â”‚ ğŸ”¬ Class â”‚  â”‚ ğŸ’Š Prescription     â”‚ â”‚
â”‚  â”‚ â€¢ Image Process   â”‚  â”‚ Clarify  â”‚  â”‚ ificationâ”‚  â”‚ â€¢ RAG Treatment     â”‚ â”‚
â”‚  â”‚ â€¢ Intent Analysis â”‚  â”‚ â€¢ Smart  â”‚  â”‚ â€¢ CNN    â”‚  â”‚ â€¢ Personalized     â”‚ â”‚
â”‚  â”‚ â€¢ Context Extract â”‚  â”‚ Questionsâ”‚  â”‚ Attentionâ”‚  â”‚ â€¢ Multi-option    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âš™ï¸ Constraint       â”‚  â”‚ ğŸª Vendor    â”‚  â”‚ ğŸ”„ Iterative Follow-up     â”‚ â”‚
â”‚  â”‚ Gathering           â”‚  â”‚ Recommend    â”‚  â”‚ â€¢ Corrections & Feedback    â”‚ â”‚
â”‚  â”‚ â€¢ User Preferences  â”‚  â”‚ â€¢ Local      â”‚  â”‚ â€¢ Alternative Options      â”‚ â”‚
â”‚  â”‚ â€¢ Budget & Organic  â”‚  â”‚   Suppliers  â”‚  â”‚ â€¢ Recursive Improvements   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ› ï¸ EXTERNAL INTEGRATIONS                                   â”‚
â”‚                                   â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ§  CNN      â”‚  â”‚ ğŸ¤– OLLAMA   â”‚ â”‚ ğŸ“š RAG    â”‚  â”‚ ğŸ—„ï¸ KNOWLEDGE BASE      â”‚ â”‚
â”‚  â”‚ Classifier  â”‚  â”‚ LLM         â”‚ â”‚ System    â”‚  â”‚ â€¢ Treatment Guidelines  â”‚ â”‚
â”‚  â”‚ â€¢ Disease   â”‚  â”‚ â€¢ Smart     â”‚ â”‚ â€¢ Context â”‚  â”‚ â€¢ Disease Database      â”‚ â”‚
â”‚  â”‚   Detection â”‚  â”‚   Questions â”‚ â”‚ â€¢ Treatmentâ”‚ â”‚ â€¢ Regional Information  â”‚ â”‚
â”‚  â”‚ â€¢ Attention â”‚  â”‚ â€¢ Reasoning â”‚ â”‚ â€¢ Retrievalâ”‚ â”‚ â€¢ Vendor Database       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ **Dynamic Workflow State Machine**

```
                          ğŸŒ± USER JOURNEY WORKFLOW

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                 â”‚
â”‚    ğŸ‘¤ USER STARTS                                                              â”‚
â”‚         â”‚                                                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                                                                 â”‚
â”‚    â”‚ INITIAL â”‚ â”€â”€â”€â”€ New Session Created                                        â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                                 â”‚
â”‚         â”‚                                                                       â”‚
â”‚         â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     ğŸ“¸ Image + Intent                                     â”‚
â”‚  â”‚ INTENT_CAPTURE  â”‚ â—„â”€â”€ User uploads leaf image                               â”‚
â”‚  â”‚                 â”‚ â—„â”€â”€ "What's wrong with my plant?"                        â”‚
â”‚  â”‚ ğŸ“‹ Process:     â”‚                                                           â”‚
â”‚  â”‚ â€¢ Analyze image â”‚     âœ… Clear Intent & Complete Info                       â”‚
â”‚  â”‚ â€¢ Extract intentâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚ â€¢ Parse context â”‚                         â”‚                                â”‚
â”‚  â”‚ â€¢ Identify gaps â”‚     â“ Missing Info     â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                                â”‚
â”‚            â”‚                         â”‚       â”‚                                â”‚
â”‚            â–¼                         â–¼       â–¼                                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚    â”‚ CLARIFICATION   â”‚        â”‚ CLASSIFICATION  â”‚                             â”‚
â”‚    â”‚                 â”‚        â”‚                 â”‚                             â”‚
â”‚    â”‚ ğŸ’¬ LLM Asks:    â”‚        â”‚ ğŸ”¬ Process:     â”‚                             â”‚
â”‚    â”‚ â€¢ "Crop type?"  â”‚        â”‚ â€¢ CNN Analysis  â”‚                             â”‚
â”‚    â”‚ â€¢ "Location?"   â”‚        â”‚ â€¢ Attention Map â”‚                             â”‚
â”‚    â”‚ â€¢ "Season?"     â”‚        â”‚ â€¢ Confidence    â”‚                             â”‚
â”‚    â”‚ â€¢ "Symptoms?"   â”‚        â”‚ â€¢ Validation    â”‚                             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚              â”‚                          â”‚                                     â”‚
â”‚              â–¼                          â–¼                                     â”‚
â”‚      â“ Still Missing? â”€â”€â”€â”€Noâ”€â”€â”€â–º ğŸ”¬ Classification Ready                     â”‚
â”‚              â”‚                          â”‚                                     â”‚
â”‚              Yes                        â–¼                                     â”‚
â”‚              â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚                  â”‚ PRESCRIPTION    â”‚                          â”‚
â”‚              â”‚                  â”‚                 â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ ğŸ’Š Generate:   â”‚                          â”‚
â”‚                                 â”‚ â€¢ RAG Query     â”‚                          â”‚
â”‚                                 â”‚ â€¢ Treatment     â”‚                          â”‚
â”‚                                 â”‚ â€¢ Personalize   â”‚                          â”‚
â”‚                                 â”‚ â€¢ Multi-option  â”‚                          â”‚
â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                           â”‚                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                    â”‚                      â”‚                      â”‚            â”‚
â”‚                    â–¼                      â–¼                      â–¼            â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚         â”‚CONSTRAINT_      â”‚    â”‚VENDOR_          â”‚    â”‚FOLLOW_UP        â”‚    â”‚
â”‚         â”‚GATHERING        â”‚    â”‚RECOMMENDATION   â”‚    â”‚                 â”‚    â”‚
â”‚         â”‚                 â”‚    â”‚                 â”‚    â”‚ ğŸ”„ Handle:      â”‚    â”‚
â”‚         â”‚ âš™ï¸ Collect:     â”‚    â”‚ ğŸª Suggest:     â”‚    â”‚ â€¢ Corrections   â”‚    â”‚
â”‚         â”‚ â€¢ Preferences   â”‚    â”‚ â€¢ Local shops   â”‚    â”‚ â€¢ Alternatives  â”‚    â”‚
â”‚         â”‚ â€¢ Budget limits â”‚    â”‚ â€¢ Online stores â”‚    â”‚ â€¢ New problems  â”‚    â”‚
â”‚         â”‚ â€¢ Organic only  â”‚    â”‚ â€¢ Cost estimatesâ”‚    â”‚ â€¢ Iterations    â”‚    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   â”‚                      â”‚                      â”‚            â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                          â”‚                                   â”‚
â”‚                                          â–¼                                   â”‚
â”‚                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                                 â”‚   COMPLETED     â”‚                          â”‚
â”‚                                 â”‚                 â”‚                          â”‚
â”‚                                 â”‚ âœ… Journey:     â”‚                          â”‚
â”‚                                 â”‚ â€¢ Diagnosis âœ“   â”‚                          â”‚
â”‚                                 â”‚ â€¢ Treatment âœ“   â”‚                          â”‚
â”‚                                 â”‚ â€¢ Vendors âœ“     â”‚                          â”‚
â”‚                                 â”‚ â€¢ Support âœ“     â”‚                          â”‚
â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”„ ITERATIVE LOOPS:
   â€¢ Any state can return to FOLLOW_UP for corrections
   â€¢ FOLLOW_UP can branch to: RECLASSIFICATION, ALTERNATIVE_PRESCRIPTION, NEW_PROBLEM
   â€¢ USER FEEDBACK continuously improves accuracy
```

## ğŸ® **User Interaction Flow**

```
                    ğŸ¯ CONVERSATION FLOW EXAMPLES

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            SCENARIO 1: NEW USER WITH IMAGE                     â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ‘¤ User: [uploads tomato leaf image] "What's wrong with my plant?"            â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ¯ INTENT_CAPTURE:                                                            â”‚
â”‚      â”œâ”€ Detects: Disease classification intent                                 â”‚
â”‚      â”œâ”€ Processes: Tomato leaf image (quality: good)                          â”‚
â”‚      â”œâ”€ Extracts: Crop type = "tomato", Problem = "disease inquiry"           â”‚
â”‚      â””â”€ Missing: Location, Season                                              â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ¤– System: "I can see you've uploaded a tomato leaf image for disease        â”‚
â”‚             identification. I've noted your crop type: tomato.                 â”‚
â”‚             What's your location (district/state) for region-specific advice?" â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ‘¤ User: "I'm in Punjab, India. It's monsoon season."                        â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ’¬ CLARIFICATION:                                                             â”‚
â”‚      â”œâ”€ Extracts: Location = "Punjab, India", Season = "monsoon"              â”‚
â”‚      â”œâ”€ Validates: All required info present                                   â”‚
â”‚      â””â”€ Decision: Proceed to classification                                     â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ¤– System: "Perfect! I have enough information. I'll now analyze your        â”‚
â”‚             tomato leaf image to identify any diseases."                       â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ”¬ CLASSIFICATION:                                                            â”‚
â”‚      â”œâ”€ CNN Analysis: Early Blight detected (89% confidence)                  â”‚
â”‚      â”œâ”€ Attention Map: Generated focus areas visualization                     â”‚
â”‚      â””â”€ Quality: High confidence diagnosis                                     â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ¤– System: "ğŸ”¬ Disease Classification Results                                â”‚
â”‚             Diagnosis: Early Blight                                            â”‚
â”‚             Confidence: 89% (high)                                             â”‚
â”‚             ğŸ¯ I've generated a visualization showing focus areas.             â”‚
â”‚             I'm confident in this diagnosis. Ready for treatment?"             â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ‘¤ User: "Yes, please provide treatment options."                            â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ’Š PRESCRIPTION:                                                              â”‚
â”‚      â”œâ”€ RAG Query: "Early blight treatment tomato Punjab monsoon"             â”‚
â”‚      â”œâ”€ Personalization: Location + season + crop specific                    â”‚
â”‚      â””â”€ Multi-options: Chemical, organic, preventive                          â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ¤– System: "ğŸ’Š Treatment Prescription for Early Blight                       â”‚
â”‚             Chemical: Copper sulfate spray (2g/L), weekly                     â”‚
â”‚             Organic: Neem oil + proper spacing                                 â”‚
â”‚             Prevention: Crop rotation, drip irrigation                         â”‚
â”‚             ğŸª Would you like local vendor suggestions?"                       â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ‘¤ User: "Yes, I prefer organic. Show me vendors."                           â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸª VENDOR_RECOMMENDATION:                                                     â”‚
â”‚      â”œâ”€ Location filter: Punjab suppliers                                     â”‚
â”‚      â”œâ”€ Preference filter: Organic products                                   â”‚
â”‚      â””â”€ Cost estimation: â‚¹150-250 range                                       â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ¤– System: "ğŸª Organic Vendors in Punjab:                                    â”‚
â”‚             â€¢ Green Valley Agri (2.5km) - Neem oil specialist                 â”‚
â”‚             â€¢ Farmers Choice (5.1km) - Organic certified                      â”‚
â”‚             ğŸ’° Estimated cost: â‚¹150-250                                       â”‚
â”‚             Need any other help?"                                              â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ‘¤ User: "Perfect, thank you!"                                               â”‚
â”‚      â”‚                                                                         â”‚
â”‚  âœ… COMPLETED                                                                  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SCENARIO 2: CORRECTION & ITERATION                        â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ‘¤ User: [after classification] "I think it's late blight, not early blight" â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ”„ ITERATIVE_FOLLOWUP:                                                        â”‚
â”‚      â”œâ”€ Detects: Correction feedback                                           â”‚
â”‚      â”œâ”€ Extracts: Disease = "late blight"                                     â”‚
â”‚      â””â”€ Action: Update diagnosis with user input                               â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ¤– System: "I understand the classification may not be accurate.             â”‚
â”‚             You're suggesting it might be late blight.                         â”‚
â”‚             Let me update the diagnosis. Shall I proceed with this correction?" â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ‘¤ User: "Yes, and I need urgent treatment options."                         â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ”„ Flow branches back to PRESCRIPTION with updated data:                     â”‚
â”‚      â”œâ”€ Disease: Late Blight (user-corrected)                                â”‚
â”‚      â”œâ”€ Urgency: High priority                                                â”‚
â”‚      â””â”€ Confidence: 80% (user-provided)                                       â”‚
â”‚      â”‚                                                                         â”‚
â”‚  ğŸ’Š Updated prescription generated for Late Blight + urgent treatment...      â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§  **Component Interaction Diagram**

```
                        ğŸ§© COMPONENT COLLABORATION

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                 â”‚
â”‚                          ğŸ“¥ USER REQUEST ARRIVES                               â”‚
â”‚                                    â”‚                                           â”‚
â”‚                                    â–¼                                           â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚            â”‚         ğŸ­ PLANNING AGENT ORCHESTRATOR          â”‚                â”‚
â”‚            â”‚                                                 â”‚                â”‚
â”‚            â”‚  1ï¸âƒ£ Analyze request type and context           â”‚                â”‚
â”‚            â”‚  2ï¸âƒ£ Determine current workflow state            â”‚                â”‚
â”‚            â”‚  3ï¸âƒ£ Select appropriate component handler        â”‚                â”‚
â”‚            â”‚  4ï¸âƒ£ Execute component with session context      â”‚                â”‚
â”‚            â”‚  5ï¸âƒ£ Process results and update session          â”‚                â”‚
â”‚            â”‚  6ï¸âƒ£ Determine next steps via WorkflowController â”‚                â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                          â”‚                                                     â”‚
â”‚                          â–¼                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚                    ğŸ”§ COMPONENT EXECUTION                           â”‚   â”‚
â”‚    â”‚                                                                     â”‚   â”‚
â”‚    â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     ğŸ“‹ BaseComponent Interface:                 â”‚   â”‚
â”‚    â”‚     â”‚   SESSION   â”‚ â—„â”€â”€ â€¢ validate_inputs()                        â”‚   â”‚
â”‚    â”‚  â”Œâ”€â”€â”¤   MANAGER   â”‚ â—„â”€â”€ â€¢ execute() - main logic                   â”‚   â”‚
â”‚    â”‚  â”‚  â”‚             â”‚ â—„â”€â”€ â€¢ create_success_result()                   â”‚   â”‚
â”‚    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â—„â”€â”€ â€¢ create_error_result()                     â”‚   â”‚
â”‚    â”‚  â”‚                                                                  â”‚   â”‚
â”‚    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚    â”‚  â”‚  â”‚                COMPONENT HANDLERS                           â”‚ â”‚   â”‚
â”‚    â”‚  â”‚  â”‚                                                             â”‚ â”‚   â”‚
â”‚    â”‚  â”‚  â”‚  ğŸ“‹ IntentCapture    ğŸ’¬ LLMClarification   ğŸ”¬ Classification â”‚ â”‚   â”‚
â”‚    â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚   â”‚
â”‚    â”‚  â””â”€â”€â”¼â”€â”€â”¤â€¢ Image proc â”‚    â”‚â€¢ LLM queriesâ”‚      â”‚â€¢ CNN model  â”‚   â”‚ â”‚   â”‚
â”‚    â”‚     â”‚  â”‚â€¢ Intent rec â”‚    â”‚â€¢ Smart ?s   â”‚      â”‚â€¢ Attention  â”‚   â”‚ â”‚   â”‚
â”‚    â”‚     â”‚  â”‚â€¢ Context    â”‚    â”‚â€¢ Info gap   â”‚      â”‚â€¢ Confidence â”‚   â”‚ â”‚   â”‚
â”‚    â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚   â”‚
â”‚    â”‚     â”‚                                                            â”‚ â”‚   â”‚
â”‚    â”‚     â”‚  ğŸ’Š Prescription     âš™ï¸ ConstraintGather  ğŸª VendorRecom   â”‚ â”‚   â”‚
â”‚    â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚   â”‚
â”‚    â”‚     â””â”€â”€â”¤â€¢ RAG query  â”‚    â”‚â€¢ Preferencesâ”‚      â”‚â€¢ Location   â”‚   â”‚ â”‚   â”‚
â”‚    â”‚        â”‚â€¢ Treatment  â”‚    â”‚â€¢ Budgets    â”‚      â”‚â€¢ Suppliers  â”‚   â”‚ â”‚   â”‚
â”‚    â”‚        â”‚â€¢ Personalizeâ”‚    â”‚â€¢ Organic    â”‚      â”‚â€¢ Costs      â”‚   â”‚ â”‚   â”‚
â”‚    â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚   â”‚
â”‚    â”‚                                                                  â”‚ â”‚   â”‚
â”‚    â”‚        ğŸ”„ IterativeFollowup                                      â”‚ â”‚   â”‚
â”‚    â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚ â”‚   â”‚
â”‚    â”‚        â”‚â€¢ Correctionsâ”‚                                           â”‚ â”‚   â”‚
â”‚    â”‚        â”‚â€¢ Iterations â”‚                                           â”‚ â”‚   â”‚
â”‚    â”‚        â”‚â€¢ Branching  â”‚                                           â”‚ â”‚   â”‚
â”‚    â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚ â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                                     â”‚
â”‚                          â–¼                                                     â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚            â”‚         ğŸ”€ WORKFLOW CONTROLLER                  â”‚                â”‚
â”‚            â”‚                                                 â”‚                â”‚
â”‚            â”‚  ğŸ¯ Responsibilities:                           â”‚                â”‚
â”‚            â”‚  â€¢ Analyze component results                    â”‚                â”‚
â”‚            â”‚  â€¢ Determine next workflow state                â”‚                â”‚
â”‚            â”‚  â€¢ Handle branching logic                       â”‚                â”‚
â”‚            â”‚  â€¢ Generate available actions                   â”‚                â”‚
â”‚            â”‚  â€¢ Manage state transitions                     â”‚                â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                          â”‚                                                     â”‚
â”‚                          â–¼                                                     â”‚
â”‚                    ğŸ“Š SESSION UPDATE                                           â”‚
â”‚                          â”‚                                                     â”‚
â”‚                          â–¼                                                     â”‚
â”‚                    ğŸ“¤ RESPONSE TO USER                                         â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¾ **Data Flow & Session Management**

```
                          ğŸ“Š SESSION DATA LIFECYCLE

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                 â”‚
â”‚  ğŸ†• NEW SESSION CREATED                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SessionData {                                                           â”‚   â”‚
â”‚  â”‚   session_id: "user_123",                                              â”‚   â”‚
â”‚  â”‚   created_at: "2024-01-15T10:30:00Z",                                  â”‚   â”‚
â”‚  â”‚   workflow_state: "initial",                                           â”‚   â”‚
â”‚  â”‚   user_profile: {},                                                    â”‚   â”‚
â”‚  â”‚   diagnosis_results: {},                                               â”‚   â”‚
â”‚  â”‚   prescriptions: [],                                                   â”‚   â”‚
â”‚  â”‚   vendor_choices: [],                                                  â”‚   â”‚
â”‚  â”‚   activities: []                                                       â”‚   â”‚
â”‚  â”‚ }                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                           â”‚
â”‚                                    â–¼                                           â”‚
â”‚  ğŸ“‹ INTENT CAPTURE UPDATES                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ user_profile: {                                                        â”‚   â”‚
â”‚  â”‚   primary_intent: "disease_classification",                            â”‚   â”‚
â”‚  â”‚   crop_type: "tomato",                                                 â”‚   â”‚
â”‚  â”‚   has_image: true,                                                     â”‚   â”‚
â”‚  â”‚   problem_description: "brown spots on leaves"                        â”‚   â”‚
â”‚  â”‚ },                                                                     â”‚   â”‚
â”‚  â”‚ workflow_state: "clarification",                                       â”‚   â”‚
â”‚  â”‚ activities: [                                                          â”‚   â”‚
â”‚  â”‚   {timestamp: "...", state: "intent_capture", user_input: "..."}       â”‚   â”‚
â”‚  â”‚ ]                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                           â”‚
â”‚                                    â–¼                                           â”‚
â”‚  ğŸ’¬ CLARIFICATION ADDS                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ user_profile: {                                                        â”‚   â”‚
â”‚  â”‚   ...existing...,                                                      â”‚   â”‚
â”‚  â”‚   location: "Punjab, India",                                           â”‚   â”‚
â”‚  â”‚   season: "monsoon",                                                   â”‚   â”‚
â”‚  â”‚   clarification_complete: true                                         â”‚   â”‚
â”‚  â”‚ },                                                                     â”‚   â”‚
â”‚  â”‚ workflow_state: "classification"                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                           â”‚
â”‚                                    â–¼                                           â”‚
â”‚  ğŸ”¬ CLASSIFICATION RESULTS                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ diagnosis_results: {                                                   â”‚   â”‚
â”‚  â”‚   disease_name: "early_blight",                                        â”‚   â”‚
â”‚  â”‚   friendly_disease_name: "Early Blight",                               â”‚   â”‚
â”‚  â”‚   confidence: 0.89,                                                    â”‚   â”‚
â”‚  â”‚   confidence_level: "high",                                            â”‚   â”‚
â”‚  â”‚   attention_overlay: "base64_image_data...",                           â”‚   â”‚
â”‚  â”‚   severity_assessment: "Confident diagnosis - treatment recommended"   â”‚   â”‚
â”‚  â”‚ },                                                                     â”‚   â”‚
â”‚  â”‚ workflow_state: "prescription"                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                           â”‚
â”‚                                    â–¼                                           â”‚
â”‚  ğŸ’Š PRESCRIPTION GENERATED                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ prescriptions: [                                                       â”‚   â”‚
â”‚  â”‚   {                                                                    â”‚   â”‚
â”‚  â”‚     timestamp: "2024-01-15T10:35:00Z",                                 â”‚   â”‚
â”‚  â”‚     prescription: {                                                    â”‚   â”‚
â”‚  â”‚       disease: "early_blight",                                         â”‚   â”‚
â”‚  â”‚       treatment_options: {                                             â”‚   â”‚
â”‚  â”‚         chemical: "Copper sulfate spray (2g/L)",                      â”‚   â”‚
â”‚  â”‚         organic: "Neem oil + plant spacing",                          â”‚   â”‚
â”‚  â”‚         prevention: "Crop rotation, drip irrigation"                  â”‚   â”‚
â”‚  â”‚       }                                                                â”‚   â”‚
â”‚  â”‚     }                                                                  â”‚   â”‚
â”‚  â”‚   }                                                                    â”‚   â”‚
â”‚  â”‚ ],                                                                     â”‚   â”‚
â”‚  â”‚ workflow_state: "vendor_recommendation"                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                           â”‚
â”‚                                    â–¼                                           â”‚
â”‚  ğŸª VENDOR CHOICES LOGGED                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ vendor_choices: [                                                      â”‚   â”‚
â”‚  â”‚   {                                                                    â”‚   â”‚
â”‚  â”‚     timestamp: "2024-01-15T10:37:00Z",                                 â”‚   â”‚
â”‚  â”‚     choice: {                                                          â”‚   â”‚
â”‚  â”‚       preferred_vendor: "Green Valley Agri",                          â”‚   â”‚
â”‚  â”‚       treatment_type: "organic",                                       â”‚   â”‚
â”‚  â”‚       estimated_cost: "â‚¹180"                                           â”‚   â”‚
â”‚  â”‚     }                                                                  â”‚   â”‚
â”‚  â”‚   }                                                                    â”‚   â”‚
â”‚  â”‚ ],                                                                     â”‚   â”‚
â”‚  â”‚ workflow_state: "completed"                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ’¾ COMPLETE SESSION SUMMARY:                                                  â”‚
â”‚  â€¢ Total Duration: 7 minutes                                                   â”‚
â”‚  â€¢ Interactions: 6 user inputs, 8 system responses                             â”‚
â”‚  â€¢ Success Metrics: Diagnosis âœ“, Treatment âœ“, Vendor âœ“                        â”‚
â”‚  â€¢ User Satisfaction: High (no corrections needed)                             â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ **API Integration Points**

```
                           ğŸ”Œ API ENDPOINT ARCHITECTURE

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            EXISTING SYSTEM INTEGRATION                         â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ“± MOBILE APP (Android/iOS)                 ğŸŒ WEB INTERFACE                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Current Endpoints:  â”‚                    â”‚ Current Endpoints:  â”‚            â”‚
â”‚  â”‚ â€¢ POST /chat        â”‚                    â”‚ â€¢ POST /chat        â”‚            â”‚
â”‚  â”‚ â€¢ POST /chat-stream â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â€¢ POST /chat-stream â”‚            â”‚
â”‚  â”‚ â€¢ GET /session/{}   â”‚                    â”‚ â€¢ GET /session/{}   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚            â”‚                                          â”‚                        â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                               â”‚                                                â”‚
â”‚                               â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     ğŸš€ FASTAPI ROUTER                                  â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚  ğŸ”„ HYBRID ROUTING LOGIC:                                              â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚  if (request.has_image || request.guided_mode):                        â”‚  â”‚
â”‚  â”‚      â†’ route_to_planning_agent()                                       â”‚  â”‚
â”‚  â”‚  else:                                                                  â”‚  â”‚
â”‚  â”‚      â†’ route_to_legacy_agent()                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”‚                             â”‚                                â”‚
â”‚                â–¼                             â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   ğŸ†• PLANNING AGENT     â”‚    â”‚      âš¡ LEGACY AGENT                   â”‚   â”‚
â”‚  â”‚   API ENDPOINTS         â”‚    â”‚      (Existing System)                 â”‚   â”‚
â”‚  â”‚                         â”‚    â”‚                                         â”‚   â”‚
â”‚  â”‚ POST /planning/chat     â”‚    â”‚ POST /chat                              â”‚   â”‚
â”‚  â”‚ POST /planning/stream   â”‚    â”‚ POST /chat-stream                       â”‚   â”‚
â”‚  â”‚ GET  /planning/session  â”‚    â”‚ GET  /session-history/{id}              â”‚   â”‚
â”‚  â”‚ POST /planning/restart  â”‚    â”‚ POST /summarize_response                â”‚   â”‚
â”‚  â”‚ GET  /planning/actions  â”‚    â”‚                                         â”‚   â”‚
â”‚  â”‚ POST /planning/migrate  â”‚    â”‚                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                                                                  â”‚
â”‚            â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    ğŸ¯ PLANNING AGENT SYSTEM                             â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚  ğŸ“Š Request Processing:                                                 â”‚  â”‚
â”‚  â”‚  1. Parse incoming request (PlanningChatRequest)                       â”‚  â”‚
â”‚  â”‚  2. Extract session_id, message, image_data, context                   â”‚  â”‚
â”‚  â”‚  3. Route to PlanningAgent.process_user_request()                      â”‚  â”‚
â”‚  â”‚  4. Execute appropriate component based on session state               â”‚  â”‚
â”‚  â”‚  5. Update session data and determine next steps                       â”‚  â”‚
â”‚  â”‚  6. Return structured response with next actions                       â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚  ğŸŒŠ Streaming Support:                                                  â”‚  â”‚
â”‚  â”‚  â€¢ Progress updates during image processing                             â”‚  â”‚
â”‚  â”‚  â€¢ Real-time CNN classification feedback                               â”‚  â”‚
â”‚  â”‚  â€¢ Component execution status                                          â”‚  â”‚
â”‚  â”‚  â€¢ Attention visualization streaming                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“‹ REQUEST/RESPONSE EXAMPLES:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               REQUEST FLOW                                     â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ“¤ CLIENT REQUEST:                                                             â”‚
â”‚  {                                                                              â”‚
â”‚    "session_id": "user_123",                                                   â”‚
â”‚    "message": "What's wrong with my tomato plant?",                            â”‚
â”‚    "image_b64": "iVBORw0KGgoAAAANSUhEUgAAA...",                               â”‚
â”‚    "context": {"crop_type": "tomato"},                                         â”‚
â”‚    "workflow_action": null                                                     â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ“¥ PLANNING AGENT RESPONSE:                                                    â”‚
â”‚  {                                                                              â”‚
â”‚    "success": true,                                                             â”‚
â”‚    "response": "I can see you've uploaded a tomato leaf image...",             â”‚
â”‚    "current_state": "clarification",                                           â”‚
â”‚    "next_actions": [                                                           â”‚
â”‚      "provide_location",                                                       â”‚
â”‚      "specify_symptoms",                                                       â”‚
â”‚      "proceed_with_classification"                                             â”‚
â”‚    ],                                                                           â”‚
â”‚    "requires_user_input": true,                                                â”‚
â”‚    "error_message": null                                                       â”‚
â”‚  }                                                                              â”‚
â”‚                                                                                 â”‚
â”‚  ğŸŒŠ STREAMING RESPONSE:                                                         â”‚
â”‚  data: Processing uploaded image...                                            â”‚
â”‚  data: Analyzing plant condition...                                            â”‚
â”‚  data: Running disease classification...                                       â”‚
â”‚  data: Generating attention visualization...                                   â”‚
â”‚  data: I can see you've uploaded a tomato leaf image...                       â”‚
â”‚  data: [DONE]                                                                  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ **Summary: Complete System Visualization**

The Planning Agent system provides:

1. **ğŸ—ï¸ Modular Architecture** - Clean separation between orchestration, components, and flow control
2. **ğŸ”„ Dynamic Workflow** - Intelligent state transitions based on user needs and context  
3. **ğŸ§  LLM-Guided Intelligence** - Smart questioning and personalized interactions
4. **ğŸ’¾ Comprehensive State Management** - Full session persistence and activity tracking
5. **ğŸ”Œ Seamless Integration** - Works alongside existing system with hybrid routing
6. **ğŸ® Rich User Experience** - Natural conversations with iterative improvements
7. **ğŸ“Š Observable & Debuggable** - Complete visibility into system behavior

This visual architecture demonstrates how the system transforms rigid workflows into intelligent, user-centric conversations that adapt dynamically to provide the best possible plant disease diagnosis and treatment experience! ğŸŒ±

{
  "project": "Research Data/medabot",
  "repo": "luistorres/medabot",
  "prior_commit": "3facc256a7fb92baff9246476227839385f537f4",
  "researched_commit": "b44b80ae3991ac76872bec46e622c51bb5ab4cea",
  "compare_url": "https://github.com/luistorres/medabot/compare/3facc256a7fb92baff9246476227839385f537f4...b44b80ae3991ac76872bec46e622c51bb5ab4cea",
  "ahead_by": 1,
  "behind_by": 0,
  "changed_files": [
    {
      "path": "app.config.ts",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "patch": "@@ -13,5 +13,7 @@ export default defineConfig({\n       }),\n       tailwindcss(),\n     ],\n+    // Ensure public directory is properly configured\n+    publicDir: \"public\",\n   },\n });",
      "patch_lines": [
        "@@ -13,5 +13,7 @@ export default defineConfig({\n",
        "       }),\n",
        "       tailwindcss(),\n",
        "     ],\n",
        "+    // Ensure public directory is properly configured\n",
        "+    publicDir: \"public\",\n",
        "   },\n",
        " });\n"
      ]
    },
    {
      "path": "app/components/App.tsx",
      "status": "modified",
      "additions": 213,
      "deletions": 145,
      "patch": "@@ -1,13 +1,21 @@\n import { useState } from \"react\";\n import Camera from \"./Camera\";\n import Chat from \"./Chat\";\n+import MedicineInfoPanel from \"./MedicineInfoPanel\";\n+import LandingPage from \"./LandingPage\";\n+import ManualMedicineForm from \"./ManualMedicineForm\";\n+import ResponsiveContainer from \"./layouts/ResponsiveContainer\";\n import { IdentifyMedicineResponse } from \"../core/identify\";\n import { performIdentify } from \"../server/performIdentify\";\n import { fetchRegulatoryPdf } from \"../server/fetchRefulatoryPdf\";\n import { processLeafletPdf } from \"../server/processLeaflet\";\n import { queryLeafletPdf } from \"../server/queryLeaflet\";\n+import { PDFProvider, usePDF } from \"../context/PDFContext\";\n \n-function App() {\n+type AppScreen = \"landing\" | \"camera\" | \"manualForm\" | \"processing\" | \"results\";\n+\n+function AppContent() {\n+  const [currentScreen, setCurrentScreen] = useState<AppScreen>(\"landing\");\n   const [image, setImage] = useState<string | null>(null);\n   const [medicineInfo, setMedicineInfo] = useState<IdentifyMedicineResponse>({\n     name: \"\",\n@@ -16,18 +24,20 @@ function App() {\n     dosage: \"\",\n   });\n   const [overview, setOverview] = useState<string>(\"\");\n-  const [pdfData, setPdfData] = useState<string | null>(null);\n   const [loading, setLoading] = useState<boolean>(false);\n \n   // Processing steps state\n   const [currentStep, setCurrentStep] = useState<string>(\"\");\n   const [completedSteps, setCompletedSteps] = useState<string[]>([]);\n   const [processingError, setProcessingError] = useState<string>(\"\");\n \n+  // Use PDF context\n+  const { pdfData, setPdfData } = usePDF();\n+\n   const steps = [\n     {\n       id: \"identify\",\n-      label: \"A identificar medicamento da imagem\",\n+      label: \"A identificar medicamento\",\n       icon: \"\ud83d\udd0d\",\n     },\n     { id: \"fetch\", label: \"A obter folheto informativo\", icon: \"\ud83d\udcc4\" },\n@@ -41,23 +51,24 @@ function App() {\n     setCurrentStep(\"\");\n   };\n \n-  const handleCapture = async (imgSrc: string) => {\n-    setImage(imgSrc);\n+  // Process medicine info (called by both camera and manual entry)\n+  const processMedicineInfo = async (info: IdentifyMedicineResponse) => {\n+    setMedicineInfo(info);\n+    setCurrentScreen(\"processing\");\n     setLoading(true);\n     setProcessingError(\"\");\n     setCompletedSteps([]);\n     setCurrentStep(\"\");\n \n     try {\n-      // Step 1: Identify medicine from image\n-      setCurrentStep(\"identify\");\n-      const medicineInfo = await performIdentify({ data: imgSrc });\n-      setMedicineInfo(medicineInfo);\n-      markStepComplete(\"identify\");\n+      // Skip identify step if coming from manual form\n+      if (currentScreen !== \"camera\") {\n+        markStepComplete(\"identify\");\n+      }\n \n       // Step 2: Fetch PDF\n       setCurrentStep(\"fetch\");\n-      const pdfResponse = await fetchRegulatoryPdf({ data: medicineInfo });\n+      const pdfResponse = await fetchRegulatoryPdf({ data: info });\n \n       if (!pdfResponse || !pdfResponse.data) {\n         throw new Error(\"Falha ao obter folheto informativo do medicamento\");\n@@ -93,8 +104,9 @@ function App() {\n \n       // Step 5: Ready for questions\n       markStepComplete(\"ready\");\n+      setCurrentScreen(\"results\");\n     } catch (error) {\n-      console.error(\"Error processing image:\", error);\n+      console.error(\"Error processing medicine:\", error);\n       setProcessingError(\n         error instanceof Error ? error.message : \"Ocorreu um erro desconhecido\"\n       );\n@@ -104,7 +116,42 @@ function App() {\n     }\n   };\n \n+  // Handle camera capture\n+  const handleCapture = async (imgSrc: string) => {\n+    setImage(imgSrc);\n+    setLoading(true);\n+    setProcessingError(\"\");\n+    setCompletedSteps([]);\n+    setCurrentStep(\"\");\n+\n+    try {\n+      // Step 1: Identify medicine from image\n+      setCurrentStep(\"identify\");\n+      setCurrentScreen(\"processing\");\n+\n+      const medicineInfo = await performIdentify({ data: imgSrc });\n+      markStepComplete(\"identify\");\n+\n+      // Continue with processing\n+      await processMedicineInfo(medicineInfo);\n+    } catch (error) {\n+      console.error(\"Error identifying medicine:\", error);\n+      setProcessingError(\n+        error instanceof Error ? error.message : \"Falha ao identificar medicamento da imagem\"\n+      );\n+      setCurrentStep(\"\");\n+      setLoading(false);\n+    }\n+  };\n+\n+  // Handle manual form submission\n+  const handleManualSubmit = async (data: IdentifyMedicineResponse) => {\n+    await processMedicineInfo(data);\n+  };\n+\n+  // Reset to landing\n   const handleReset = () => {\n+    setCurrentScreen(\"landing\");\n     setImage(null);\n     setMedicineInfo({\n       name: \"\",\n@@ -119,6 +166,7 @@ function App() {\n     setProcessingError(\"\");\n   };\n \n+  // Download PDF\n   const downloadPdf = () => {\n     if (!pdfData) return;\n \n@@ -148,145 +196,165 @@ function App() {\n     }\n   };\n \n-  return (\n-    <div className=\"min-h-screen flex flex-col items-center justify-center p-4\">\n-      <div className=\"max-w-2xl mx-auto space-y-6\">\n-        {!image ? (\n-          <Camera onCapture={handleCapture} />\n-        ) : !medicineInfo.name ? (\n-          // Show image only while processing, hide after medicine is identified\n-          <div className=\"flex flex-col\">\n-            <img src={image} alt=\"Capturada\" className=\"rounded-lg\" />\n-            <button\n-              onClick={handleReset}\n-              className=\"bg-blue-500 text-white px-4 py-2 rounded-md mt-4\"\n-            >\n-              Reiniciar\n-            </button>\n-          </div>\n-        ) : (\n-          // Show only reset button after medicine is identified\n-          <div className=\"flex justify-center\">\n-            <button\n-              onClick={handleReset}\n-              className=\"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md text-sm\"\n-            >\n-              Digitalizar Novo Medicamento\n-            </button>\n-          </div>\n-        )}\n-\n-        {medicineInfo.name && (\n-          <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6\">\n-            <h2 className=\"text-xl md:text-2xl font-bold text-gray-800 mb-3 md:mb-4\">\n-              {medicineInfo.name}\n-            </h2>\n-            <div className=\"space-y-2\">\n-              <p className=\"text-sm md:text-base text-gray-700\">\n-                <span className=\"font-semibold\">Subst\u00e2ncia Activa:</span>{\" \"}\n-                {medicineInfo.activeSubstance}\n-              </p>\n-              <p className=\"text-sm md:text-base text-gray-700\">\n-                <span className=\"font-semibold\">Brand:</span>{\" \"}\n-                {medicineInfo.brand}\n-              </p>\n-              <p className=\"text-sm md:text-base text-gray-700\">\n-                <span className=\"font-semibold\">Dosage:</span>{\" \"}\n-                {medicineInfo.dosage}\n-              </p>\n-            </div>\n-            {pdfData && (\n-              <button\n-                onClick={downloadPdf}\n-                className=\"flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded mt-3 md:mt-4 transition-colors text-sm md:text-base\"\n-              >\n-                <span>\ud83d\udcc4</span>\n-                <span>Transferir Folheto</span>\n-              </button>\n-            )}\n-          </div>\n-        )}\n-\n-        {/* Processing Steps */}\n-        {loading && (\n-          <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6\">\n-            <h3 className=\"text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4\">\n-              A Processar Informa\u00e7\u00f5es do Medicamento\n-            </h3>\n-            <div className=\"space-y-3\">\n-              {steps.map((step) => {\n-                const isCompleted = completedSteps.includes(step.id);\n-                const isCurrent = currentStep === step.id;\n-\n-                return (\n-                  <div key={step.id} className=\"flex items-center space-x-3\">\n-                    <div\n-                      className={`w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center text-xs md:text-sm ${\n-                        isCompleted\n-                          ? \"bg-green-500 text-white\"\n-                          : isCurrent\n-                            ? \"bg-blue-500 text-white animate-pulse\"\n-                            : \"bg-gray-200 text-gray-500\"\n-                      }`}\n-                    >\n-                      {isCompleted ? \"\u2713\" : isCurrent ? \"\u27f3\" : step.icon}\n-                    </div>\n-                    <span\n-                      className={`text-sm md:text-base ${\n-                        isCompleted\n-                          ? \"text-green-700 font-medium\"\n-                          : isCurrent\n-                            ? \"text-blue-700 font-medium\"\n-                            : \"text-gray-500\"\n-                      }`}\n-                    >\n-                      {step.label}\n-                    </span>\n-                    {isCurrent && (\n-                      <div className=\"ml-auto\">\n-                        <div className=\"animate-spin rounded-full h-3 w-3 md:h-4 md:w-4 border-b-2 border-blue-600\"></div>\n+  // Render landing page\n+  if (currentScreen === \"landing\") {\n+    return (\n+      <LandingPage\n+        onScanMedicine={() => setCurrentScreen(\"camera\")}\n+        onManualEntry={() => setCurrentScreen(\"manualForm\")}\n+      />\n+    );\n+  }\n+\n+  // Render camera screen\n+  if (currentScreen === \"camera\") {\n+    return (\n+      <Camera\n+        onCapture={handleCapture}\n+        onCancel={() => setCurrentScreen(\"landing\")}\n+      />\n+    );\n+  }\n+\n+  // Render manual form screen\n+  if (currentScreen === \"manualForm\") {\n+    return (\n+      <ManualMedicineForm\n+        onSubmit={handleManualSubmit}\n+        onCancel={() => setCurrentScreen(\"landing\")}\n+      />\n+    );\n+  }\n+\n+  // Render processing screen\n+  if (currentScreen === \"processing\") {\n+    return (\n+      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-white flex items-center justify-center p-4\">\n+        <div className=\"max-w-2xl w-full space-y-6\">\n+          {/* Processing Steps */}\n+          {loading && (\n+            <div className=\"bg-white rounded-2xl shadow-xl p-8\">\n+              <h3 className=\"text-2xl font-bold text-gray-900 mb-6 text-center\">\n+                A Processar Informa\u00e7\u00f5es do Medicamento\n+              </h3>\n+              <div className=\"space-y-4\">\n+                {steps.map((step) => {\n+                  const isCompleted = completedSteps.includes(step.id);\n+                  const isCurrent = currentStep === step.id;\n+\n+                  return (\n+                    <div key={step.id} className=\"flex items-center space-x-4\">\n+                      <div\n+                        className={`w-12 h-12 rounded-full flex items-center justify-center text-lg ${\n+                          isCompleted\n+                            ? \"bg-green-500 text-white\"\n+                            : isCurrent\n+                              ? \"bg-blue-500 text-white animate-pulse\"\n+                              : \"bg-gray-200 text-gray-500\"\n+                        }`}\n+                      >\n+                        {isCompleted ? \"\u2713\" : isCurrent ? \"\u27f3\" : step.icon}\n                       </div>\n-                    )}\n-                  </div>\n-                );\n-              })}\n+                      <span\n+                        className={`text-lg flex-1 ${\n+                          isCompleted\n+                            ? \"text-green-700 font-medium\"\n+                            : isCurrent\n+                              ? \"text-blue-700 font-medium\"\n+                              : \"text-gray-500\"\n+                        }`}\n+                      >\n+                        {step.label}\n+                      </span>\n+                      {isCurrent && (\n+                        <div className=\"ml-auto\">\n+                          <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600\"></div>\n+                        </div>\n+                      )}\n+                    </div>\n+                  );\n+                })}\n+              </div>\n             </div>\n-          </div>\n-        )}\n-\n-        {/* Error Display */}\n-        {processingError && (\n-          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n-            <div className=\"flex items-center\">\n-              <div className=\"text-red-500 mr-2\">\u274c</div>\n-              <div>\n-                <h4 className=\"text-red-800 font-medium text-sm md:text-base\">\n-                  Erro de Processamento\n-                </h4>\n-                <p className=\"text-red-700 text-xs md:text-sm mt-1\">\n-                  {processingError}\n+          )}\n+\n+          {/* Error Display with fallback options */}\n+          {processingError && (\n+            <div className=\"bg-white rounded-2xl shadow-xl p-8\">\n+              <div className=\"flex items-start mb-6\">\n+                <div className=\"text-red-500 text-3xl mr-4\">\u274c</div>\n+                <div className=\"flex-1\">\n+                  <h4 className=\"text-xl text-red-800 font-bold mb-2\">\n+                    Erro de Processamento\n+                  </h4>\n+                  <p className=\"text-red-700\">{processingError}</p>\n+                </div>\n+              </div>\n+\n+              <div className=\"border-t border-gray-200 pt-6\">\n+                <p className=\"text-gray-700 mb-4 font-medium\">\n+                  O que deseja fazer?\n                 </p>\n+                <div className=\"grid md:grid-cols-2 gap-4\">\n+                  <button\n+                    onClick={() => setCurrentScreen(\"camera\")}\n+                    className=\"px-6 py-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center\"\n+                  >\n+                    <span className=\"mr-2\">\ud83d\udcf8</span>\n+                    Tentar com c\u00e2mara\n+                  </button>\n+                  <button\n+                    onClick={() => setCurrentScreen(\"manualForm\")}\n+                    className=\"px-6 py-4 bg-gray-700 text-white font-medium rounded-lg hover:bg-gray-800 transition-colors flex items-center justify-center\"\n+                  >\n+                    <span className=\"mr-2\">\u270d\ufe0f</span>\n+                    Introduzir manualmente\n+                  </button>\n+                </div>\n+                <button\n+                  onClick={handleReset}\n+                  className=\"w-full mt-4 px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors\"\n+                >\n+                  Voltar ao in\u00edcio\n+                </button>\n               </div>\n             </div>\n-            <button\n-              onClick={handleReset}\n-              className=\"mt-3 bg-red-600 text-white px-4 py-2 rounded text-sm hover:bg-red-700\"\n-            >\n-              Tentar Novamente\n-            </button>\n-          </div>\n-        )}\n-\n-        {/* Chat Component */}\n-        {completedSteps.includes(\"ready\") && pdfData && (\n-          <Chat\n-            pdfData={pdfData}\n-            medicineName={medicineInfo.name}\n-            initialOverview={overview}\n-          />\n-        )}\n+          )}\n+        </div>\n       </div>\n-    </div>\n+    );\n+  }\n+\n+  // Render results screen (main app)\n+  return (\n+    <ResponsiveContainer\n+      medicineInfoPanel={\n+        <MedicineInfoPanel\n+          medicineInfo={medicineInfo}\n+          image={image}\n+          pdfData={pdfData}\n+          onReset={handleReset}\n+          onDownloadPdf={downloadPdf}\n+        />\n+      }\n+      chat={\n+        <Chat\n+          pdfData={pdfData || \"\"}\n+          medicineName={medicineInfo.name}\n+          initialOverview={overview}\n+        />\n+      }\n+      showPdfViewer={!!pdfData}\n+    />\n+  );\n+}\n+\n+// Wrap with PDFProvider\n+function App() {\n+  return (\n+    <PDFProvider>\n+      <AppContent />\n+    </PDFProvider>\n   );\n }\n ",
      "patch_lines": [
        "@@ -1,13 +1,21 @@\n",
        " import { useState } from \"react\";\n",
        " import Camera from \"./Camera\";\n",
        " import Chat from \"./Chat\";\n",
        "+import MedicineInfoPanel from \"./MedicineInfoPanel\";\n",
        "+import LandingPage from \"./LandingPage\";\n",
        "+import ManualMedicineForm from \"./ManualMedicineForm\";\n",
        "+import ResponsiveContainer from \"./layouts/ResponsiveContainer\";\n",
        " import { IdentifyMedicineResponse } from \"../core/identify\";\n",
        " import { performIdentify } from \"../server/performIdentify\";\n",
        " import { fetchRegulatoryPdf } from \"../server/fetchRefulatoryPdf\";\n",
        " import { processLeafletPdf } from \"../server/processLeaflet\";\n",
        " import { queryLeafletPdf } from \"../server/queryLeaflet\";\n",
        "+import { PDFProvider, usePDF } from \"../context/PDFContext\";\n",
        " \n",
        "-function App() {\n",
        "+type AppScreen = \"landing\" | \"camera\" | \"manualForm\" | \"processing\" | \"results\";\n",
        "+\n",
        "+function AppContent() {\n",
        "+  const [currentScreen, setCurrentScreen] = useState<AppScreen>(\"landing\");\n",
        "   const [image, setImage] = useState<string | null>(null);\n",
        "   const [medicineInfo, setMedicineInfo] = useState<IdentifyMedicineResponse>({\n",
        "     name: \"\",\n",
        "@@ -16,18 +24,20 @@ function App() {\n",
        "     dosage: \"\",\n",
        "   });\n",
        "   const [overview, setOverview] = useState<string>(\"\");\n",
        "-  const [pdfData, setPdfData] = useState<string | null>(null);\n",
        "   const [loading, setLoading] = useState<boolean>(false);\n",
        " \n",
        "   // Processing steps state\n",
        "   const [currentStep, setCurrentStep] = useState<string>(\"\");\n",
        "   const [completedSteps, setCompletedSteps] = useState<string[]>([]);\n",
        "   const [processingError, setProcessingError] = useState<string>(\"\");\n",
        " \n",
        "+  // Use PDF context\n",
        "+  const { pdfData, setPdfData } = usePDF();\n",
        "+\n",
        "   const steps = [\n",
        "     {\n",
        "       id: \"identify\",\n",
        "-      label: \"A identificar medicamento da imagem\",\n",
        "+      label: \"A identificar medicamento\",\n",
        "       icon: \"\ud83d\udd0d\",\n",
        "     },\n",
        "     { id: \"fetch\", label: \"A obter folheto informativo\", icon: \"\ud83d\udcc4\" },\n",
        "@@ -41,23 +51,24 @@ function App() {\n",
        "     setCurrentStep(\"\");\n",
        "   };\n",
        " \n",
        "-  const handleCapture = async (imgSrc: string) => {\n",
        "-    setImage(imgSrc);\n",
        "+  // Process medicine info (called by both camera and manual entry)\n",
        "+  const processMedicineInfo = async (info: IdentifyMedicineResponse) => {\n",
        "+    setMedicineInfo(info);\n",
        "+    setCurrentScreen(\"processing\");\n",
        "     setLoading(true);\n",
        "     setProcessingError(\"\");\n",
        "     setCompletedSteps([]);\n",
        "     setCurrentStep(\"\");\n",
        " \n",
        "     try {\n",
        "-      // Step 1: Identify medicine from image\n",
        "-      setCurrentStep(\"identify\");\n",
        "-      const medicineInfo = await performIdentify({ data: imgSrc });\n",
        "-      setMedicineInfo(medicineInfo);\n",
        "-      markStepComplete(\"identify\");\n",
        "+      // Skip identify step if coming from manual form\n",
        "+      if (currentScreen !== \"camera\") {\n",
        "+        markStepComplete(\"identify\");\n",
        "+      }\n",
        " \n",
        "       // Step 2: Fetch PDF\n",
        "       setCurrentStep(\"fetch\");\n",
        "-      const pdfResponse = await fetchRegulatoryPdf({ data: medicineInfo });\n",
        "+      const pdfResponse = await fetchRegulatoryPdf({ data: info });\n",
        " \n",
        "       if (!pdfResponse || !pdfResponse.data) {\n",
        "         throw new Error(\"Falha ao obter folheto informativo do medicamento\");\n",
        "@@ -93,8 +104,9 @@ function App() {\n",
        " \n",
        "       // Step 5: Ready for questions\n",
        "       markStepComplete(\"ready\");\n",
        "+      setCurrentScreen(\"results\");\n",
        "     } catch (error) {\n",
        "-      console.error(\"Error processing image:\", error);\n",
        "+      console.error(\"Error processing medicine:\", error);\n",
        "       setProcessingError(\n",
        "         error instanceof Error ? error.message : \"Ocorreu um erro desconhecido\"\n",
        "       );\n",
        "@@ -104,7 +116,42 @@ function App() {\n",
        "     }\n",
        "   };\n",
        " \n",
        "+  // Handle camera capture\n",
        "+  const handleCapture = async (imgSrc: string) => {\n",
        "+    setImage(imgSrc);\n",
        "+    setLoading(true);\n",
        "+    setProcessingError(\"\");\n",
        "+    setCompletedSteps([]);\n",
        "+    setCurrentStep(\"\");\n",
        "+\n",
        "+    try {\n",
        "+      // Step 1: Identify medicine from image\n",
        "+      setCurrentStep(\"identify\");\n",
        "+      setCurrentScreen(\"processing\");\n",
        "+\n",
        "+      const medicineInfo = await performIdentify({ data: imgSrc });\n",
        "+      markStepComplete(\"identify\");\n",
        "+\n",
        "+      // Continue with processing\n",
        "+      await processMedicineInfo(medicineInfo);\n",
        "+    } catch (error) {\n",
        "+      console.error(\"Error identifying medicine:\", error);\n",
        "+      setProcessingError(\n",
        "+        error instanceof Error ? error.message : \"Falha ao identificar medicamento da imagem\"\n",
        "+      );\n",
        "+      setCurrentStep(\"\");\n",
        "+      setLoading(false);\n",
        "+    }\n",
        "+  };\n",
        "+\n",
        "+  // Handle manual form submission\n",
        "+  const handleManualSubmit = async (data: IdentifyMedicineResponse) => {\n",
        "+    await processMedicineInfo(data);\n",
        "+  };\n",
        "+\n",
        "+  // Reset to landing\n",
        "   const handleReset = () => {\n",
        "+    setCurrentScreen(\"landing\");\n",
        "     setImage(null);\n",
        "     setMedicineInfo({\n",
        "       name: \"\",\n",
        "@@ -119,6 +166,7 @@ function App() {\n",
        "     setProcessingError(\"\");\n",
        "   };\n",
        " \n",
        "+  // Download PDF\n",
        "   const downloadPdf = () => {\n",
        "     if (!pdfData) return;\n",
        " \n",
        "@@ -148,145 +196,165 @@ function App() {\n",
        "     }\n",
        "   };\n",
        " \n",
        "-  return (\n",
        "-    <div className=\"min-h-screen flex flex-col items-center justify-center p-4\">\n",
        "-      <div className=\"max-w-2xl mx-auto space-y-6\">\n",
        "-        {!image ? (\n",
        "-          <Camera onCapture={handleCapture} />\n",
        "-        ) : !medicineInfo.name ? (\n",
        "-          // Show image only while processing, hide after medicine is identified\n",
        "-          <div className=\"flex flex-col\">\n",
        "-            <img src={image} alt=\"Capturada\" className=\"rounded-lg\" />\n",
        "-            <button\n",
        "-              onClick={handleReset}\n",
        "-              className=\"bg-blue-500 text-white px-4 py-2 rounded-md mt-4\"\n",
        "-            >\n",
        "-              Reiniciar\n",
        "-            </button>\n",
        "-          </div>\n",
        "-        ) : (\n",
        "-          // Show only reset button after medicine is identified\n",
        "-          <div className=\"flex justify-center\">\n",
        "-            <button\n",
        "-              onClick={handleReset}\n",
        "-              className=\"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md text-sm\"\n",
        "-            >\n",
        "-              Digitalizar Novo Medicamento\n",
        "-            </button>\n",
        "-          </div>\n",
        "-        )}\n",
        "-\n",
        "-        {medicineInfo.name && (\n",
        "-          <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6\">\n",
        "-            <h2 className=\"text-xl md:text-2xl font-bold text-gray-800 mb-3 md:mb-4\">\n",
        "-              {medicineInfo.name}\n",
        "-            </h2>\n",
        "-            <div className=\"space-y-2\">\n",
        "-              <p className=\"text-sm md:text-base text-gray-700\">\n",
        "-                <span className=\"font-semibold\">Subst\u00e2ncia Activa:</span>{\" \"}\n",
        "-                {medicineInfo.activeSubstance}\n",
        "-              </p>\n",
        "-              <p className=\"text-sm md:text-base text-gray-700\">\n",
        "-                <span className=\"font-semibold\">Brand:</span>{\" \"}\n",
        "-                {medicineInfo.brand}\n",
        "-              </p>\n",
        "-              <p className=\"text-sm md:text-base text-gray-700\">\n",
        "-                <span className=\"font-semibold\">Dosage:</span>{\" \"}\n",
        "-                {medicineInfo.dosage}\n",
        "-              </p>\n",
        "-            </div>\n",
        "-            {pdfData && (\n",
        "-              <button\n",
        "-                onClick={downloadPdf}\n",
        "-                className=\"flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded mt-3 md:mt-4 transition-colors text-sm md:text-base\"\n",
        "-              >\n",
        "-                <span>\ud83d\udcc4</span>\n",
        "-                <span>Transferir Folheto</span>\n",
        "-              </button>\n",
        "-            )}\n",
        "-          </div>\n",
        "-        )}\n",
        "-\n",
        "-        {/* Processing Steps */}\n",
        "-        {loading && (\n",
        "-          <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6\">\n",
        "-            <h3 className=\"text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4\">\n",
        "-              A Processar Informa\u00e7\u00f5es do Medicamento\n",
        "-            </h3>\n",
        "-            <div className=\"space-y-3\">\n",
        "-              {steps.map((step) => {\n",
        "-                const isCompleted = completedSteps.includes(step.id);\n",
        "-                const isCurrent = currentStep === step.id;\n",
        "-\n",
        "-                return (\n",
        "-                  <div key={step.id} className=\"flex items-center space-x-3\">\n",
        "-                    <div\n",
        "-                      className={`w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center text-xs md:text-sm ${\n",
        "-                        isCompleted\n",
        "-                          ? \"bg-green-500 text-white\"\n",
        "-                          : isCurrent\n",
        "-                            ? \"bg-blue-500 text-white animate-pulse\"\n",
        "-                            : \"bg-gray-200 text-gray-500\"\n",
        "-                      }`}\n",
        "-                    >\n",
        "-                      {isCompleted ? \"\u2713\" : isCurrent ? \"\u27f3\" : step.icon}\n",
        "-                    </div>\n",
        "-                    <span\n",
        "-                      className={`text-sm md:text-base ${\n",
        "-                        isCompleted\n",
        "-                          ? \"text-green-700 font-medium\"\n",
        "-                          : isCurrent\n",
        "-                            ? \"text-blue-700 font-medium\"\n",
        "-                            : \"text-gray-500\"\n",
        "-                      }`}\n",
        "-                    >\n",
        "-                      {step.label}\n",
        "-                    </span>\n",
        "-                    {isCurrent && (\n",
        "-                      <div className=\"ml-auto\">\n",
        "-                        <div className=\"animate-spin rounded-full h-3 w-3 md:h-4 md:w-4 border-b-2 border-blue-600\"></div>\n",
        "+  // Render landing page\n",
        "+  if (currentScreen === \"landing\") {\n",
        "+    return (\n",
        "+      <LandingPage\n",
        "+        onScanMedicine={() => setCurrentScreen(\"camera\")}\n",
        "+        onManualEntry={() => setCurrentScreen(\"manualForm\")}\n",
        "+      />\n",
        "+    );\n",
        "+  }\n",
        "+\n",
        "+  // Render camera screen\n",
        "+  if (currentScreen === \"camera\") {\n",
        "+    return (\n",
        "+      <Camera\n",
        "+        onCapture={handleCapture}\n",
        "+        onCancel={() => setCurrentScreen(\"landing\")}\n",
        "+      />\n",
        "+    );\n",
        "+  }\n",
        "+\n",
        "+  // Render manual form screen\n",
        "+  if (currentScreen === \"manualForm\") {\n",
        "+    return (\n",
        "+      <ManualMedicineForm\n",
        "+        onSubmit={handleManualSubmit}\n",
        "+        onCancel={() => setCurrentScreen(\"landing\")}\n",
        "+      />\n",
        "+    );\n",
        "+  }\n",
        "+\n",
        "+  // Render processing screen\n",
        "+  if (currentScreen === \"processing\") {\n",
        "+    return (\n",
        "+      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-white flex items-center justify-center p-4\">\n",
        "+        <div className=\"max-w-2xl w-full space-y-6\">\n",
        "+          {/* Processing Steps */}\n",
        "+          {loading && (\n",
        "+            <div className=\"bg-white rounded-2xl shadow-xl p-8\">\n",
        "+              <h3 className=\"text-2xl font-bold text-gray-900 mb-6 text-center\">\n",
        "+                A Processar Informa\u00e7\u00f5es do Medicamento\n",
        "+              </h3>\n",
        "+              <div className=\"space-y-4\">\n",
        "+                {steps.map((step) => {\n",
        "+                  const isCompleted = completedSteps.includes(step.id);\n",
        "+                  const isCurrent = currentStep === step.id;\n",
        "+\n",
        "+                  return (\n",
        "+                    <div key={step.id} className=\"flex items-center space-x-4\">\n",
        "+                      <div\n",
        "+                        className={`w-12 h-12 rounded-full flex items-center justify-center text-lg ${\n",
        "+                          isCompleted\n",
        "+                            ? \"bg-green-500 text-white\"\n",
        "+                            : isCurrent\n",
        "+                              ? \"bg-blue-500 text-white animate-pulse\"\n",
        "+                              : \"bg-gray-200 text-gray-500\"\n",
        "+                        }`}\n",
        "+                      >\n",
        "+                        {isCompleted ? \"\u2713\" : isCurrent ? \"\u27f3\" : step.icon}\n",
        "                       </div>\n",
        "-                    )}\n",
        "-                  </div>\n",
        "-                );\n",
        "-              })}\n",
        "+                      <span\n",
        "+                        className={`text-lg flex-1 ${\n",
        "+                          isCompleted\n",
        "+                            ? \"text-green-700 font-medium\"\n",
        "+                            : isCurrent\n",
        "+                              ? \"text-blue-700 font-medium\"\n",
        "+                              : \"text-gray-500\"\n",
        "+                        }`}\n",
        "+                      >\n",
        "+                        {step.label}\n",
        "+                      </span>\n",
        "+                      {isCurrent && (\n",
        "+                        <div className=\"ml-auto\">\n",
        "+                          <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600\"></div>\n",
        "+                        </div>\n",
        "+                      )}\n",
        "+                    </div>\n",
        "+                  );\n",
        "+                })}\n",
        "+              </div>\n",
        "             </div>\n",
        "-          </div>\n",
        "-        )}\n",
        "-\n",
        "-        {/* Error Display */}\n",
        "-        {processingError && (\n",
        "-          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n",
        "-            <div className=\"flex items-center\">\n",
        "-              <div className=\"text-red-500 mr-2\">\u274c</div>\n",
        "-              <div>\n",
        "-                <h4 className=\"text-red-800 font-medium text-sm md:text-base\">\n",
        "-                  Erro de Processamento\n",
        "-                </h4>\n",
        "-                <p className=\"text-red-700 text-xs md:text-sm mt-1\">\n",
        "-                  {processingError}\n",
        "+          )}\n",
        "+\n",
        "+          {/* Error Display with fallback options */}\n",
        "+          {processingError && (\n",
        "+            <div className=\"bg-white rounded-2xl shadow-xl p-8\">\n",
        "+              <div className=\"flex items-start mb-6\">\n",
        "+                <div className=\"text-red-500 text-3xl mr-4\">\u274c</div>\n",
        "+                <div className=\"flex-1\">\n",
        "+                  <h4 className=\"text-xl text-red-800 font-bold mb-2\">\n",
        "+                    Erro de Processamento\n",
        "+                  </h4>\n",
        "+                  <p className=\"text-red-700\">{processingError}</p>\n",
        "+                </div>\n",
        "+              </div>\n",
        "+\n",
        "+              <div className=\"border-t border-gray-200 pt-6\">\n",
        "+                <p className=\"text-gray-700 mb-4 font-medium\">\n",
        "+                  O que deseja fazer?\n",
        "                 </p>\n",
        "+                <div className=\"grid md:grid-cols-2 gap-4\">\n",
        "+                  <button\n",
        "+                    onClick={() => setCurrentScreen(\"camera\")}\n",
        "+                    className=\"px-6 py-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center\"\n",
        "+                  >\n",
        "+                    <span className=\"mr-2\">\ud83d\udcf8</span>\n",
        "+                    Tentar com c\u00e2mara\n",
        "+                  </button>\n",
        "+                  <button\n",
        "+                    onClick={() => setCurrentScreen(\"manualForm\")}\n",
        "+                    className=\"px-6 py-4 bg-gray-700 text-white font-medium rounded-lg hover:bg-gray-800 transition-colors flex items-center justify-center\"\n",
        "+                  >\n",
        "+                    <span className=\"mr-2\">\u270d\ufe0f</span>\n",
        "+                    Introduzir manualmente\n",
        "+                  </button>\n",
        "+                </div>\n",
        "+                <button\n",
        "+                  onClick={handleReset}\n",
        "+                  className=\"w-full mt-4 px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors\"\n",
        "+                >\n",
        "+                  Voltar ao in\u00edcio\n",
        "+                </button>\n",
        "               </div>\n",
        "             </div>\n",
        "-            <button\n",
        "-              onClick={handleReset}\n",
        "-              className=\"mt-3 bg-red-600 text-white px-4 py-2 rounded text-sm hover:bg-red-700\"\n",
        "-            >\n",
        "-              Tentar Novamente\n",
        "-            </button>\n",
        "-          </div>\n",
        "-        )}\n",
        "-\n",
        "-        {/* Chat Component */}\n",
        "-        {completedSteps.includes(\"ready\") && pdfData && (\n",
        "-          <Chat\n",
        "-            pdfData={pdfData}\n",
        "-            medicineName={medicineInfo.name}\n",
        "-            initialOverview={overview}\n",
        "-          />\n",
        "-        )}\n",
        "+          )}\n",
        "+        </div>\n",
        "       </div>\n",
        "-    </div>\n",
        "+    );\n",
        "+  }\n",
        "+\n",
        "+  // Render results screen (main app)\n",
        "+  return (\n",
        "+    <ResponsiveContainer\n",
        "+      medicineInfoPanel={\n",
        "+        <MedicineInfoPanel\n",
        "+          medicineInfo={medicineInfo}\n",
        "+          image={image}\n",
        "+          pdfData={pdfData}\n",
        "+          onReset={handleReset}\n",
        "+          onDownloadPdf={downloadPdf}\n",
        "+        />\n",
        "+      }\n",
        "+      chat={\n",
        "+        <Chat\n",
        "+          pdfData={pdfData || \"\"}\n",
        "+          medicineName={medicineInfo.name}\n",
        "+          initialOverview={overview}\n",
        "+        />\n",
        "+      }\n",
        "+      showPdfViewer={!!pdfData}\n",
        "+    />\n",
        "+  );\n",
        "+}\n",
        "+\n",
        "+// Wrap with PDFProvider\n",
        "+function App() {\n",
        "+  return (\n",
        "+    <PDFProvider>\n",
        "+      <AppContent />\n",
        "+    </PDFProvider>\n",
        "   );\n",
        " }\n",
        " \n"
      ]
    },
    {
      "path": "app/components/Camera.tsx",
      "status": "modified",
      "additions": 101,
      "deletions": 19,
      "patch": "@@ -1,7 +1,12 @@\n import { useRef } from \"react\";\n import Webcam from \"react-webcam\";\n \n-const Camera = ({ onCapture }: { onCapture: (imageSrc: string) => void }) => {\n+interface CameraProps {\n+  onCapture: (imageSrc: string) => void;\n+  onCancel?: () => void;\n+}\n+\n+const Camera = ({ onCapture, onCancel }: CameraProps) => {\n   const webcamRef = useRef<Webcam>(null);\n \n   const capture = () => {\n@@ -20,25 +25,102 @@ const Camera = ({ onCapture }: { onCapture: (imageSrc: string) => void }) => {\n   };\n \n   return (\n-    <div className=\"flex flex-col items-center w-full max-w-2xl mx-auto\">\n-      <h2 className=\"text-lg font-semibold mb-4 text-center\">\n-        Por favor, digitalize a embalagem do seu medicamento\n-      </h2>\n-      <div className=\"w-full aspect-video\">\n-        <Webcam\n-          ref={webcamRef}\n-          screenshotFormat=\"image/jpeg\"\n-          videoConstraints={videoConstraints}\n-          className=\"w-full h-full object-cover rounded-lg\"\n-          screenshotQuality={0.95}\n-        />\n+    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-white flex items-center justify-center p-4\">\n+      <div className=\"max-w-2xl w-full\">\n+        <div className=\"bg-white rounded-2xl shadow-xl p-6 md:p-8\">\n+          {/* Header with back button */}\n+          <div className=\"flex items-center mb-6\">\n+            {onCancel && (\n+              <button\n+                onClick={onCancel}\n+                className=\"mr-4 text-gray-600 hover:text-gray-800 transition-colors\"\n+                aria-label=\"Voltar\"\n+              >\n+                <svg\n+                  className=\"w-6 h-6\"\n+                  fill=\"none\"\n+                  stroke=\"currentColor\"\n+                  viewBox=\"0 0 24 24\"\n+                >\n+                  <path\n+                    strokeLinecap=\"round\"\n+                    strokeLinejoin=\"round\"\n+                    strokeWidth={2}\n+                    d=\"M15 19l-7-7 7-7\"\n+                  />\n+                </svg>\n+              </button>\n+            )}\n+            <div>\n+              <h2 className=\"text-2xl font-bold text-gray-900\">\n+                Digitalizar Medicamento\n+              </h2>\n+              <p className=\"text-sm text-gray-600 mt-1\">\n+                Aponte a c\u00e2mara para a embalagem do medicamento\n+              </p>\n+            </div>\n+          </div>\n+\n+          {/* Camera View */}\n+          <div className=\"w-full aspect-video mb-6\">\n+            <Webcam\n+              ref={webcamRef}\n+              screenshotFormat=\"image/jpeg\"\n+              videoConstraints={videoConstraints}\n+              className=\"w-full h-full object-cover rounded-lg shadow-inner\"\n+              screenshotQuality={0.95}\n+            />\n+          </div>\n+\n+          {/* Tips */}\n+          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6\">\n+            <div className=\"flex items-start\">\n+              <span className=\"text-blue-600 mr-2 mt-0.5\">\ud83d\udca1</span>\n+              <div className=\"text-sm text-blue-900\">\n+                <p className=\"font-medium mb-1\">Dicas para melhor resultado:</p>\n+                <ul className=\"space-y-1 list-disc list-inside\">\n+                  <li>Certifique-se que a embalagem est\u00e1 bem iluminada</li>\n+                  <li>Capture o r\u00f3tulo frontal com nome e dosagem vis\u00edveis</li>\n+                  <li>Mantenha a c\u00e2mara est\u00e1vel</li>\n+                </ul>\n+              </div>\n+            </div>\n+          </div>\n+\n+          {/* Action Buttons */}\n+          <div className=\"flex flex-col sm:flex-row gap-3\">\n+            {onCancel && (\n+              <button\n+                onClick={onCancel}\n+                className=\"flex-1 px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors\"\n+              >\n+                Cancelar\n+              </button>\n+            )}\n+            <button\n+              onClick={capture}\n+              className=\"flex-1 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors shadow-lg hover:shadow-xl\"\n+            >\n+              \ud83d\udcf8 Capturar Imagem\n+            </button>\n+          </div>\n+        </div>\n+\n+        {/* Alternative Option */}\n+        {onCancel && (\n+          <div className=\"text-center mt-6\">\n+            <p className=\"text-sm text-gray-600\">\n+              Dificuldades com a c\u00e2mara?{\" \"}\n+              <button\n+                onClick={onCancel}\n+                className=\"text-blue-600 hover:text-blue-700 font-medium\"\n+              >\n+                Introduzir manualmente\n+              </button>\n+            </p>\n+          </div>\n+        )}\n       </div>\n-      <button\n-        onClick={capture}\n-        className=\"bg-blue-500 text-white px-6 py-3 rounded-md mt-4 text-lg font-medium\"\n-      >\n-        Capturar\n-      </button>\n     </div>\n   );\n };",
      "patch_lines": [
        "@@ -1,7 +1,12 @@\n",
        " import { useRef } from \"react\";\n",
        " import Webcam from \"react-webcam\";\n",
        " \n",
        "-const Camera = ({ onCapture }: { onCapture: (imageSrc: string) => void }) => {\n",
        "+interface CameraProps {\n",
        "+  onCapture: (imageSrc: string) => void;\n",
        "+  onCancel?: () => void;\n",
        "+}\n",
        "+\n",
        "+const Camera = ({ onCapture, onCancel }: CameraProps) => {\n",
        "   const webcamRef = useRef<Webcam>(null);\n",
        " \n",
        "   const capture = () => {\n",
        "@@ -20,25 +25,102 @@ const Camera = ({ onCapture }: { onCapture: (imageSrc: string) => void }) => {\n",
        "   };\n",
        " \n",
        "   return (\n",
        "-    <div className=\"flex flex-col items-center w-full max-w-2xl mx-auto\">\n",
        "-      <h2 className=\"text-lg font-semibold mb-4 text-center\">\n",
        "-        Por favor, digitalize a embalagem do seu medicamento\n",
        "-      </h2>\n",
        "-      <div className=\"w-full aspect-video\">\n",
        "-        <Webcam\n",
        "-          ref={webcamRef}\n",
        "-          screenshotFormat=\"image/jpeg\"\n",
        "-          videoConstraints={videoConstraints}\n",
        "-          className=\"w-full h-full object-cover rounded-lg\"\n",
        "-          screenshotQuality={0.95}\n",
        "-        />\n",
        "+    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-white flex items-center justify-center p-4\">\n",
        "+      <div className=\"max-w-2xl w-full\">\n",
        "+        <div className=\"bg-white rounded-2xl shadow-xl p-6 md:p-8\">\n",
        "+          {/* Header with back button */}\n",
        "+          <div className=\"flex items-center mb-6\">\n",
        "+            {onCancel && (\n",
        "+              <button\n",
        "+                onClick={onCancel}\n",
        "+                className=\"mr-4 text-gray-600 hover:text-gray-800 transition-colors\"\n",
        "+                aria-label=\"Voltar\"\n",
        "+              >\n",
        "+                <svg\n",
        "+                  className=\"w-6 h-6\"\n",
        "+                  fill=\"none\"\n",
        "+                  stroke=\"currentColor\"\n",
        "+                  viewBox=\"0 0 24 24\"\n",
        "+                >\n",
        "+                  <path\n",
        "+                    strokeLinecap=\"round\"\n",
        "+                    strokeLinejoin=\"round\"\n",
        "+                    strokeWidth={2}\n",
        "+                    d=\"M15 19l-7-7 7-7\"\n",
        "+                  />\n",
        "+                </svg>\n",
        "+              </button>\n",
        "+            )}\n",
        "+            <div>\n",
        "+              <h2 className=\"text-2xl font-bold text-gray-900\">\n",
        "+                Digitalizar Medicamento\n",
        "+              </h2>\n",
        "+              <p className=\"text-sm text-gray-600 mt-1\">\n",
        "+                Aponte a c\u00e2mara para a embalagem do medicamento\n",
        "+              </p>\n",
        "+            </div>\n",
        "+          </div>\n",
        "+\n",
        "+          {/* Camera View */}\n",
        "+          <div className=\"w-full aspect-video mb-6\">\n",
        "+            <Webcam\n",
        "+              ref={webcamRef}\n",
        "+              screenshotFormat=\"image/jpeg\"\n",
        "+              videoConstraints={videoConstraints}\n",
        "+              className=\"w-full h-full object-cover rounded-lg shadow-inner\"\n",
        "+              screenshotQuality={0.95}\n",
        "+            />\n",
        "+          </div>\n",
        "+\n",
        "+          {/* Tips */}\n",
        "+          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6\">\n",
        "+            <div className=\"flex items-start\">\n",
        "+              <span className=\"text-blue-600 mr-2 mt-0.5\">\ud83d\udca1</span>\n",
        "+              <div className=\"text-sm text-blue-900\">\n",
        "+                <p className=\"font-medium mb-1\">Dicas para melhor resultado:</p>\n",
        "+                <ul className=\"space-y-1 list-disc list-inside\">\n",
        "+                  <li>Certifique-se que a embalagem est\u00e1 bem iluminada</li>\n",
        "+                  <li>Capture o r\u00f3tulo frontal com nome e dosagem vis\u00edveis</li>\n",
        "+                  <li>Mantenha a c\u00e2mara est\u00e1vel</li>\n",
        "+                </ul>\n",
        "+              </div>\n",
        "+            </div>\n",
        "+          </div>\n",
        "+\n",
        "+          {/* Action Buttons */}\n",
        "+          <div className=\"flex flex-col sm:flex-row gap-3\">\n",
        "+            {onCancel && (\n",
        "+              <button\n",
        "+                onClick={onCancel}\n",
        "+                className=\"flex-1 px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors\"\n",
        "+              >\n",
        "+                Cancelar\n",
        "+              </button>\n",
        "+            )}\n",
        "+            <button\n",
        "+              onClick={capture}\n",
        "+              className=\"flex-1 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors shadow-lg hover:shadow-xl\"\n",
        "+            >\n",
        "+              \ud83d\udcf8 Capturar Imagem\n",
        "+            </button>\n",
        "+          </div>\n",
        "+        </div>\n",
        "+\n",
        "+        {/* Alternative Option */}\n",
        "+        {onCancel && (\n",
        "+          <div className=\"text-center mt-6\">\n",
        "+            <p className=\"text-sm text-gray-600\">\n",
        "+              Dificuldades com a c\u00e2mara?{\" \"}\n",
        "+              <button\n",
        "+                onClick={onCancel}\n",
        "+                className=\"text-blue-600 hover:text-blue-700 font-medium\"\n",
        "+              >\n",
        "+                Introduzir manualmente\n",
        "+              </button>\n",
        "+            </p>\n",
        "+          </div>\n",
        "+        )}\n",
        "       </div>\n",
        "-      <button\n",
        "-        onClick={capture}\n",
        "-        className=\"bg-blue-500 text-white px-6 py-3 rounded-md mt-4 text-lg font-medium\"\n",
        "-      >\n",
        "-        Capturar\n",
        "-      </button>\n",
        "     </div>\n",
        "   );\n",
        " };\n"
      ]
    },
    {
      "path": "app/components/Chat.tsx",
      "status": "modified",
      "additions": 70,
      "deletions": 22,
      "patch": "@@ -1,5 +1,8 @@\n import { useState, useRef, useEffect } from \"react\";\n import { queryLeafletPdf } from \"../server/queryLeaflet\";\n+import { usePDF } from \"../context/PDFContext\";\n+import { useScrollToBottom } from \"../hooks/useScrollToBottom\";\n+import { parseMessageWithReferences } from \"../utils/parseReferences\";\n \n interface ChatMessage {\n   id: string;\n@@ -18,8 +21,15 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n   const [messages, setMessages] = useState<ChatMessage[]>([]);\n   const [question, setQuestion] = useState(\"\");\n   const [loading, setLoading] = useState(false);\n+  const messagesContainerRef = useRef<HTMLDivElement>(null);\n   const messagesEndRef = useRef<HTMLDivElement>(null);\n \n+  const { jumpToPage } = usePDF();\n+  const { showScrollButton, isAtBottom, scrollToBottom } = useScrollToBottom(\n+    messagesContainerRef,\n+    { threshold: 150 }\n+  );\n+\n   // Add initial overview as first message\n   useEffect(() => {\n     if (initialOverview && messages.length === 0) {\n@@ -35,8 +45,14 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n   }, [initialOverview]);\n \n   // Auto-scroll to bottom when new messages are added\n+  // Only auto-scroll if user was already at bottom or if it's their own message\n   useEffect(() => {\n-    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n+    if (messages.length > 0) {\n+      const lastMessage = messages[messages.length - 1];\n+      if (lastMessage.type === \"user\" || isAtBottom) {\n+        scrollToBottom(\"smooth\");\n+      }\n+    }\n   }, [messages]);\n \n   const handleAskQuestion = async () => {\n@@ -92,34 +108,45 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n     \"O que devo fazer se me esquecer de uma dose?\",\n   ];\n \n+  const handlePageReferenceClick = (pageNumber: number) => {\n+    jumpToPage(pageNumber);\n+  };\n+\n   return (\n-    <div className=\"bg-white rounded-lg shadow-md flex flex-col h-140 md:h-160\">\n+    <div className=\"bg-white flex flex-col h-full\">\n       {/* Header */}\n-      <div className=\"p-3 md:p-4 border-b border-gray-200\">\n-        <h3 className=\"text-lg md:text-xl font-bold text-gray-800\">\n+      <div className=\"p-4 border-b border-gray-200 flex-shrink-0\">\n+        <h3 className=\"text-lg font-bold text-gray-800\">\n           Quest\u00f5es sobre {medicineName}\n         </h3>\n       </div>\n \n       {/* Messages */}\n-      <div className=\"flex-1 overflow-y-auto p-3 md:p-4 space-y-3\">\n+      <div\n+        ref={messagesContainerRef}\n+        className=\"flex-1 overflow-y-auto p-4 space-y-4 min-h-0 scrollbar-thin\"\n+      >\n         {messages.map((message) => (\n           <div\n             key={message.id}\n             className={`flex ${message.type === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n           >\n             <div\n-              className={`max-w-[85%] md:max-w-[80%] p-2 md:p-3 rounded-lg ${\n+              className={`max-w-[85%] md:max-w-[75%] p-3 rounded-lg shadow-sm ${\n                 message.type === \"user\"\n                   ? \"bg-blue-600 text-white\"\n                   : \"bg-gray-100 text-gray-800\"\n               }`}\n             >\n-              <p className=\"text-sm md:text-base whitespace-pre-wrap leading-relaxed\">\n-                {message.content}\n-              </p>\n+              <div className=\"text-sm md:text-base leading-relaxed whitespace-pre-wrap\">\n+                {message.type === \"assistant\"\n+                  ? parseMessageWithReferences(message.content, {\n+                      onPageClick: handlePageReferenceClick,\n+                    })\n+                  : message.content}\n+              </div>\n               <p\n-                className={`text-xs mt-1 ${\n+                className={`text-xs mt-1.5 ${\n                   message.type === \"user\" ? \"text-blue-100\" : \"text-gray-500\"\n                 }`}\n               >\n@@ -134,10 +161,10 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n \n         {loading && (\n           <div className=\"flex justify-start\">\n-            <div className=\"bg-gray-100 text-gray-800 p-2 md:p-3 rounded-lg\">\n+            <div className=\"bg-gray-100 text-gray-800 p-3 rounded-lg shadow-sm\">\n               <div className=\"flex items-center space-x-2\">\n-                <div className=\"animate-spin rounded-full h-3 w-3 md:h-4 md:w-4 border-b-2 border-gray-600\"></div>\n-                <span className=\"text-sm md:text-base\">A pensar...</span>\n+                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600\"></div>\n+                <span className=\"text-sm\">A pensar...</span>\n               </div>\n             </div>\n           </div>\n@@ -146,18 +173,39 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n         <div ref={messagesEndRef} />\n       </div>\n \n+      {/* Scroll to bottom button */}\n+      {showScrollButton && (\n+        <button\n+          onClick={() => scrollToBottom(\"smooth\")}\n+          className=\"fixed bottom-24 right-6 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all z-10\"\n+          aria-label=\"Scroll to bottom\"\n+        >\n+          <svg\n+            className=\"w-5 h-5\"\n+            fill=\"none\"\n+            stroke=\"currentColor\"\n+            viewBox=\"0 0 24 24\"\n+          >\n+            <path\n+              strokeLinecap=\"round\"\n+              strokeLinejoin=\"round\"\n+              strokeWidth={2}\n+              d=\"M19 14l-7 7m0 0l-7-7m7 7V3\"\n+            />\n+          </svg>\n+        </button>\n+      )}\n+\n       {/* Sample questions (only show if no messages yet) */}\n       {messages.length <= 1 && (\n-        <div className=\"p-3 md:p-4 border-t border-gray-200\">\n-          <p className=\"text-xs md:text-sm text-gray-600 mb-2\">\n-            Experimente perguntar:\n-          </p>\n-          <div className=\"flex flex-wrap gap-1 md:gap-2\">\n+        <div className=\"p-4 border-t border-gray-200 flex-shrink-0\">\n+          <p className=\"text-sm text-gray-600 mb-2\">Experimente perguntar:</p>\n+          <div className=\"flex flex-wrap gap-2\">\n             {sampleQuestions.map((sampleQ) => (\n               <button\n                 key={sampleQ}\n                 onClick={() => setQuestion(sampleQ)}\n-                className=\"text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-2 py-1 rounded\"\n+                className=\"text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded-lg transition-colors\"\n               >\n                 {sampleQ}\n               </button>\n@@ -167,21 +215,21 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n       )}\n \n       {/* Input */}\n-      <div className=\"p-3 md:p-4 border-t border-gray-200\">\n+      <div className=\"p-4 border-t border-gray-200 flex-shrink-0\">\n         <div className=\"flex space-x-2\">\n           <input\n             type=\"text\"\n             value={question}\n             onChange={(e) => setQuestion(e.target.value)}\n             placeholder=\"Escreva a sua quest\u00e3o aqui...\"\n-            className=\"flex-grow p-2 text-sm md:text-base border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n+            className=\"flex-grow p-3 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n             onKeyPress={(e) => e.key === \"Enter\" && handleAskQuestion()}\n             disabled={loading}\n           />\n           <button\n             onClick={handleAskQuestion}\n             disabled={loading || !question.trim()}\n-            className=\"bg-blue-600 text-white px-3 md:px-4 py-2 text-sm md:text-base rounded hover:bg-blue-700 disabled:bg-gray-400\"\n+            className=\"bg-blue-600 text-white px-6 py-3 text-sm font-medium rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors\"\n           >\n             Enviar\n           </button>",
      "patch_lines": [
        "@@ -1,5 +1,8 @@\n",
        " import { useState, useRef, useEffect } from \"react\";\n",
        " import { queryLeafletPdf } from \"../server/queryLeaflet\";\n",
        "+import { usePDF } from \"../context/PDFContext\";\n",
        "+import { useScrollToBottom } from \"../hooks/useScrollToBottom\";\n",
        "+import { parseMessageWithReferences } from \"../utils/parseReferences\";\n",
        " \n",
        " interface ChatMessage {\n",
        "   id: string;\n",
        "@@ -18,8 +21,15 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n",
        "   const [messages, setMessages] = useState<ChatMessage[]>([]);\n",
        "   const [question, setQuestion] = useState(\"\");\n",
        "   const [loading, setLoading] = useState(false);\n",
        "+  const messagesContainerRef = useRef<HTMLDivElement>(null);\n",
        "   const messagesEndRef = useRef<HTMLDivElement>(null);\n",
        " \n",
        "+  const { jumpToPage } = usePDF();\n",
        "+  const { showScrollButton, isAtBottom, scrollToBottom } = useScrollToBottom(\n",
        "+    messagesContainerRef,\n",
        "+    { threshold: 150 }\n",
        "+  );\n",
        "+\n",
        "   // Add initial overview as first message\n",
        "   useEffect(() => {\n",
        "     if (initialOverview && messages.length === 0) {\n",
        "@@ -35,8 +45,14 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n",
        "   }, [initialOverview]);\n",
        " \n",
        "   // Auto-scroll to bottom when new messages are added\n",
        "+  // Only auto-scroll if user was already at bottom or if it's their own message\n",
        "   useEffect(() => {\n",
        "-    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n",
        "+    if (messages.length > 0) {\n",
        "+      const lastMessage = messages[messages.length - 1];\n",
        "+      if (lastMessage.type === \"user\" || isAtBottom) {\n",
        "+        scrollToBottom(\"smooth\");\n",
        "+      }\n",
        "+    }\n",
        "   }, [messages]);\n",
        " \n",
        "   const handleAskQuestion = async () => {\n",
        "@@ -92,34 +108,45 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n",
        "     \"O que devo fazer se me esquecer de uma dose?\",\n",
        "   ];\n",
        " \n",
        "+  const handlePageReferenceClick = (pageNumber: number) => {\n",
        "+    jumpToPage(pageNumber);\n",
        "+  };\n",
        "+\n",
        "   return (\n",
        "-    <div className=\"bg-white rounded-lg shadow-md flex flex-col h-140 md:h-160\">\n",
        "+    <div className=\"bg-white flex flex-col h-full\">\n",
        "       {/* Header */}\n",
        "-      <div className=\"p-3 md:p-4 border-b border-gray-200\">\n",
        "-        <h3 className=\"text-lg md:text-xl font-bold text-gray-800\">\n",
        "+      <div className=\"p-4 border-b border-gray-200 flex-shrink-0\">\n",
        "+        <h3 className=\"text-lg font-bold text-gray-800\">\n",
        "           Quest\u00f5es sobre {medicineName}\n",
        "         </h3>\n",
        "       </div>\n",
        " \n",
        "       {/* Messages */}\n",
        "-      <div className=\"flex-1 overflow-y-auto p-3 md:p-4 space-y-3\">\n",
        "+      <div\n",
        "+        ref={messagesContainerRef}\n",
        "+        className=\"flex-1 overflow-y-auto p-4 space-y-4 min-h-0 scrollbar-thin\"\n",
        "+      >\n",
        "         {messages.map((message) => (\n",
        "           <div\n",
        "             key={message.id}\n",
        "             className={`flex ${message.type === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n",
        "           >\n",
        "             <div\n",
        "-              className={`max-w-[85%] md:max-w-[80%] p-2 md:p-3 rounded-lg ${\n",
        "+              className={`max-w-[85%] md:max-w-[75%] p-3 rounded-lg shadow-sm ${\n",
        "                 message.type === \"user\"\n",
        "                   ? \"bg-blue-600 text-white\"\n",
        "                   : \"bg-gray-100 text-gray-800\"\n",
        "               }`}\n",
        "             >\n",
        "-              <p className=\"text-sm md:text-base whitespace-pre-wrap leading-relaxed\">\n",
        "-                {message.content}\n",
        "-              </p>\n",
        "+              <div className=\"text-sm md:text-base leading-relaxed whitespace-pre-wrap\">\n",
        "+                {message.type === \"assistant\"\n",
        "+                  ? parseMessageWithReferences(message.content, {\n",
        "+                      onPageClick: handlePageReferenceClick,\n",
        "+                    })\n",
        "+                  : message.content}\n",
        "+              </div>\n",
        "               <p\n",
        "-                className={`text-xs mt-1 ${\n",
        "+                className={`text-xs mt-1.5 ${\n",
        "                   message.type === \"user\" ? \"text-blue-100\" : \"text-gray-500\"\n",
        "                 }`}\n",
        "               >\n",
        "@@ -134,10 +161,10 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n",
        " \n",
        "         {loading && (\n",
        "           <div className=\"flex justify-start\">\n",
        "-            <div className=\"bg-gray-100 text-gray-800 p-2 md:p-3 rounded-lg\">\n",
        "+            <div className=\"bg-gray-100 text-gray-800 p-3 rounded-lg shadow-sm\">\n",
        "               <div className=\"flex items-center space-x-2\">\n",
        "-                <div className=\"animate-spin rounded-full h-3 w-3 md:h-4 md:w-4 border-b-2 border-gray-600\"></div>\n",
        "-                <span className=\"text-sm md:text-base\">A pensar...</span>\n",
        "+                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600\"></div>\n",
        "+                <span className=\"text-sm\">A pensar...</span>\n",
        "               </div>\n",
        "             </div>\n",
        "           </div>\n",
        "@@ -146,18 +173,39 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n",
        "         <div ref={messagesEndRef} />\n",
        "       </div>\n",
        " \n",
        "+      {/* Scroll to bottom button */}\n",
        "+      {showScrollButton && (\n",
        "+        <button\n",
        "+          onClick={() => scrollToBottom(\"smooth\")}\n",
        "+          className=\"fixed bottom-24 right-6 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all z-10\"\n",
        "+          aria-label=\"Scroll to bottom\"\n",
        "+        >\n",
        "+          <svg\n",
        "+            className=\"w-5 h-5\"\n",
        "+            fill=\"none\"\n",
        "+            stroke=\"currentColor\"\n",
        "+            viewBox=\"0 0 24 24\"\n",
        "+          >\n",
        "+            <path\n",
        "+              strokeLinecap=\"round\"\n",
        "+              strokeLinejoin=\"round\"\n",
        "+              strokeWidth={2}\n",
        "+              d=\"M19 14l-7 7m0 0l-7-7m7 7V3\"\n",
        "+            />\n",
        "+          </svg>\n",
        "+        </button>\n",
        "+      )}\n",
        "+\n",
        "       {/* Sample questions (only show if no messages yet) */}\n",
        "       {messages.length <= 1 && (\n",
        "-        <div className=\"p-3 md:p-4 border-t border-gray-200\">\n",
        "-          <p className=\"text-xs md:text-sm text-gray-600 mb-2\">\n",
        "-            Experimente perguntar:\n",
        "-          </p>\n",
        "-          <div className=\"flex flex-wrap gap-1 md:gap-2\">\n",
        "+        <div className=\"p-4 border-t border-gray-200 flex-shrink-0\">\n",
        "+          <p className=\"text-sm text-gray-600 mb-2\">Experimente perguntar:</p>\n",
        "+          <div className=\"flex flex-wrap gap-2\">\n",
        "             {sampleQuestions.map((sampleQ) => (\n",
        "               <button\n",
        "                 key={sampleQ}\n",
        "                 onClick={() => setQuestion(sampleQ)}\n",
        "-                className=\"text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-2 py-1 rounded\"\n",
        "+                className=\"text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded-lg transition-colors\"\n",
        "               >\n",
        "                 {sampleQ}\n",
        "               </button>\n",
        "@@ -167,21 +215,21 @@ const Chat = ({ pdfData, medicineName, initialOverview }: ChatProps) => {\n",
        "       )}\n",
        " \n",
        "       {/* Input */}\n",
        "-      <div className=\"p-3 md:p-4 border-t border-gray-200\">\n",
        "+      <div className=\"p-4 border-t border-gray-200 flex-shrink-0\">\n",
        "         <div className=\"flex space-x-2\">\n",
        "           <input\n",
        "             type=\"text\"\n",
        "             value={question}\n",
        "             onChange={(e) => setQuestion(e.target.value)}\n",
        "             placeholder=\"Escreva a sua quest\u00e3o aqui...\"\n",
        "-            className=\"flex-grow p-2 text-sm md:text-base border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n",
        "+            className=\"flex-grow p-3 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n",
        "             onKeyPress={(e) => e.key === \"Enter\" && handleAskQuestion()}\n",
        "             disabled={loading}\n",
        "           />\n",
        "           <button\n",
        "             onClick={handleAskQuestion}\n",
        "             disabled={loading || !question.trim()}\n",
        "-            className=\"bg-blue-600 text-white px-3 md:px-4 py-2 text-sm md:text-base rounded hover:bg-blue-700 disabled:bg-gray-400\"\n",
        "+            className=\"bg-blue-600 text-white px-6 py-3 text-sm font-medium rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors\"\n",
        "           >\n",
        "             Enviar\n",
        "           </button>\n"
      ]
    },
    {
      "path": "app/components/LandingPage.tsx",
      "status": "added",
      "additions": 156,
      "deletions": 0,
      "patch": "@@ -0,0 +1,156 @@\n+interface LandingPageProps {\n+  onScanMedicine: () => void;\n+  onManualEntry: () => void;\n+}\n+\n+const LandingPage = ({ onScanMedicine, onManualEntry }: LandingPageProps) => {\n+  return (\n+    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-white flex items-center justify-center p-4\">\n+      <div className=\"max-w-4xl w-full\">\n+        {/* Header */}\n+        <div className=\"text-center mb-12\">\n+          <div className=\"inline-flex items-center justify-center w-20 h-20 bg-blue-600 rounded-2xl mb-6 shadow-lg\">\n+            <span className=\"text-4xl\">\ud83e\udd16</span>\n+          </div>\n+          <h1 className=\"text-4xl md:text-5xl font-bold text-gray-900 mb-4\">\n+            MedaBot\n+          </h1>\n+          <p className=\"text-xl md:text-2xl text-gray-600 max-w-2xl mx-auto\">\n+            Obtenha informa\u00e7\u00f5es fi\u00e1veis sobre medicamentos a partir dos folhetos\n+            oficiais\n+          </p>\n+        </div>\n+\n+        {/* Value Proposition */}\n+        <div className=\"bg-white rounded-2xl shadow-xl p-8 md:p-12 mb-8\">\n+          <h2 className=\"text-2xl font-bold text-gray-900 mb-6 text-center\">\n+            Como funciona?\n+          </h2>\n+\n+          <div className=\"grid md:grid-cols-3 gap-6 mb-8\">\n+            {/* Step 1 */}\n+            <div className=\"text-center\">\n+              <div className=\"inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4\">\n+                <span className=\"text-3xl\">\ud83d\udd0d</span>\n+              </div>\n+              <h3 className=\"font-semibold text-gray-900 mb-2\">\n+                1. Identifique\n+              </h3>\n+              <p className=\"text-sm text-gray-600\">\n+                Digitalize ou introduza manualmente os dados do medicamento\n+              </p>\n+            </div>\n+\n+            {/* Step 2 */}\n+            <div className=\"text-center\">\n+              <div className=\"inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4\">\n+                <span className=\"text-3xl\">\ud83d\udcc4</span>\n+              </div>\n+              <h3 className=\"font-semibold text-gray-900 mb-2\">\n+                2. Processe\n+              </h3>\n+              <p className=\"text-sm text-gray-600\">\n+                Obtemos o folheto oficial e processamos com IA\n+              </p>\n+            </div>\n+\n+            {/* Step 3 */}\n+            <div className=\"text-center\">\n+              <div className=\"inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4\">\n+                <span className=\"text-3xl\">\ud83d\udcac</span>\n+              </div>\n+              <h3 className=\"font-semibold text-gray-900 mb-3\">3. Questione</h3>\n+              <p className=\"text-sm text-gray-600\">\n+                Fa\u00e7a perguntas e receba respostas baseadas no folheto\n+              </p>\n+            </div>\n+          </div>\n+\n+          {/* Key Features */}\n+          <div className=\"bg-blue-50 rounded-xl p-6 mb-8\">\n+            <h3 className=\"font-semibold text-gray-900 mb-4 flex items-center\">\n+              <span className=\"mr-2\">\u2728</span>\n+              Caracter\u00edsticas principais\n+            </h3>\n+            <ul className=\"space-y-2 text-sm text-gray-700\">\n+              <li className=\"flex items-start\">\n+                <span className=\"text-green-600 mr-2 mt-0.5\">\u2713</span>\n+                <span>\n+                  <strong>Informa\u00e7\u00e3o oficial:</strong> Apenas dados do folheto\n+                  informativo regulamentar\n+                </span>\n+              </li>\n+              <li className=\"flex items-start\">\n+                <span className=\"text-green-600 mr-2 mt-0.5\">\u2713</span>\n+                <span>\n+                  <strong>Cita\u00e7\u00f5es de p\u00e1gina:</strong> Refer\u00eancias diretas \u00e0s\n+                  sec\u00e7\u00f5es do folheto\n+                </span>\n+              </li>\n+              <li className=\"flex items-start\">\n+                <span className=\"text-green-600 mr-2 mt-0.5\">\u2713</span>\n+                <span>\n+                  <strong>Visualiza\u00e7\u00e3o do PDF:</strong> Consulte o folheto\n+                  completo em paralelo\n+                </span>\n+              </li>\n+              <li className=\"flex items-start\">\n+                <span className=\"text-green-600 mr-2 mt-0.5\">\u2713</span>\n+                <span>\n+                  <strong>Respostas instant\u00e2neas:</strong> IA processa e\n+                  responde em segundos\n+                </span>\n+              </li>\n+            </ul>\n+          </div>\n+\n+          {/* Action Buttons */}\n+          <div className=\"grid md:grid-cols-2 gap-4\">\n+            <button\n+              onClick={onScanMedicine}\n+              className=\"group relative bg-blue-600 hover:bg-blue-700 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1\"\n+            >\n+              <div className=\"flex flex-col items-center\">\n+                <span className=\"text-4xl mb-3\">\ud83d\udcf8</span>\n+                <span className=\"text-xl font-bold mb-2\">\n+                  Digitalizar Medicamento\n+                </span>\n+                <span className=\"text-sm text-blue-100\">\n+                  Use a c\u00e2mara para identificar\n+                </span>\n+              </div>\n+              <div className=\"absolute inset-0 bg-white opacity-0 group-hover:opacity-10 rounded-xl transition-opacity\"></div>\n+            </button>\n+\n+            <button\n+              onClick={onManualEntry}\n+              className=\"group relative bg-gray-700 hover:bg-gray-800 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1\"\n+            >\n+              <div className=\"flex flex-col items-center\">\n+                <span className=\"text-4xl mb-3\">\u270d\ufe0f</span>\n+                <span className=\"text-xl font-bold mb-2\">\n+                  Introduzir Manualmente\n+                </span>\n+                <span className=\"text-sm text-gray-300\">\n+                  Escrever os dados do medicamento\n+                </span>\n+              </div>\n+              <div className=\"absolute inset-0 bg-white opacity-0 group-hover:opacity-10 rounded-xl transition-opacity\"></div>\n+            </button>\n+          </div>\n+        </div>\n+\n+        {/* Disclaimer */}\n+        <div className=\"text-center text-sm text-gray-600\">\n+          <p className=\"flex items-center justify-center\">\n+            <span className=\"mr-2\">\u2139\ufe0f</span>\n+            Este servi\u00e7o fornece informa\u00e7\u00e3o educativa. Consulte sempre um\n+            profissional de sa\u00fade para aconselhamento m\u00e9dico.\n+          </p>\n+        </div>\n+      </div>\n+    </div>\n+  );\n+};\n+\n+export default LandingPage;",
      "patch_lines": [
        "@@ -0,0 +1,156 @@\n",
        "+interface LandingPageProps {\n",
        "+  onScanMedicine: () => void;\n",
        "+  onManualEntry: () => void;\n",
        "+}\n",
        "+\n",
        "+const LandingPage = ({ onScanMedicine, onManualEntry }: LandingPageProps) => {\n",
        "+  return (\n",
        "+    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-white flex items-center justify-center p-4\">\n",
        "+      <div className=\"max-w-4xl w-full\">\n",
        "+        {/* Header */}\n",
        "+        <div className=\"text-center mb-12\">\n",
        "+          <div className=\"inline-flex items-center justify-center w-20 h-20 bg-blue-600 rounded-2xl mb-6 shadow-lg\">\n",
        "+            <span className=\"text-4xl\">\ud83e\udd16</span>\n",
        "+          </div>\n",
        "+          <h1 className=\"text-4xl md:text-5xl font-bold text-gray-900 mb-4\">\n",
        "+            MedaBot\n",
        "+          </h1>\n",
        "+          <p className=\"text-xl md:text-2xl text-gray-600 max-w-2xl mx-auto\">\n",
        "+            Obtenha informa\u00e7\u00f5es fi\u00e1veis sobre medicamentos a partir dos folhetos\n",
        "+            oficiais\n",
        "+          </p>\n",
        "+        </div>\n",
        "+\n",
        "+        {/* Value Proposition */}\n",
        "+        <div className=\"bg-white rounded-2xl shadow-xl p-8 md:p-12 mb-8\">\n",
        "+          <h2 className=\"text-2xl font-bold text-gray-900 mb-6 text-center\">\n",
        "+            Como funciona?\n",
        "+          </h2>\n",
        "+\n",
        "+          <div className=\"grid md:grid-cols-3 gap-6 mb-8\">\n",
        "+            {/* Step 1 */}\n",
        "+            <div className=\"text-center\">\n",
        "+              <div className=\"inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4\">\n",
        "+                <span className=\"text-3xl\">\ud83d\udd0d</span>\n",
        "+              </div>\n",
        "+              <h3 className=\"font-semibold text-gray-900 mb-2\">\n",
        "+                1. Identifique\n",
        "+              </h3>\n",
        "+              <p className=\"text-sm text-gray-600\">\n",
        "+                Digitalize ou introduza manualmente os dados do medicamento\n",
        "+              </p>\n",
        "+            </div>\n",
        "+\n",
        "+            {/* Step 2 */}\n",
        "+            <div className=\"text-center\">\n",
        "+              <div className=\"inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4\">\n",
        "+                <span className=\"text-3xl\">\ud83d\udcc4</span>\n",
        "+              </div>\n",
        "+              <h3 className=\"font-semibold text-gray-900 mb-2\">\n",
        "+                2. Processe\n",
        "+              </h3>\n",
        "+              <p className=\"text-sm text-gray-600\">\n",
        "+                Obtemos o folheto oficial e processamos com IA\n",
        "+              </p>\n",
        "+            </div>\n",
        "+\n",
        "+            {/* Step 3 */}\n",
        "+            <div className=\"text-center\">\n",
        "+              <div className=\"inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4\">\n",
        "+                <span className=\"text-3xl\">\ud83d\udcac</span>\n",
        "+              </div>\n",
        "+              <h3 className=\"font-semibold text-gray-900 mb-3\">3. Questione</h3>\n",
        "+              <p className=\"text-sm text-gray-600\">\n",
        "+                Fa\u00e7a perguntas e receba respostas baseadas no folheto\n",
        "+              </p>\n",
        "+            </div>\n",
        "+          </div>\n",
        "+\n",
        "+          {/* Key Features */}\n",
        "+          <div className=\"bg-blue-50 rounded-xl p-6 mb-8\">\n",
        "+            <h3 className=\"font-semibold text-gray-900 mb-4 flex items-center\">\n",
        "+              <span className=\"mr-2\">\u2728</span>\n",
        "+              Caracter\u00edsticas principais\n",
        "+            </h3>\n",
        "+            <ul className=\"space-y-2 text-sm text-gray-700\">\n",
        "+              <li className=\"flex items-start\">\n",
        "+                <span className=\"text-green-600 mr-2 mt-0.5\">\u2713</span>\n",
        "+                <span>\n",
        "+                  <strong>Informa\u00e7\u00e3o oficial:</strong> Apenas dados do folheto\n",
        "+                  informativo regulamentar\n",
        "+                </span>\n",
        "+              </li>\n",
        "+              <li className=\"flex items-start\">\n",
        "+                <span className=\"text-green-600 mr-2 mt-0.5\">\u2713</span>\n",
        "+                <span>\n",
        "+                  <strong>Cita\u00e7\u00f5es de p\u00e1gina:</strong> Refer\u00eancias diretas \u00e0s\n",
        "+                  sec\u00e7\u00f5es do folheto\n",
        "+                </span>\n",
        "+              </li>\n",
        "+              <li className=\"flex items-start\">\n",
        "+                <span className=\"text-green-600 mr-2 mt-0.5\">\u2713</span>\n",
        "+                <span>\n",
        "+                  <strong>Visualiza\u00e7\u00e3o do PDF:</strong> Consulte o folheto\n",
        "+                  completo em paralelo\n",
        "+                </span>\n",
        "+              </li>\n",
        "+              <li className=\"flex items-start\">\n",
        "+                <span className=\"text-green-600 mr-2 mt-0.5\">\u2713</span>\n",
        "+                <span>\n",
        "+                  <strong>Respostas instant\u00e2neas:</strong> IA processa e\n",
        "+                  responde em segundos\n",
        "+                </span>\n",
        "+              </li>\n",
        "+            </ul>\n",
        "+          </div>\n",
        "+\n",
        "+          {/* Action Buttons */}\n",
        "+          <div className=\"grid md:grid-cols-2 gap-4\">\n",
        "+            <button\n",
        "+              onClick={onScanMedicine}\n",
        "+              className=\"group relative bg-blue-600 hover:bg-blue-700 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1\"\n",
        "+            >\n",
        "+              <div className=\"flex flex-col items-center\">\n",
        "+                <span className=\"text-4xl mb-3\">\ud83d\udcf8</span>\n",
        "+                <span className=\"text-xl font-bold mb-2\">\n",
        "+                  Digitalizar Medicamento\n",
        "+                </span>\n",
        "+                <span className=\"text-sm text-blue-100\">\n",
        "+                  Use a c\u00e2mara para identificar\n",
        "+                </span>\n",
        "+              </div>\n",
        "+              <div className=\"absolute inset-0 bg-white opacity-0 group-hover:opacity-10 rounded-xl transition-opacity\"></div>\n",
        "+            </button>\n",
        "+\n",
        "+            <button\n",
        "+              onClick={onManualEntry}\n",
        "+              className=\"group relative bg-gray-700 hover:bg-gray-800 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1\"\n",
        "+            >\n",
        "+              <div className=\"flex flex-col items-center\">\n",
        "+                <span className=\"text-4xl mb-3\">\u270d\ufe0f</span>\n",
        "+                <span className=\"text-xl font-bold mb-2\">\n",
        "+                  Introduzir Manualmente\n",
        "+                </span>\n",
        "+                <span className=\"text-sm text-gray-300\">\n",
        "+                  Escrever os dados do medicamento\n",
        "+                </span>\n",
        "+              </div>\n",
        "+              <div className=\"absolute inset-0 bg-white opacity-0 group-hover:opacity-10 rounded-xl transition-opacity\"></div>\n",
        "+            </button>\n",
        "+          </div>\n",
        "+        </div>\n",
        "+\n",
        "+        {/* Disclaimer */}\n",
        "+        <div className=\"text-center text-sm text-gray-600\">\n",
        "+          <p className=\"flex items-center justify-center\">\n",
        "+            <span className=\"mr-2\">\u2139\ufe0f</span>\n",
        "+            Este servi\u00e7o fornece informa\u00e7\u00e3o educativa. Consulte sempre um\n",
        "+            profissional de sa\u00fade para aconselhamento m\u00e9dico.\n",
        "+          </p>\n",
        "+        </div>\n",
        "+      </div>\n",
        "+    </div>\n",
        "+  );\n",
        "+};\n",
        "+\n",
        "+export default LandingPage;\n"
      ]
    },
    {
      "path": "app/components/ManualMedicineForm.tsx",
      "status": "added",
      "additions": 240,
      "deletions": 0,
      "patch": "@@ -0,0 +1,240 @@\n+import { useState } from \"react\";\n+import { IdentifyMedicineResponse } from \"../core/identify\";\n+\n+interface ManualMedicineFormProps {\n+  onSubmit: (data: IdentifyMedicineResponse) => void;\n+  onCancel: () => void;\n+  initialData?: Partial<IdentifyMedicineResponse>;\n+}\n+\n+const ManualMedicineForm = ({\n+  onSubmit,\n+  onCancel,\n+  initialData,\n+}: ManualMedicineFormProps) => {\n+  const [formData, setFormData] = useState<IdentifyMedicineResponse>({\n+    name: initialData?.name || \"\",\n+    activeSubstance: initialData?.activeSubstance || \"\",\n+    brand: initialData?.brand || \"\",\n+    dosage: initialData?.dosage || \"\",\n+  });\n+\n+  const [errors, setErrors] = useState<{ [key: string]: string }>({});\n+\n+  const handleChange = (field: keyof IdentifyMedicineResponse, value: string) => {\n+    setFormData((prev) => ({ ...prev, [field]: value }));\n+    // Clear error when user types\n+    if (errors[field]) {\n+      setErrors((prev) => ({ ...prev, [field]: \"\" }));\n+    }\n+  };\n+\n+  const validateForm = (): boolean => {\n+    const newErrors: { [key: string]: string } = {};\n+\n+    if (!formData.name.trim()) {\n+      newErrors.name = \"Nome do medicamento \u00e9 obrigat\u00f3rio\";\n+    }\n+\n+    if (!formData.activeSubstance.trim()) {\n+      newErrors.activeSubstance = \"Subst\u00e2ncia activa \u00e9 obrigat\u00f3ria\";\n+    }\n+\n+    setErrors(newErrors);\n+    return Object.keys(newErrors).length === 0;\n+  };\n+\n+  const handleSubmit = (e: React.FormEvent) => {\n+    e.preventDefault();\n+\n+    if (validateForm()) {\n+      onSubmit(formData);\n+    }\n+  };\n+\n+  return (\n+    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-white flex items-center justify-center p-4\">\n+      <div className=\"max-w-2xl w-full\">\n+        <div className=\"bg-white rounded-2xl shadow-xl p-6 md:p-8\">\n+          {/* Header */}\n+          <div className=\"flex items-center mb-6\">\n+            <button\n+              onClick={onCancel}\n+              className=\"mr-4 text-gray-600 hover:text-gray-800 transition-colors\"\n+              aria-label=\"Voltar\"\n+            >\n+              <svg\n+                className=\"w-6 h-6\"\n+                fill=\"none\"\n+                stroke=\"currentColor\"\n+                viewBox=\"0 0 24 24\"\n+              >\n+                <path\n+                  strokeLinecap=\"round\"\n+                  strokeLinejoin=\"round\"\n+                  strokeWidth={2}\n+                  d=\"M15 19l-7-7 7-7\"\n+                />\n+              </svg>\n+            </button>\n+            <div>\n+              <h2 className=\"text-2xl font-bold text-gray-900\">\n+                Introduzir Dados do Medicamento\n+              </h2>\n+              <p className=\"text-sm text-gray-600 mt-1\">\n+                Preencha os campos com a informa\u00e7\u00e3o da embalagem\n+              </p>\n+            </div>\n+          </div>\n+\n+          <form onSubmit={handleSubmit} className=\"space-y-6\">\n+            {/* Name Field */}\n+            <div>\n+              <label\n+                htmlFor=\"name\"\n+                className=\"block text-sm font-semibold text-gray-700 mb-2\"\n+              >\n+                Nome do Medicamento <span className=\"text-red-500\">*</span>\n+              </label>\n+              <input\n+                type=\"text\"\n+                id=\"name\"\n+                value={formData.name}\n+                onChange={(e) => handleChange(\"name\", e.target.value)}\n+                placeholder=\"Ex: Paracetamol\"\n+                className={`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors ${\n+                  errors.name\n+                    ? \"border-red-300 bg-red-50\"\n+                    : \"border-gray-300 bg-white\"\n+                }`}\n+              />\n+              {errors.name && (\n+                <p className=\"mt-1 text-sm text-red-600\">{errors.name}</p>\n+              )}\n+            </div>\n+\n+            {/* Active Substance Field */}\n+            <div>\n+              <label\n+                htmlFor=\"activeSubstance\"\n+                className=\"block text-sm font-semibold text-gray-700 mb-2\"\n+              >\n+                Subst\u00e2ncia Activa <span className=\"text-red-500\">*</span>\n+              </label>\n+              <input\n+                type=\"text\"\n+                id=\"activeSubstance\"\n+                value={formData.activeSubstance}\n+                onChange={(e) => handleChange(\"activeSubstance\", e.target.value)}\n+                placeholder=\"Ex: Paracetamol\"\n+                className={`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors ${\n+                  errors.activeSubstance\n+                    ? \"border-red-300 bg-red-50\"\n+                    : \"border-gray-300 bg-white\"\n+                }`}\n+              />\n+              {errors.activeSubstance && (\n+                <p className=\"mt-1 text-sm text-red-600\">\n+                  {errors.activeSubstance}\n+                </p>\n+              )}\n+              <p className=\"mt-1 text-xs text-gray-500\">\n+                Encontra-se geralmente na embalagem junto ao nome\n+              </p>\n+            </div>\n+\n+            {/* Brand Field */}\n+            <div>\n+              <label\n+                htmlFor=\"brand\"\n+                className=\"block text-sm font-semibold text-gray-700 mb-2\"\n+              >\n+                Marca\n+              </label>\n+              <input\n+                type=\"text\"\n+                id=\"brand\"\n+                value={formData.brand}\n+                onChange={(e) => handleChange(\"brand\", e.target.value)}\n+                placeholder=\"Ex: Gen\u00e9rico, Ben-u-ron (opcional)\"\n+                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors\"\n+              />\n+              <p className=\"mt-1 text-xs text-gray-500\">\n+                Pode deixar em branco se n\u00e3o souber\n+              </p>\n+            </div>\n+\n+            {/* Dosage Field */}\n+            <div>\n+              <label\n+                htmlFor=\"dosage\"\n+                className=\"block text-sm font-semibold text-gray-700 mb-2\"\n+              >\n+                Dosagem\n+              </label>\n+              <input\n+                type=\"text\"\n+                id=\"dosage\"\n+                value={formData.dosage}\n+                onChange={(e) => handleChange(\"dosage\", e.target.value)}\n+                placeholder=\"Ex: 500mg, 1g (opcional)\"\n+                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors\"\n+              />\n+              <p className=\"mt-1 text-xs text-gray-500\">\n+                Indica a quantidade de subst\u00e2ncia activa\n+              </p>\n+            </div>\n+\n+            {/* Info Box */}\n+            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n+              <div className=\"flex items-start\">\n+                <span className=\"text-blue-600 mr-2 mt-0.5\">\ud83d\udca1</span>\n+                <div className=\"text-sm text-blue-900\">\n+                  <p className=\"font-medium mb-1\">Dica:</p>\n+                  <p>\n+                    Os campos <strong>Nome</strong> e{\" \"}\n+                    <strong>Subst\u00e2ncia Activa</strong> s\u00e3o suficientes para\n+                    encontrar o folheto. Os outros campos ajudam a identificar\n+                    o medicamento espec\u00edfico se existirem v\u00e1rias op\u00e7\u00f5es.\n+                  </p>\n+                </div>\n+              </div>\n+            </div>\n+\n+            {/* Action Buttons */}\n+            <div className=\"flex flex-col sm:flex-row gap-3 pt-4\">\n+              <button\n+                type=\"button\"\n+                onClick={onCancel}\n+                className=\"flex-1 px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors\"\n+              >\n+                Cancelar\n+              </button>\n+              <button\n+                type=\"submit\"\n+                className=\"flex-1 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors shadow-lg hover:shadow-xl\"\n+              >\n+                Procurar Medicamento\n+              </button>\n+            </div>\n+          </form>\n+        </div>\n+\n+        {/* Alternative Option */}\n+        <div className=\"text-center mt-6\">\n+          <p className=\"text-sm text-gray-600\">\n+            Prefere digitalizar a embalagem?{\" \"}\n+            <button\n+              onClick={onCancel}\n+              className=\"text-blue-600 hover:text-blue-700 font-medium\"\n+            >\n+              Usar c\u00e2mara\n+            </button>\n+          </p>\n+        </div>\n+      </div>\n+    </div>\n+  );\n+};\n+\n+export default ManualMedicineForm;",
      "patch_lines": [
        "@@ -0,0 +1,240 @@\n",
        "+import { useState } from \"react\";\n",
        "+import { IdentifyMedicineResponse } from \"../core/identify\";\n",
        "+\n",
        "+interface ManualMedicineFormProps {\n",
        "+  onSubmit: (data: IdentifyMedicineResponse) => void;\n",
        "+  onCancel: () => void;\n",
        "+  initialData?: Partial<IdentifyMedicineResponse>;\n",
        "+}\n",
        "+\n",
        "+const ManualMedicineForm = ({\n",
        "+  onSubmit,\n",
        "+  onCancel,\n",
        "+  initialData,\n",
        "+}: ManualMedicineFormProps) => {\n",
        "+  const [formData, setFormData] = useState<IdentifyMedicineResponse>({\n",
        "+    name: initialData?.name || \"\",\n",
        "+    activeSubstance: initialData?.activeSubstance || \"\",\n",
        "+    brand: initialData?.brand || \"\",\n",
        "+    dosage: initialData?.dosage || \"\",\n",
        "+  });\n",
        "+\n",
        "+  const [errors, setErrors] = useState<{ [key: string]: string }>({});\n",
        "+\n",
        "+  const handleChange = (field: keyof IdentifyMedicineResponse, value: string) => {\n",
        "+    setFormData((prev) => ({ ...prev, [field]: value }));\n",
        "+    // Clear error when user types\n",
        "+    if (errors[field]) {\n",
        "+      setErrors((prev) => ({ ...prev, [field]: \"\" }));\n",
        "+    }\n",
        "+  };\n",
        "+\n",
        "+  const validateForm = (): boolean => {\n",
        "+    const newErrors: { [key: string]: string } = {};\n",
        "+\n",
        "+    if (!formData.name.trim()) {\n",
        "+      newErrors.name = \"Nome do medicamento \u00e9 obrigat\u00f3rio\";\n",
        "+    }\n",
        "+\n",
        "+    if (!formData.activeSubstance.trim()) {\n",
        "+      newErrors.activeSubstance = \"Subst\u00e2ncia activa \u00e9 obrigat\u00f3ria\";\n",
        "+    }\n",
        "+\n",
        "+    setErrors(newErrors);\n",
        "+    return Object.keys(newErrors).length === 0;\n",
        "+  };\n",
        "+\n",
        "+  const handleSubmit = (e: React.FormEvent) => {\n",
        "+    e.preventDefault();\n",
        "+\n",
        "+    if (validateForm()) {\n",
        "+      onSubmit(formData);\n",
        "+    }\n",
        "+  };\n",
        "+\n",
        "+  return (\n",
        "+    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-white flex items-center justify-center p-4\">\n",
        "+      <div className=\"max-w-2xl w-full\">\n",
        "+        <div className=\"bg-white rounded-2xl shadow-xl p-6 md:p-8\">\n",
        "+          {/* Header */}\n",
        "+          <div className=\"flex items-center mb-6\">\n",
        "+            <button\n",
        "+              onClick={onCancel}\n",
        "+              className=\"mr-4 text-gray-600 hover:text-gray-800 transition-colors\"\n",
        "+              aria-label=\"Voltar\"\n",
        "+            >\n",
        "+              <svg\n",
        "+                className=\"w-6 h-6\"\n",
        "+                fill=\"none\"\n",
        "+                stroke=\"currentColor\"\n",
        "+                viewBox=\"0 0 24 24\"\n",
        "+              >\n",
        "+                <path\n",
        "+                  strokeLinecap=\"round\"\n",
        "+                  strokeLinejoin=\"round\"\n",
        "+                  strokeWidth={2}\n",
        "+                  d=\"M15 19l-7-7 7-7\"\n",
        "+                />\n",
        "+              </svg>\n",
        "+            </button>\n",
        "+            <div>\n",
        "+              <h2 className=\"text-2xl font-bold text-gray-900\">\n",
        "+                Introduzir Dados do Medicamento\n",
        "+              </h2>\n",
        "+              <p className=\"text-sm text-gray-600 mt-1\">\n",
        "+                Preencha os campos com a informa\u00e7\u00e3o da embalagem\n",
        "+              </p>\n",
        "+            </div>\n",
        "+          </div>\n",
        "+\n",
        "+          <form onSubmit={handleSubmit} className=\"space-y-6\">\n",
        "+            {/* Name Field */}\n",
        "+            <div>\n",
        "+              <label\n",
        "+                htmlFor=\"name\"\n",
        "+                className=\"block text-sm font-semibold text-gray-700 mb-2\"\n",
        "+              >\n",
        "+                Nome do Medicamento <span className=\"text-red-500\">*</span>\n",
        "+              </label>\n",
        "+              <input\n",
        "+                type=\"text\"\n",
        "+                id=\"name\"\n",
        "+                value={formData.name}\n",
        "+                onChange={(e) => handleChange(\"name\", e.target.value)}\n",
        "+                placeholder=\"Ex: Paracetamol\"\n",
        "+                className={`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors ${\n",
        "+                  errors.name\n",
        "+                    ? \"border-red-300 bg-red-50\"\n",
        "+                    : \"border-gray-300 bg-white\"\n",
        "+                }`}\n",
        "+              />\n",
        "+              {errors.name && (\n",
        "+                <p className=\"mt-1 text-sm text-red-600\">{errors.name}</p>\n",
        "+              )}\n",
        "+            </div>\n",
        "+\n",
        "+            {/* Active Substance Field */}\n",
        "+            <div>\n",
        "+              <label\n",
        "+                htmlFor=\"activeSubstance\"\n",
        "+                className=\"block text-sm font-semibold text-gray-700 mb-2\"\n",
        "+              >\n",
        "+                Subst\u00e2ncia Activa <span className=\"text-red-500\">*</span>\n",
        "+              </label>\n",
        "+              <input\n",
        "+                type=\"text\"\n",
        "+                id=\"activeSubstance\"\n",
        "+                value={formData.activeSubstance}\n",
        "+                onChange={(e) => handleChange(\"activeSubstance\", e.target.value)}\n",
        "+                placeholder=\"Ex: Paracetamol\"\n",
        "+                className={`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors ${\n",
        "+                  errors.activeSubstance\n",
        "+                    ? \"border-red-300 bg-red-50\"\n",
        "+                    : \"border-gray-300 bg-white\"\n",
        "+                }`}\n",
        "+              />\n",
        "+              {errors.activeSubstance && (\n",
        "+                <p className=\"mt-1 text-sm text-red-600\">\n",
        "+                  {errors.activeSubstance}\n",
        "+                </p>\n",
        "+              )}\n",
        "+              <p className=\"mt-1 text-xs text-gray-500\">\n",
        "+                Encontra-se geralmente na embalagem junto ao nome\n",
        "+              </p>\n",
        "+            </div>\n",
        "+\n",
        "+            {/* Brand Field */}\n",
        "+            <div>\n",
        "+              <label\n",
        "+                htmlFor=\"brand\"\n",
        "+                className=\"block text-sm font-semibold text-gray-700 mb-2\"\n",
        "+              >\n",
        "+                Marca\n",
        "+              </label>\n",
        "+              <input\n",
        "+                type=\"text\"\n",
        "+                id=\"brand\"\n",
        "+                value={formData.brand}\n",
        "+                onChange={(e) => handleChange(\"brand\", e.target.value)}\n",
        "+                placeholder=\"Ex: Gen\u00e9rico, Ben-u-ron (opcional)\"\n",
        "+                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors\"\n",
        "+              />\n",
        "+              <p className=\"mt-1 text-xs text-gray-500\">\n",
        "+                Pode deixar em branco se n\u00e3o souber\n",
        "+              </p>\n",
        "+            </div>\n",
        "+\n",
        "+            {/* Dosage Field */}\n",
        "+            <div>\n",
        "+              <label\n",
        "+                htmlFor=\"dosage\"\n",
        "+                className=\"block text-sm font-semibold text-gray-700 mb-2\"\n",
        "+              >\n",
        "+                Dosagem\n",
        "+              </label>\n",
        "+              <input\n",
        "+                type=\"text\"\n",
        "+                id=\"dosage\"\n",
        "+                value={formData.dosage}\n",
        "+                onChange={(e) => handleChange(\"dosage\", e.target.value)}\n",
        "+                placeholder=\"Ex: 500mg, 1g (opcional)\"\n",
        "+                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors\"\n",
        "+              />\n",
        "+              <p className=\"mt-1 text-xs text-gray-500\">\n",
        "+                Indica a quantidade de subst\u00e2ncia activa\n",
        "+              </p>\n",
        "+            </div>\n",
        "+\n",
        "+            {/* Info Box */}\n",
        "+            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n",
        "+              <div className=\"flex items-start\">\n",
        "+                <span className=\"text-blue-600 mr-2 mt-0.5\">\ud83d\udca1</span>\n",
        "+                <div className=\"text-sm text-blue-900\">\n",
        "+                  <p className=\"font-medium mb-1\">Dica:</p>\n",
        "+                  <p>\n",
        "+                    Os campos <strong>Nome</strong> e{\" \"}\n",
        "+                    <strong>Subst\u00e2ncia Activa</strong> s\u00e3o suficientes para\n",
        "+                    encontrar o folheto. Os outros campos ajudam a identificar\n",
        "+                    o medicamento espec\u00edfico se existirem v\u00e1rias op\u00e7\u00f5es.\n",
        "+                  </p>\n",
        "+                </div>\n",
        "+              </div>\n",
        "+            </div>\n",
        "+\n",
        "+            {/* Action Buttons */}\n",
        "+            <div className=\"flex flex-col sm:flex-row gap-3 pt-4\">\n",
        "+              <button\n",
        "+                type=\"button\"\n",
        "+                onClick={onCancel}\n",
        "+                className=\"flex-1 px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors\"\n",
        "+              >\n",
        "+                Cancelar\n",
        "+              </button>\n",
        "+              <button\n",
        "+                type=\"submit\"\n",
        "+                className=\"flex-1 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors shadow-lg hover:shadow-xl\"\n",
        "+              >\n",
        "+                Procurar Medicamento\n",
        "+              </button>\n",
        "+            </div>\n",
        "+          </form>\n",
        "+        </div>\n",
        "+\n",
        "+        {/* Alternative Option */}\n",
        "+        <div className=\"text-center mt-6\">\n",
        "+          <p className=\"text-sm text-gray-600\">\n",
        "+            Prefere digitalizar a embalagem?{\" \"}\n",
        "+            <button\n",
        "+              onClick={onCancel}\n",
        "+              className=\"text-blue-600 hover:text-blue-700 font-medium\"\n",
        "+            >\n",
        "+              Usar c\u00e2mara\n",
        "+            </button>\n",
        "+          </p>\n",
        "+        </div>\n",
        "+      </div>\n",
        "+    </div>\n",
        "+  );\n",
        "+};\n",
        "+\n",
        "+export default ManualMedicineForm;\n"
      ]
    },
    {
      "path": "app/components/MedicineInfoPanel.tsx",
      "status": "added",
      "additions": 163,
      "deletions": 0,
      "patch": "@@ -0,0 +1,163 @@\n+import { useState } from \"react\";\n+import { IdentifyMedicineResponse } from \"../core/identify\";\n+import { usePDF } from \"../context/PDFContext\";\n+import { useMediaQuery } from \"../hooks/useMediaQuery\";\n+\n+interface MedicineInfoPanelProps {\n+  medicineInfo: IdentifyMedicineResponse;\n+  image: string | null;\n+  pdfData: string | null;\n+  onReset: () => void;\n+  onDownloadPdf: () => void;\n+}\n+\n+const MedicineInfoPanel = ({\n+  medicineInfo,\n+  image,\n+  pdfData,\n+  onReset,\n+  onDownloadPdf,\n+}: MedicineInfoPanelProps) => {\n+  const { setIsPdfViewerOpen } = usePDF();\n+  const isMobile = useMediaQuery(\"(max-width: 48rem)\");\n+  const [isCollapsed, setIsCollapsed] = useState(false);\n+\n+  const handleViewPdf = () => {\n+    setIsPdfViewerOpen(true);\n+  };\n+\n+  // On desktop, always show expanded\n+  const shouldShowCollapsed = isMobile && isCollapsed;\n+\n+  return (\n+    <div className=\"bg-white h-full flex flex-col\">\n+      {/* Mobile: Collapsible header */}\n+      {isMobile && (\n+        <button\n+          onClick={() => setIsCollapsed(!isCollapsed)}\n+          className=\"w-full p-4 border-b border-gray-200 flex items-center justify-between hover:bg-gray-50 transition-colors\"\n+        >\n+          <div className=\"flex items-center space-x-3\">\n+            <span className=\"text-2xl\">\ud83d\udc8a</span>\n+            <div className=\"text-left\">\n+              <h3 className=\"font-semibold text-gray-800\">\n+                {medicineInfo.name}\n+              </h3>\n+              <p className=\"text-xs text-gray-600\">{medicineInfo.dosage}</p>\n+            </div>\n+          </div>\n+          <svg\n+            className={`w-5 h-5 text-gray-600 transition-transform ${\n+              isCollapsed ? \"\" : \"rotate-180\"\n+            }`}\n+            fill=\"none\"\n+            stroke=\"currentColor\"\n+            viewBox=\"0 0 24 24\"\n+          >\n+            <path\n+              strokeLinecap=\"round\"\n+              strokeLinejoin=\"round\"\n+              strokeWidth={2}\n+              d=\"M19 9l-7 7-7-7\"\n+            />\n+          </svg>\n+        </button>\n+      )}\n+\n+      {/* Content */}\n+      <div\n+        className={`${\n+          shouldShowCollapsed ? \"hidden\" : \"flex\"\n+        } flex-col p-4 space-y-4 overflow-y-auto ${\n+          isMobile ? \"\" : \"h-full\"\n+        }`}\n+      >\n+        {/* Desktop: Header */}\n+        {!isMobile && (\n+          <div className=\"flex items-center space-x-2 pb-4 border-b border-gray-200\">\n+            <span className=\"text-2xl\">\ud83d\udc8a</span>\n+            <h2 className=\"text-lg font-bold text-gray-800\">Medicamento</h2>\n+          </div>\n+        )}\n+\n+        {/* Medicine Image Thumbnail */}\n+        {image && !isMobile && (\n+          <div className=\"flex justify-center\">\n+            <img\n+              src={image}\n+              alt=\"Medicamento capturado\"\n+              className=\"w-16 h-16 object-cover rounded-lg shadow-sm border border-gray-200\"\n+            />\n+          </div>\n+        )}\n+\n+        {/* Medicine Details */}\n+        <div className=\"space-y-3\">\n+          <div>\n+            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide\">\n+              Nome\n+            </label>\n+            <p className=\"text-sm font-medium text-gray-800 mt-1\">\n+              {medicineInfo.name}\n+            </p>\n+          </div>\n+\n+          <div>\n+            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide\">\n+              Subst\u00e2ncia Activa\n+            </label>\n+            <p className=\"text-sm text-gray-800 mt-1\">\n+              {medicineInfo.activeSubstance}\n+            </p>\n+          </div>\n+\n+          <div>\n+            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide\">\n+              Marca\n+            </label>\n+            <p className=\"text-sm text-gray-800 mt-1\">{medicineInfo.brand}</p>\n+          </div>\n+\n+          <div>\n+            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide\">\n+              Dosagem\n+            </label>\n+            <p className=\"text-sm text-gray-800 mt-1\">{medicineInfo.dosage}</p>\n+          </div>\n+        </div>\n+\n+        {/* Action Buttons */}\n+        {pdfData && (\n+          <div className=\"space-y-2 pt-4 border-t border-gray-200\">\n+            <button\n+              onClick={handleViewPdf}\n+              className=\"w-full flex items-center justify-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg transition-colors shadow-sm text-sm font-medium\"\n+            >\n+              <span>\ud83d\udcc4</span>\n+              <span>Ver Folheto</span>\n+            </button>\n+\n+            <button\n+              onClick={onDownloadPdf}\n+              className=\"w-full flex items-center justify-center space-x-2 bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2.5 rounded-lg transition-colors text-sm font-medium\"\n+            >\n+              <span>\u2b07\ufe0f</span>\n+              <span>Transferir PDF</span>\n+            </button>\n+          </div>\n+        )}\n+\n+        {/* New Scan Button */}\n+        <button\n+          onClick={onReset}\n+          className=\"w-full flex items-center justify-center space-x-2 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2.5 rounded-lg transition-colors text-sm font-medium mt-auto\"\n+        >\n+          <span>\ud83d\udd04</span>\n+          <span>Digitalizar Novo</span>\n+        </button>\n+      </div>\n+    </div>\n+  );\n+};\n+\n+export default MedicineInfoPanel;",
      "patch_lines": [
        "@@ -0,0 +1,163 @@\n",
        "+import { useState } from \"react\";\n",
        "+import { IdentifyMedicineResponse } from \"../core/identify\";\n",
        "+import { usePDF } from \"../context/PDFContext\";\n",
        "+import { useMediaQuery } from \"../hooks/useMediaQuery\";\n",
        "+\n",
        "+interface MedicineInfoPanelProps {\n",
        "+  medicineInfo: IdentifyMedicineResponse;\n",
        "+  image: string | null;\n",
        "+  pdfData: string | null;\n",
        "+  onReset: () => void;\n",
        "+  onDownloadPdf: () => void;\n",
        "+}\n",
        "+\n",
        "+const MedicineInfoPanel = ({\n",
        "+  medicineInfo,\n",
        "+  image,\n",
        "+  pdfData,\n",
        "+  onReset,\n",
        "+  onDownloadPdf,\n",
        "+}: MedicineInfoPanelProps) => {\n",
        "+  const { setIsPdfViewerOpen } = usePDF();\n",
        "+  const isMobile = useMediaQuery(\"(max-width: 48rem)\");\n",
        "+  const [isCollapsed, setIsCollapsed] = useState(false);\n",
        "+\n",
        "+  const handleViewPdf = () => {\n",
        "+    setIsPdfViewerOpen(true);\n",
        "+  };\n",
        "+\n",
        "+  // On desktop, always show expanded\n",
        "+  const shouldShowCollapsed = isMobile && isCollapsed;\n",
        "+\n",
        "+  return (\n",
        "+    <div className=\"bg-white h-full flex flex-col\">\n",
        "+      {/* Mobile: Collapsible header */}\n",
        "+      {isMobile && (\n",
        "+        <button\n",
        "+          onClick={() => setIsCollapsed(!isCollapsed)}\n",
        "+          className=\"w-full p-4 border-b border-gray-200 flex items-center justify-between hover:bg-gray-50 transition-colors\"\n",
        "+        >\n",
        "+          <div className=\"flex items-center space-x-3\">\n",
        "+            <span className=\"text-2xl\">\ud83d\udc8a</span>\n",
        "+            <div className=\"text-left\">\n",
        "+              <h3 className=\"font-semibold text-gray-800\">\n",
        "+                {medicineInfo.name}\n",
        "+              </h3>\n",
        "+              <p className=\"text-xs text-gray-600\">{medicineInfo.dosage}</p>\n",
        "+            </div>\n",
        "+          </div>\n",
        "+          <svg\n",
        "+            className={`w-5 h-5 text-gray-600 transition-transform ${\n",
        "+              isCollapsed ? \"\" : \"rotate-180\"\n",
        "+            }`}\n",
        "+            fill=\"none\"\n",
        "+            stroke=\"currentColor\"\n",
        "+            viewBox=\"0 0 24 24\"\n",
        "+          >\n",
        "+            <path\n",
        "+              strokeLinecap=\"round\"\n",
        "+              strokeLinejoin=\"round\"\n",
        "+              strokeWidth={2}\n",
        "+              d=\"M19 9l-7 7-7-7\"\n",
        "+            />\n",
        "+          </svg>\n",
        "+        </button>\n",
        "+      )}\n",
        "+\n",
        "+      {/* Content */}\n",
        "+      <div\n",
        "+        className={`${\n",
        "+          shouldShowCollapsed ? \"hidden\" : \"flex\"\n",
        "+        } flex-col p-4 space-y-4 overflow-y-auto ${\n",
        "+          isMobile ? \"\" : \"h-full\"\n",
        "+        }`}\n",
        "+      >\n",
        "+        {/* Desktop: Header */}\n",
        "+        {!isMobile && (\n",
        "+          <div className=\"flex items-center space-x-2 pb-4 border-b border-gray-200\">\n",
        "+            <span className=\"text-2xl\">\ud83d\udc8a</span>\n",
        "+            <h2 className=\"text-lg font-bold text-gray-800\">Medicamento</h2>\n",
        "+          </div>\n",
        "+        )}\n",
        "+\n",
        "+        {/* Medicine Image Thumbnail */}\n",
        "+        {image && !isMobile && (\n",
        "+          <div className=\"flex justify-center\">\n",
        "+            <img\n",
        "+              src={image}\n",
        "+              alt=\"Medicamento capturado\"\n",
        "+              className=\"w-16 h-16 object-cover rounded-lg shadow-sm border border-gray-200\"\n",
        "+            />\n",
        "+          </div>\n",
        "+        )}\n",
        "+\n",
        "+        {/* Medicine Details */}\n",
        "+        <div className=\"space-y-3\">\n",
        "+          <div>\n",
        "+            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide\">\n",
        "+              Nome\n",
        "+            </label>\n",
        "+            <p className=\"text-sm font-medium text-gray-800 mt-1\">\n",
        "+              {medicineInfo.name}\n",
        "+            </p>\n",
        "+          </div>\n",
        "+\n",
        "+          <div>\n",
        "+            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide\">\n",
        "+              Subst\u00e2ncia Activa\n",
        "+            </label>\n",
        "+            <p className=\"text-sm text-gray-800 mt-1\">\n",
        "+              {medicineInfo.activeSubstance}\n",
        "+            </p>\n",
        "+          </div>\n",
        "+\n",
        "+          <div>\n",
        "+            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide\">\n",
        "+              Marca\n",
        "+            </label>\n",
        "+            <p className=\"text-sm text-gray-800 mt-1\">{medicineInfo.brand}</p>\n",
        "+          </div>\n",
        "+\n",
        "+          <div>\n",
        "+            <label className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide\">\n",
        "+              Dosagem\n",
        "+            </label>\n",
        "+            <p className=\"text-sm text-gray-800 mt-1\">{medicineInfo.dosage}</p>\n",
        "+          </div>\n",
        "+        </div>\n",
        "+\n",
        "+        {/* Action Buttons */}\n",
        "+        {pdfData && (\n",
        "+          <div className=\"space-y-2 pt-4 border-t border-gray-200\">\n",
        "+            <button\n",
        "+              onClick={handleViewPdf}\n",
        "+              className=\"w-full flex items-center justify-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-lg transition-colors shadow-sm text-sm font-medium\"\n",
        "+            >\n",
        "+              <span>\ud83d\udcc4</span>\n",
        "+              <span>Ver Folheto</span>\n",
        "+            </button>\n",
        "+\n",
        "+            <button\n",
        "+              onClick={onDownloadPdf}\n",
        "+              className=\"w-full flex items-center justify-center space-x-2 bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2.5 rounded-lg transition-colors text-sm font-medium\"\n",
        "+            >\n",
        "+              <span>\u2b07\ufe0f</span>\n",
        "+              <span>Transferir PDF</span>\n",
        "+            </button>\n",
        "+          </div>\n",
        "+        )}\n",
        "+\n",
        "+        {/* New Scan Button */}\n",
        "+        <button\n",
        "+          onClick={onReset}\n",
        "+          className=\"w-full flex items-center justify-center space-x-2 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2.5 rounded-lg transition-colors text-sm font-medium mt-auto\"\n",
        "+        >\n",
        "+          <span>\ud83d\udd04</span>\n",
        "+          <span>Digitalizar Novo</span>\n",
        "+        </button>\n",
        "+      </div>\n",
        "+    </div>\n",
        "+  );\n",
        "+};\n",
        "+\n",
        "+export default MedicineInfoPanel;\n"
      ]
    },
    {
      "path": "app/components/PDFViewer.tsx",
      "status": "added",
      "additions": 266,
      "deletions": 0,
      "patch": "@@ -0,0 +1,266 @@\n+import { useState, useEffect } from \"react\";\n+import { usePDF } from \"../context/PDFContext\";\n+import { useMediaQuery } from \"../hooks/useMediaQuery\";\n+\n+interface PDFViewerProps {\n+  onClose?: () => void;\n+  width?: number; // Width in rem units (for desktop)\n+}\n+\n+const PDFViewer = ({ onClose, width = 40 }: PDFViewerProps) => {\n+  // Don't render on server - PDF.js needs browser APIs\n+  const [isClient, setIsClient] = useState(false);\n+  const [pdfComponents, setPdfComponents] = useState<any>(null);\n+\n+  // Dynamically import react-pdf only on the client side\n+  useEffect(() => {\n+    let mounted = true;\n+\n+    const loadPdfComponents = async () => {\n+      try {\n+        const reactPdf = await import(\"react-pdf\");\n+\n+        // Use local worker file (must run npm run copy-pdf-worker first)\n+        reactPdf.pdfjs.GlobalWorkerOptions.workerSrc = \"/pdf.worker.min.mjs\";\n+\n+        if (mounted) {\n+          setPdfComponents({\n+            Document: reactPdf.Document,\n+            Page: reactPdf.Page,\n+          });\n+          setIsClient(true);\n+        }\n+      } catch (error) {\n+        console.error(\"Failed to load PDF components:\", error);\n+      }\n+    };\n+\n+    loadPdfComponents();\n+\n+    return () => {\n+      mounted = false;\n+    };\n+  }, []);\n+\n+  const {\n+    pdfData,\n+    currentPage,\n+    totalPages,\n+    setCurrentPage,\n+    setTotalPages,\n+    isPdfViewerOpen,\n+    setIsPdfViewerOpen,\n+  } = usePDF();\n+\n+  const [scale, setScale] = useState<number>(1.0);\n+  const [loading, setLoading] = useState<boolean>(true);\n+  const isDesktop = useMediaQuery(\"(min-width: 64rem)\");\n+\n+  // Convert base64 to data URL\n+  const pdfDataUrl = pdfData\n+    ? `data:application/pdf;base64,${pdfData}`\n+    : null;\n+\n+  const handleDocumentLoadSuccess = ({ numPages }: { numPages: number }) => {\n+    setTotalPages(numPages);\n+    setLoading(false);\n+  };\n+\n+  const handleDocumentLoadError = (error: Error) => {\n+    console.error(\"Error loading PDF:\", error);\n+    setLoading(false);\n+  };\n+\n+  const goToNextPage = () => {\n+    if (currentPage < totalPages) {\n+      setCurrentPage(currentPage + 1);\n+    }\n+  };\n+\n+  const goToPreviousPage = () => {\n+    if (currentPage > 1) {\n+      setCurrentPage(currentPage - 1);\n+    }\n+  };\n+\n+  const handleClose = () => {\n+    setIsPdfViewerOpen(false);\n+    onClose?.();\n+  };\n+\n+  const zoomLevels = [0.75, 1.0, 1.25, 1.5];\n+\n+  const cycleZoom = () => {\n+    const currentIndex = zoomLevels.indexOf(scale);\n+    const nextIndex = (currentIndex + 1) % zoomLevels.length;\n+    setScale(zoomLevels[nextIndex]);\n+  };\n+\n+  // Don't render until we're on the client and PDF components are loaded (SSR safety)\n+  if (!isClient || !pdfComponents || !pdfDataUrl || !isPdfViewerOpen) {\n+    return null;\n+  }\n+\n+  const { Document, Page } = pdfComponents;\n+\n+  // Mobile: Full-screen modal\n+  if (!isDesktop) {\n+    return (\n+      <div className=\"fixed inset-0 z-50 bg-white flex flex-col\">\n+        {/* Header */}\n+        <div className=\"h-14 border-b border-gray-200 flex items-center justify-between px-4\">\n+          <h3 className=\"text-lg font-semibold text-gray-800\">\n+            Folheto Informativo\n+          </h3>\n+          <button\n+            onClick={handleClose}\n+            className=\"text-gray-600 hover:text-gray-800 text-2xl leading-none\"\n+            aria-label=\"Fechar\"\n+          >\n+            \u00d7\n+          </button>\n+        </div>\n+\n+        {/* PDF Content */}\n+        <div className=\"flex-1 overflow-auto bg-gray-100 flex flex-col items-center p-4 scrollbar-thin\">\n+          {loading && (\n+            <div className=\"flex items-center justify-center h-full\">\n+              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n+            </div>\n+          )}\n+\n+          <Document\n+            file={pdfDataUrl}\n+            onLoadSuccess={handleDocumentLoadSuccess}\n+            onLoadError={handleDocumentLoadError}\n+            loading={null}\n+            className=\"max-w-full\"\n+          >\n+            <Page\n+              pageNumber={currentPage}\n+              scale={scale}\n+              renderTextLayer={false}\n+              renderAnnotationLayer={false}\n+              className=\"shadow-lg\"\n+            />\n+          </Document>\n+        </div>\n+\n+        {/* Controls */}\n+        <div className=\"h-16 border-t border-gray-200 flex items-center justify-between px-4 bg-white\">\n+          <button\n+            onClick={goToPreviousPage}\n+            disabled={currentPage <= 1}\n+            className=\"px-4 py-2 bg-blue-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed text-sm font-medium\"\n+          >\n+            \u25c0 Anterior\n+          </button>\n+\n+          <div className=\"flex items-center space-x-3\">\n+            <span className=\"text-sm font-medium text-gray-700\">\n+              P\u00e1gina {currentPage} de {totalPages}\n+            </span>\n+            <button\n+              onClick={cycleZoom}\n+              className=\"px-3 py-2 bg-gray-200 text-gray-800 rounded text-sm font-medium hover:bg-gray-300\"\n+            >\n+              {Math.round(scale * 100)}%\n+            </button>\n+          </div>\n+\n+          <button\n+            onClick={goToNextPage}\n+            disabled={currentPage >= totalPages}\n+            className=\"px-4 py-2 bg-blue-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed text-sm font-medium\"\n+          >\n+            Pr\u00f3xima \u25b6\n+          </button>\n+        </div>\n+      </div>\n+    );\n+  }\n+\n+  // Calculate PDF page width based on container width\n+  // Convert rem to pixels (1rem = 16px), subtract padding (2rem = 32px)\n+  const pageWidth = (width * 16) - 32;\n+\n+  // Desktop: Sidebar panel\n+  return (\n+    <div className=\"h-full flex flex-col bg-white border-l border-gray-200\">\n+      {/* Header */}\n+      <div className=\"h-14 border-b border-gray-200 flex items-center justify-between px-4 flex-shrink-0\">\n+        <h3 className=\"text-base font-semibold text-gray-800\">\n+          Folheto Informativo\n+        </h3>\n+        <button\n+          onClick={handleClose}\n+          className=\"text-gray-600 hover:text-gray-800 text-xl leading-none\"\n+          aria-label=\"Fechar\"\n+        >\n+          \u00d7\n+        </button>\n+      </div>\n+\n+      {/* PDF Content */}\n+      <div className=\"flex-1 overflow-auto bg-gray-50 flex flex-col items-center p-4 min-h-0 scrollbar-thin\">\n+        {loading && (\n+          <div className=\"flex items-center justify-center h-full\">\n+            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n+          </div>\n+        )}\n+\n+        <Document\n+          file={pdfDataUrl}\n+          onLoadSuccess={handleDocumentLoadSuccess}\n+          onLoadError={handleDocumentLoadError}\n+          loading={null}\n+          className=\"w-full\"\n+        >\n+          <Page\n+            pageNumber={currentPage}\n+            width={pageWidth}\n+            scale={scale}\n+            renderTextLayer={false}\n+            renderAnnotationLayer={false}\n+            className=\"shadow-md\"\n+          />\n+        </Document>\n+      </div>\n+\n+      {/* Controls */}\n+      <div className=\"h-16 border-t border-gray-200 flex items-center justify-between px-4 flex-shrink-0 bg-white\">\n+        <button\n+          onClick={goToPreviousPage}\n+          disabled={currentPage <= 1}\n+          className=\"p-2 text-gray-700 hover:bg-gray-100 rounded disabled:text-gray-300 disabled:cursor-not-allowed\"\n+          aria-label=\"P\u00e1gina anterior\"\n+        >\n+          \u25c0\n+        </button>\n+\n+        <div className=\"flex flex-col items-center\">\n+          <span className=\"text-xs font-medium text-gray-700\">\n+            P\u00e1gina {currentPage} de {totalPages}\n+          </span>\n+          <button\n+            onClick={cycleZoom}\n+            className=\"text-xs text-blue-600 hover:text-blue-700 mt-1\"\n+          >\n+            \ud83d\udd0d {Math.round(scale * 100)}%\n+          </button>\n+        </div>\n+\n+        <button\n+          onClick={goToNextPage}\n+          disabled={currentPage >= totalPages}\n+          className=\"p-2 text-gray-700 hover:bg-gray-100 rounded disabled:text-gray-300 disabled:cursor-not-allowed\"\n+          aria-label=\"Pr\u00f3xima p\u00e1gina\"\n+        >\n+          \u25b6\n+        </button>\n+      </div>\n+    </div>\n+  );\n+};\n+\n+export default PDFViewer;",
      "patch_lines": [
        "@@ -0,0 +1,266 @@\n",
        "+import { useState, useEffect } from \"react\";\n",
        "+import { usePDF } from \"../context/PDFContext\";\n",
        "+import { useMediaQuery } from \"../hooks/useMediaQuery\";\n",
        "+\n",
        "+interface PDFViewerProps {\n",
        "+  onClose?: () => void;\n",
        "+  width?: number; // Width in rem units (for desktop)\n",
        "+}\n",
        "+\n",
        "+const PDFViewer = ({ onClose, width = 40 }: PDFViewerProps) => {\n",
        "+  // Don't render on server - PDF.js needs browser APIs\n",
        "+  const [isClient, setIsClient] = useState(false);\n",
        "+  const [pdfComponents, setPdfComponents] = useState<any>(null);\n",
        "+\n",
        "+  // Dynamically import react-pdf only on the client side\n",
        "+  useEffect(() => {\n",
        "+    let mounted = true;\n",
        "+\n",
        "+    const loadPdfComponents = async () => {\n",
        "+      try {\n",
        "+        const reactPdf = await import(\"react-pdf\");\n",
        "+\n",
        "+        // Use local worker file (must run npm run copy-pdf-worker first)\n",
        "+        reactPdf.pdfjs.GlobalWorkerOptions.workerSrc = \"/pdf.worker.min.mjs\";\n",
        "+\n",
        "+        if (mounted) {\n",
        "+          setPdfComponents({\n",
        "+            Document: reactPdf.Document,\n",
        "+            Page: reactPdf.Page,\n",
        "+          });\n",
        "+          setIsClient(true);\n",
        "+        }\n",
        "+      } catch (error) {\n",
        "+        console.error(\"Failed to load PDF components:\", error);\n",
        "+      }\n",
        "+    };\n",
        "+\n",
        "+    loadPdfComponents();\n",
        "+\n",
        "+    return () => {\n",
        "+      mounted = false;\n",
        "+    };\n",
        "+  }, []);\n",
        "+\n",
        "+  const {\n",
        "+    pdfData,\n",
        "+    currentPage,\n",
        "+    totalPages,\n",
        "+    setCurrentPage,\n",
        "+    setTotalPages,\n",
        "+    isPdfViewerOpen,\n",
        "+    setIsPdfViewerOpen,\n",
        "+  } = usePDF();\n",
        "+\n",
        "+  const [scale, setScale] = useState<number>(1.0);\n",
        "+  const [loading, setLoading] = useState<boolean>(true);\n",
        "+  const isDesktop = useMediaQuery(\"(min-width: 64rem)\");\n",
        "+\n",
        "+  // Convert base64 to data URL\n",
        "+  const pdfDataUrl = pdfData\n",
        "+    ? `data:application/pdf;base64,${pdfData}`\n",
        "+    : null;\n",
        "+\n",
        "+  const handleDocumentLoadSuccess = ({ numPages }: { numPages: number }) => {\n",
        "+    setTotalPages(numPages);\n",
        "+    setLoading(false);\n",
        "+  };\n",
        "+\n",
        "+  const handleDocumentLoadError = (error: Error) => {\n",
        "+    console.error(\"Error loading PDF:\", error);\n",
        "+    setLoading(false);\n",
        "+  };\n",
        "+\n",
        "+  const goToNextPage = () => {\n",
        "+    if (currentPage < totalPages) {\n",
        "+      setCurrentPage(currentPage + 1);\n",
        "+    }\n",
        "+  };\n",
        "+\n",
        "+  const goToPreviousPage = () => {\n",
        "+    if (currentPage > 1) {\n",
        "+      setCurrentPage(currentPage - 1);\n",
        "+    }\n",
        "+  };\n",
        "+\n",
        "+  const handleClose = () => {\n",
        "+    setIsPdfViewerOpen(false);\n",
        "+    onClose?.();\n",
        "+  };\n",
        "+\n",
        "+  const zoomLevels = [0.75, 1.0, 1.25, 1.5];\n",
        "+\n",
        "+  const cycleZoom = () => {\n",
        "+    const currentIndex = zoomLevels.indexOf(scale);\n",
        "+    const nextIndex = (currentIndex + 1) % zoomLevels.length;\n",
        "+    setScale(zoomLevels[nextIndex]);\n",
        "+  };\n",
        "+\n",
        "+  // Don't render until we're on the client and PDF components are loaded (SSR safety)\n",
        "+  if (!isClient || !pdfComponents || !pdfDataUrl || !isPdfViewerOpen) {\n",
        "+    return null;\n",
        "+  }\n",
        "+\n",
        "+  const { Document, Page } = pdfComponents;\n",
        "+\n",
        "+  // Mobile: Full-screen modal\n",
        "+  if (!isDesktop) {\n",
        "+    return (\n",
        "+      <div className=\"fixed inset-0 z-50 bg-white flex flex-col\">\n",
        "+        {/* Header */}\n",
        "+        <div className=\"h-14 border-b border-gray-200 flex items-center justify-between px-4\">\n",
        "+          <h3 className=\"text-lg font-semibold text-gray-800\">\n",
        "+            Folheto Informativo\n",
        "+          </h3>\n",
        "+          <button\n",
        "+            onClick={handleClose}\n",
        "+            className=\"text-gray-600 hover:text-gray-800 text-2xl leading-none\"\n",
        "+            aria-label=\"Fechar\"\n",
        "+          >\n",
        "+            \u00d7\n",
        "+          </button>\n",
        "+        </div>\n",
        "+\n",
        "+        {/* PDF Content */}\n",
        "+        <div className=\"flex-1 overflow-auto bg-gray-100 flex flex-col items-center p-4 scrollbar-thin\">\n",
        "+          {loading && (\n",
        "+            <div className=\"flex items-center justify-center h-full\">\n",
        "+              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n",
        "+            </div>\n",
        "+          )}\n",
        "+\n",
        "+          <Document\n",
        "+            file={pdfDataUrl}\n",
        "+            onLoadSuccess={handleDocumentLoadSuccess}\n",
        "+            onLoadError={handleDocumentLoadError}\n",
        "+            loading={null}\n",
        "+            className=\"max-w-full\"\n",
        "+          >\n",
        "+            <Page\n",
        "+              pageNumber={currentPage}\n",
        "+              scale={scale}\n",
        "+              renderTextLayer={false}\n",
        "+              renderAnnotationLayer={false}\n",
        "+              className=\"shadow-lg\"\n",
        "+            />\n",
        "+          </Document>\n",
        "+        </div>\n",
        "+\n",
        "+        {/* Controls */}\n",
        "+        <div className=\"h-16 border-t border-gray-200 flex items-center justify-between px-4 bg-white\">\n",
        "+          <button\n",
        "+            onClick={goToPreviousPage}\n",
        "+            disabled={currentPage <= 1}\n",
        "+            className=\"px-4 py-2 bg-blue-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed text-sm font-medium\"\n",
        "+          >\n",
        "+            \u25c0 Anterior\n",
        "+          </button>\n",
        "+\n",
        "+          <div className=\"flex items-center space-x-3\">\n",
        "+            <span className=\"text-sm font-medium text-gray-700\">\n",
        "+              P\u00e1gina {currentPage} de {totalPages}\n",
        "+            </span>\n",
        "+            <button\n",
        "+              onClick={cycleZoom}\n",
        "+              className=\"px-3 py-2 bg-gray-200 text-gray-800 rounded text-sm font-medium hover:bg-gray-300\"\n",
        "+            >\n",
        "+              {Math.round(scale * 100)}%\n",
        "+            </button>\n",
        "+          </div>\n",
        "+\n",
        "+          <button\n",
        "+            onClick={goToNextPage}\n",
        "+            disabled={currentPage >= totalPages}\n",
        "+            className=\"px-4 py-2 bg-blue-600 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed text-sm font-medium\"\n",
        "+          >\n",
        "+            Pr\u00f3xima \u25b6\n",
        "+          </button>\n",
        "+        </div>\n",
        "+      </div>\n",
        "+    );\n",
        "+  }\n",
        "+\n",
        "+  // Calculate PDF page width based on container width\n",
        "+  // Convert rem to pixels (1rem = 16px), subtract padding (2rem = 32px)\n",
        "+  const pageWidth = (width * 16) - 32;\n",
        "+\n",
        "+  // Desktop: Sidebar panel\n",
        "+  return (\n",
        "+    <div className=\"h-full flex flex-col bg-white border-l border-gray-200\">\n",
        "+      {/* Header */}\n",
        "+      <div className=\"h-14 border-b border-gray-200 flex items-center justify-between px-4 flex-shrink-0\">\n",
        "+        <h3 className=\"text-base font-semibold text-gray-800\">\n",
        "+          Folheto Informativo\n",
        "+        </h3>\n",
        "+        <button\n",
        "+          onClick={handleClose}\n",
        "+          className=\"text-gray-600 hover:text-gray-800 text-xl leading-none\"\n",
        "+          aria-label=\"Fechar\"\n",
        "+        >\n",
        "+          \u00d7\n",
        "+        </button>\n",
        "+      </div>\n",
        "+\n",
        "+      {/* PDF Content */}\n",
        "+      <div className=\"flex-1 overflow-auto bg-gray-50 flex flex-col items-center p-4 min-h-0 scrollbar-thin\">\n",
        "+        {loading && (\n",
        "+          <div className=\"flex items-center justify-center h-full\">\n",
        "+            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n",
        "+          </div>\n",
        "+        )}\n",
        "+\n",
        "+        <Document\n",
        "+          file={pdfDataUrl}\n",
        "+          onLoadSuccess={handleDocumentLoadSuccess}\n",
        "+          onLoadError={handleDocumentLoadError}\n",
        "+          loading={null}\n",
        "+          className=\"w-full\"\n",
        "+        >\n",
        "+          <Page\n",
        "+            pageNumber={currentPage}\n",
        "+            width={pageWidth}\n",
        "+            scale={scale}\n",
        "+            renderTextLayer={false}\n",
        "+            renderAnnotationLayer={false}\n",
        "+            className=\"shadow-md\"\n",
        "+          />\n",
        "+        </Document>\n",
        "+      </div>\n",
        "+\n",
        "+      {/* Controls */}\n",
        "+      <div className=\"h-16 border-t border-gray-200 flex items-center justify-between px-4 flex-shrink-0 bg-white\">\n",
        "+        <button\n",
        "+          onClick={goToPreviousPage}\n",
        "+          disabled={currentPage <= 1}\n",
        "+          className=\"p-2 text-gray-700 hover:bg-gray-100 rounded disabled:text-gray-300 disabled:cursor-not-allowed\"\n",
        "+          aria-label=\"P\u00e1gina anterior\"\n",
        "+        >\n",
        "+          \u25c0\n",
        "+        </button>\n",
        "+\n",
        "+        <div className=\"flex flex-col items-center\">\n",
        "+          <span className=\"text-xs font-medium text-gray-700\">\n",
        "+            P\u00e1gina {currentPage} de {totalPages}\n",
        "+          </span>\n",
        "+          <button\n",
        "+            onClick={cycleZoom}\n",
        "+            className=\"text-xs text-blue-600 hover:text-blue-700 mt-1\"\n",
        "+          >\n",
        "+            \ud83d\udd0d {Math.round(scale * 100)}%\n",
        "+          </button>\n",
        "+        </div>\n",
        "+\n",
        "+        <button\n",
        "+          onClick={goToNextPage}\n",
        "+          disabled={currentPage >= totalPages}\n",
        "+          className=\"p-2 text-gray-700 hover:bg-gray-100 rounded disabled:text-gray-300 disabled:cursor-not-allowed\"\n",
        "+          aria-label=\"Pr\u00f3xima p\u00e1gina\"\n",
        "+        >\n",
        "+          \u25b6\n",
        "+        </button>\n",
        "+      </div>\n",
        "+    </div>\n",
        "+  );\n",
        "+};\n",
        "+\n",
        "+export default PDFViewer;\n"
      ]
    },
    {
      "path": "app/components/layouts/DesktopLayout.tsx",
      "status": "added",
      "additions": 103,
      "deletions": 0,
      "patch": "@@ -0,0 +1,103 @@\n+import { ReactNode, useState, useRef, useEffect } from \"react\";\n+import { usePDF } from \"../../context/PDFContext\";\n+import PDFViewer from \"../PDFViewer\";\n+\n+interface DesktopLayoutProps {\n+  medicineInfoPanel: ReactNode;\n+  chat: ReactNode;\n+  showPdfViewer?: boolean;\n+}\n+\n+const DesktopLayout = ({\n+  medicineInfoPanel,\n+  chat,\n+  showPdfViewer = true,\n+}: DesktopLayoutProps) => {\n+  const { isPdfViewerOpen } = usePDF();\n+  const [pdfWidth, setPdfWidth] = useState(40); // Start at 40rem (640px) - much bigger!\n+  const [isResizing, setIsResizing] = useState(false);\n+  const containerRef = useRef<HTMLDivElement>(null);\n+\n+  const handleMouseDown = (e: React.MouseEvent) => {\n+    e.preventDefault();\n+    setIsResizing(true);\n+  };\n+\n+  useEffect(() => {\n+    const handleMouseMove = (e: MouseEvent) => {\n+      if (!isResizing || !containerRef.current) return;\n+\n+      const containerRect = containerRef.current.getBoundingClientRect();\n+      const newWidth = containerRect.right - e.clientX;\n+\n+      // Convert to rem (assuming 16px = 1rem)\n+      const newWidthRem = newWidth / 16;\n+\n+      // Constrain between 25rem (400px) and 60rem (960px)\n+      const constrainedWidth = Math.max(25, Math.min(60, newWidthRem));\n+      setPdfWidth(constrainedWidth);\n+    };\n+\n+    const handleMouseUp = () => {\n+      setIsResizing(false);\n+    };\n+\n+    if (isResizing) {\n+      document.addEventListener(\"mousemove\", handleMouseMove);\n+      document.addEventListener(\"mouseup\", handleMouseUp);\n+      document.body.style.cursor = \"ew-resize\";\n+      document.body.style.userSelect = \"none\";\n+    }\n+\n+    return () => {\n+      document.removeEventListener(\"mousemove\", handleMouseMove);\n+      document.removeEventListener(\"mouseup\", handleMouseUp);\n+      document.body.style.cursor = \"\";\n+      document.body.style.userSelect = \"\";\n+    };\n+  }, [isResizing]);\n+\n+  return (\n+    <div ref={containerRef} className=\"h-screen w-full overflow-hidden bg-gray-50\">\n+      {/* Three-column grid layout with resizable PDF panel */}\n+      <div\n+        className=\"grid h-full transition-all duration-300 ease-in-out\"\n+        style={{\n+          gridTemplateColumns: isPdfViewerOpen && showPdfViewer\n+            ? `17.5rem 1fr ${pdfWidth}rem`\n+            : \"17.5rem 1fr\",\n+          minWidth: \"64rem\",\n+        }}\n+      >\n+        {/* Left Sidebar - Medicine Info */}\n+        <aside className=\"border-r border-gray-200 bg-white overflow-hidden\">\n+          {medicineInfoPanel}\n+        </aside>\n+\n+        {/* Center - Chat */}\n+        <main className=\"flex flex-col overflow-hidden\">{chat}</main>\n+\n+        {/* Right Sidebar - PDF Viewer with Resize Handle */}\n+        {isPdfViewerOpen && showPdfViewer && (\n+          <aside className=\"overflow-hidden relative\">\n+            {/* Resize Handle */}\n+            <div\n+              onMouseDown={handleMouseDown}\n+              className={`absolute left-0 top-0 bottom-0 w-1 cursor-ew-resize hover:bg-blue-500 z-10 ${\n+                isResizing ? \"bg-blue-500\" : \"bg-transparent\"\n+              } transition-colors`}\n+              style={{ marginLeft: \"-2px\" }}\n+            >\n+              <div className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-1 h-16 bg-gray-300 rounded-full opacity-50 hover:opacity-100 transition-opacity\" />\n+            </div>\n+\n+            {/* Pass width to PDFViewer */}\n+            <PDFViewer width={pdfWidth} />\n+          </aside>\n+        )}\n+      </div>\n+    </div>\n+  );\n+};\n+\n+export default DesktopLayout;",
      "patch_lines": [
        "@@ -0,0 +1,103 @@\n",
        "+import { ReactNode, useState, useRef, useEffect } from \"react\";\n",
        "+import { usePDF } from \"../../context/PDFContext\";\n",
        "+import PDFViewer from \"../PDFViewer\";\n",
        "+\n",
        "+interface DesktopLayoutProps {\n",
        "+  medicineInfoPanel: ReactNode;\n",
        "+  chat: ReactNode;\n",
        "+  showPdfViewer?: boolean;\n",
        "+}\n",
        "+\n",
        "+const DesktopLayout = ({\n",
        "+  medicineInfoPanel,\n",
        "+  chat,\n",
        "+  showPdfViewer = true,\n",
        "+}: DesktopLayoutProps) => {\n",
        "+  const { isPdfViewerOpen } = usePDF();\n",
        "+  const [pdfWidth, setPdfWidth] = useState(40); // Start at 40rem (640px) - much bigger!\n",
        "+  const [isResizing, setIsResizing] = useState(false);\n",
        "+  const containerRef = useRef<HTMLDivElement>(null);\n",
        "+\n",
        "+  const handleMouseDown = (e: React.MouseEvent) => {\n",
        "+    e.preventDefault();\n",
        "+    setIsResizing(true);\n",
        "+  };\n",
        "+\n",
        "+  useEffect(() => {\n",
        "+    const handleMouseMove = (e: MouseEvent) => {\n",
        "+      if (!isResizing || !containerRef.current) return;\n",
        "+\n",
        "+      const containerRect = containerRef.current.getBoundingClientRect();\n",
        "+      const newWidth = containerRect.right - e.clientX;\n",
        "+\n",
        "+      // Convert to rem (assuming 16px = 1rem)\n",
        "+      const newWidthRem = newWidth / 16;\n",
        "+\n",
        "+      // Constrain between 25rem (400px) and 60rem (960px)\n",
        "+      const constrainedWidth = Math.max(25, Math.min(60, newWidthRem));\n",
        "+      setPdfWidth(constrainedWidth);\n",
        "+    };\n",
        "+\n",
        "+    const handleMouseUp = () => {\n",
        "+      setIsResizing(false);\n",
        "+    };\n",
        "+\n",
        "+    if (isResizing) {\n",
        "+      document.addEventListener(\"mousemove\", handleMouseMove);\n",
        "+      document.addEventListener(\"mouseup\", handleMouseUp);\n",
        "+      document.body.style.cursor = \"ew-resize\";\n",
        "+      document.body.style.userSelect = \"none\";\n",
        "+    }\n",
        "+\n",
        "+    return () => {\n",
        "+      document.removeEventListener(\"mousemove\", handleMouseMove);\n",
        "+      document.removeEventListener(\"mouseup\", handleMouseUp);\n",
        "+      document.body.style.cursor = \"\";\n",
        "+      document.body.style.userSelect = \"\";\n",
        "+    };\n",
        "+  }, [isResizing]);\n",
        "+\n",
        "+  return (\n",
        "+    <div ref={containerRef} className=\"h-screen w-full overflow-hidden bg-gray-50\">\n",
        "+      {/* Three-column grid layout with resizable PDF panel */}\n",
        "+      <div\n",
        "+        className=\"grid h-full transition-all duration-300 ease-in-out\"\n",
        "+        style={{\n",
        "+          gridTemplateColumns: isPdfViewerOpen && showPdfViewer\n",
        "+            ? `17.5rem 1fr ${pdfWidth}rem`\n",
        "+            : \"17.5rem 1fr\",\n",
        "+          minWidth: \"64rem\",\n",
        "+        }}\n",
        "+      >\n",
        "+        {/* Left Sidebar - Medicine Info */}\n",
        "+        <aside className=\"border-r border-gray-200 bg-white overflow-hidden\">\n",
        "+          {medicineInfoPanel}\n",
        "+        </aside>\n",
        "+\n",
        "+        {/* Center - Chat */}\n",
        "+        <main className=\"flex flex-col overflow-hidden\">{chat}</main>\n",
        "+\n",
        "+        {/* Right Sidebar - PDF Viewer with Resize Handle */}\n",
        "+        {isPdfViewerOpen && showPdfViewer && (\n",
        "+          <aside className=\"overflow-hidden relative\">\n",
        "+            {/* Resize Handle */}\n",
        "+            <div\n",
        "+              onMouseDown={handleMouseDown}\n",
        "+              className={`absolute left-0 top-0 bottom-0 w-1 cursor-ew-resize hover:bg-blue-500 z-10 ${\n",
        "+                isResizing ? \"bg-blue-500\" : \"bg-transparent\"\n",
        "+              } transition-colors`}\n",
        "+              style={{ marginLeft: \"-2px\" }}\n",
        "+            >\n",
        "+              <div className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-1 h-16 bg-gray-300 rounded-full opacity-50 hover:opacity-100 transition-opacity\" />\n",
        "+            </div>\n",
        "+\n",
        "+            {/* Pass width to PDFViewer */}\n",
        "+            <PDFViewer width={pdfWidth} />\n",
        "+          </aside>\n",
        "+        )}\n",
        "+      </div>\n",
        "+    </div>\n",
        "+  );\n",
        "+};\n",
        "+\n",
        "+export default DesktopLayout;\n"
      ]
    },
    {
      "path": "app/components/layouts/MobileLayout.tsx",
      "status": "added",
      "additions": 34,
      "deletions": 0,
      "patch": "@@ -0,0 +1,34 @@\n+import { ReactNode } from \"react\";\n+import PDFViewer from \"../PDFViewer\";\n+\n+interface MobileLayoutProps {\n+  medicineInfoPanel: ReactNode;\n+  chat: ReactNode;\n+}\n+\n+const MobileLayout = ({ medicineInfoPanel, chat }: MobileLayoutProps) => {\n+  return (\n+    <div className=\"h-screen w-full flex flex-col overflow-hidden bg-gray-50\">\n+      {/* Header */}\n+      <header className=\"h-14 bg-blue-600 text-white flex items-center px-4 flex-shrink-0 shadow-md\">\n+        <div className=\"flex items-center space-x-2\">\n+          <span className=\"text-2xl\">\ud83e\udd16</span>\n+          <h1 className=\"text-lg font-bold\">MedaBot</h1>\n+        </div>\n+      </header>\n+\n+      {/* Medicine Info Panel - Collapsible */}\n+      <section className=\"flex-shrink-0 bg-white border-b border-gray-200\">\n+        {medicineInfoPanel}\n+      </section>\n+\n+      {/* Chat - Takes remaining space */}\n+      <main className=\"flex-1 min-h-0 overflow-hidden\">{chat}</main>\n+\n+      {/* PDF Viewer Modal - Rendered as overlay when open */}\n+      <PDFViewer />\n+    </div>\n+  );\n+};\n+\n+export default MobileLayout;",
      "patch_lines": [
        "@@ -0,0 +1,34 @@\n",
        "+import { ReactNode } from \"react\";\n",
        "+import PDFViewer from \"../PDFViewer\";\n",
        "+\n",
        "+interface MobileLayoutProps {\n",
        "+  medicineInfoPanel: ReactNode;\n",
        "+  chat: ReactNode;\n",
        "+}\n",
        "+\n",
        "+const MobileLayout = ({ medicineInfoPanel, chat }: MobileLayoutProps) => {\n",
        "+  return (\n",
        "+    <div className=\"h-screen w-full flex flex-col overflow-hidden bg-gray-50\">\n",
        "+      {/* Header */}\n",
        "+      <header className=\"h-14 bg-blue-600 text-white flex items-center px-4 flex-shrink-0 shadow-md\">\n",
        "+        <div className=\"flex items-center space-x-2\">\n",
        "+          <span className=\"text-2xl\">\ud83e\udd16</span>\n",
        "+          <h1 className=\"text-lg font-bold\">MedaBot</h1>\n",
        "+        </div>\n",
        "+      </header>\n",
        "+\n",
        "+      {/* Medicine Info Panel - Collapsible */}\n",
        "+      <section className=\"flex-shrink-0 bg-white border-b border-gray-200\">\n",
        "+        {medicineInfoPanel}\n",
        "+      </section>\n",
        "+\n",
        "+      {/* Chat - Takes remaining space */}\n",
        "+      <main className=\"flex-1 min-h-0 overflow-hidden\">{chat}</main>\n",
        "+\n",
        "+      {/* PDF Viewer Modal - Rendered as overlay when open */}\n",
        "+      <PDFViewer />\n",
        "+    </div>\n",
        "+  );\n",
        "+};\n",
        "+\n",
        "+export default MobileLayout;\n"
      ]
    },
    {
      "path": "app/components/layouts/ResponsiveContainer.tsx",
      "status": "added",
      "additions": 32,
      "deletions": 0,
      "patch": "@@ -0,0 +1,32 @@\n+import { ReactNode } from \"react\";\n+import { useMediaQuery } from \"../../hooks/useMediaQuery\";\n+import DesktopLayout from \"./DesktopLayout\";\n+import MobileLayout from \"./MobileLayout\";\n+\n+interface ResponsiveContainerProps {\n+  medicineInfoPanel: ReactNode;\n+  chat: ReactNode;\n+  showPdfViewer?: boolean;\n+}\n+\n+const ResponsiveContainer = ({\n+  medicineInfoPanel,\n+  chat,\n+  showPdfViewer = true,\n+}: ResponsiveContainerProps) => {\n+  const isDesktop = useMediaQuery(\"(min-width: 64rem)\");\n+\n+  if (isDesktop) {\n+    return (\n+      <DesktopLayout\n+        medicineInfoPanel={medicineInfoPanel}\n+        chat={chat}\n+        showPdfViewer={showPdfViewer}\n+      />\n+    );\n+  }\n+\n+  return <MobileLayout medicineInfoPanel={medicineInfoPanel} chat={chat} />;\n+};\n+\n+export default ResponsiveContainer;",
      "patch_lines": [
        "@@ -0,0 +1,32 @@\n",
        "+import { ReactNode } from \"react\";\n",
        "+import { useMediaQuery } from \"../../hooks/useMediaQuery\";\n",
        "+import DesktopLayout from \"./DesktopLayout\";\n",
        "+import MobileLayout from \"./MobileLayout\";\n",
        "+\n",
        "+interface ResponsiveContainerProps {\n",
        "+  medicineInfoPanel: ReactNode;\n",
        "+  chat: ReactNode;\n",
        "+  showPdfViewer?: boolean;\n",
        "+}\n",
        "+\n",
        "+const ResponsiveContainer = ({\n",
        "+  medicineInfoPanel,\n",
        "+  chat,\n",
        "+  showPdfViewer = true,\n",
        "+}: ResponsiveContainerProps) => {\n",
        "+  const isDesktop = useMediaQuery(\"(min-width: 64rem)\");\n",
        "+\n",
        "+  if (isDesktop) {\n",
        "+    return (\n",
        "+      <DesktopLayout\n",
        "+        medicineInfoPanel={medicineInfoPanel}\n",
        "+        chat={chat}\n",
        "+        showPdfViewer={showPdfViewer}\n",
        "+      />\n",
        "+    );\n",
        "+  }\n",
        "+\n",
        "+  return <MobileLayout medicineInfoPanel={medicineInfoPanel} chat={chat} />;\n",
        "+};\n",
        "+\n",
        "+export default ResponsiveContainer;\n"
      ]
    },
    {
      "path": "app/context/PDFContext.tsx",
      "status": "added",
      "additions": 56,
      "deletions": 0,
      "patch": "@@ -0,0 +1,56 @@\n+import { createContext, useContext, useState, ReactNode } from \"react\";\n+\n+interface PDFContextType {\n+  currentPage: number;\n+  totalPages: number;\n+  pdfData: string | null;\n+  isPdfViewerOpen: boolean;\n+  setCurrentPage: (page: number) => void;\n+  setPdfData: (data: string | null) => void;\n+  setTotalPages: (total: number) => void;\n+  jumpToPage: (page: number) => void;\n+  setIsPdfViewerOpen: (open: boolean) => void;\n+}\n+\n+const PDFContext = createContext<PDFContextType | undefined>(undefined);\n+\n+export const PDFProvider = ({ children }: { children: ReactNode }) => {\n+  const [currentPage, setCurrentPage] = useState<number>(1);\n+  const [totalPages, setTotalPages] = useState<number>(0);\n+  const [pdfData, setPdfData] = useState<string | null>(null);\n+  const [isPdfViewerOpen, setIsPdfViewerOpen] = useState<boolean>(false);\n+\n+  const jumpToPage = (page: number) => {\n+    if (page >= 1 && page <= totalPages) {\n+      setCurrentPage(page);\n+      // Open PDF viewer when clicking a page reference\n+      setIsPdfViewerOpen(true);\n+    }\n+  };\n+\n+  return (\n+    <PDFContext.Provider\n+      value={{\n+        currentPage,\n+        totalPages,\n+        pdfData,\n+        isPdfViewerOpen,\n+        setCurrentPage,\n+        setPdfData,\n+        setTotalPages,\n+        jumpToPage,\n+        setIsPdfViewerOpen,\n+      }}\n+    >\n+      {children}\n+    </PDFContext.Provider>\n+  );\n+};\n+\n+export const usePDF = () => {\n+  const context = useContext(PDFContext);\n+  if (context === undefined) {\n+    throw new Error(\"usePDF must be used within a PDFProvider\");\n+  }\n+  return context;\n+};",
      "patch_lines": [
        "@@ -0,0 +1,56 @@\n",
        "+import { createContext, useContext, useState, ReactNode } from \"react\";\n",
        "+\n",
        "+interface PDFContextType {\n",
        "+  currentPage: number;\n",
        "+  totalPages: number;\n",
        "+  pdfData: string | null;\n",
        "+  isPdfViewerOpen: boolean;\n",
        "+  setCurrentPage: (page: number) => void;\n",
        "+  setPdfData: (data: string | null) => void;\n",
        "+  setTotalPages: (total: number) => void;\n",
        "+  jumpToPage: (page: number) => void;\n",
        "+  setIsPdfViewerOpen: (open: boolean) => void;\n",
        "+}\n",
        "+\n",
        "+const PDFContext = createContext<PDFContextType | undefined>(undefined);\n",
        "+\n",
        "+export const PDFProvider = ({ children }: { children: ReactNode }) => {\n",
        "+  const [currentPage, setCurrentPage] = useState<number>(1);\n",
        "+  const [totalPages, setTotalPages] = useState<number>(0);\n",
        "+  const [pdfData, setPdfData] = useState<string | null>(null);\n",
        "+  const [isPdfViewerOpen, setIsPdfViewerOpen] = useState<boolean>(false);\n",
        "+\n",
        "+  const jumpToPage = (page: number) => {\n",
        "+    if (page >= 1 && page <= totalPages) {\n",
        "+      setCurrentPage(page);\n",
        "+      // Open PDF viewer when clicking a page reference\n",
        "+      setIsPdfViewerOpen(true);\n",
        "+    }\n",
        "+  };\n",
        "+\n",
        "+  return (\n",
        "+    <PDFContext.Provider\n",
        "+      value={{\n",
        "+        currentPage,\n",
        "+        totalPages,\n",
        "+        pdfData,\n",
        "+        isPdfViewerOpen,\n",
        "+        setCurrentPage,\n",
        "+        setPdfData,\n",
        "+        setTotalPages,\n",
        "+        jumpToPage,\n",
        "+        setIsPdfViewerOpen,\n",
        "+      }}\n",
        "+    >\n",
        "+      {children}\n",
        "+    </PDFContext.Provider>\n",
        "+  );\n",
        "+};\n",
        "+\n",
        "+export const usePDF = () => {\n",
        "+  const context = useContext(PDFContext);\n",
        "+  if (context === undefined) {\n",
        "+    throw new Error(\"usePDF must be used within a PDFProvider\");\n",
        "+  }\n",
        "+  return context;\n",
        "+};\n"
      ]
    },
    {
      "path": "app/core/identify.ts",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "patch": "@@ -50,9 +50,12 @@ Return only a JSON object in this format, with no additional text:\n     throw new Error(\"No content in response\");\n   }\n \n+  try {\n   const parsed = IdentifyMedicineSchema.parse(\n     JSON.parse(completion.choices[0].message.content)\n   );\n-\n   return parsed;\n+  } catch (error) {\n+    throw new Error(\"N\u00e3o foi poss\u00edvel identificar o medicamento\");\n+  }\n };",
      "patch_lines": [
        "@@ -50,9 +50,12 @@ Return only a JSON object in this format, with no additional text:\n",
        "     throw new Error(\"No content in response\");\n",
        "   }\n",
        " \n",
        "+  try {\n",
        "   const parsed = IdentifyMedicineSchema.parse(\n",
        "     JSON.parse(completion.choices[0].message.content)\n",
        "   );\n",
        "-\n",
        "   return parsed;\n",
        "+  } catch (error) {\n",
        "+    throw new Error(\"N\u00e3o foi poss\u00edvel identificar o medicamento\");\n",
        "+  }\n",
        " };\n"
      ]
    },
    {
      "path": "app/core/leafletProcessor.ts",
      "status": "modified",
      "additions": 102,
      "deletions": 41,
      "patch": "@@ -4,6 +4,9 @@ import { OpenAIEmbeddings } from \"@langchain/openai\";\n import { MemoryVectorStore } from \"langchain/vectorstores/memory\";\n import { ChatOpenAI } from \"@langchain/openai\";\n import { ChatPromptTemplate } from \"@langchain/core/prompts\";\n+import { StringOutputParser } from \"@langchain/core/output_parsers\";\n+import { RunnableSequence } from \"@langchain/core/runnables\";\n+import { Document } from \"@langchain/core/documents\";\n \n // Process PDF and create a retriever\n export async function processLeaflet(pdfBase64: string) {\n@@ -18,93 +21,151 @@ export async function processLeaflet(pdfBase64: string) {\n     const loader = new PDFLoader(blob);\n     const docs = await loader.load();\n \n-    // Split into chunks\n+    // Split into chunks with better parameters for medical documents\n+    // Medical PDFs often have dense information, so slightly smaller chunks work better\n     const splitter = new RecursiveCharacterTextSplitter({\n-      chunkSize: 1000,\n-      chunkOverlap: 200,\n+      chunkSize: 800,  // Reduced from 1000 for more precise retrieval\n+      chunkOverlap: 150, // Reduced from 200 to avoid too much duplication\n+      separators: [\"\\n\\n\", \"\\n\", \". \", \" \", \"\"], // Prioritize paragraph breaks\n     });\n+\n     const splitDocs = await splitter.splitDocuments(docs);\n \n-    // Create vector store\n+    // Enhance documents with page number metadata\n+    const enhancedDocs = splitDocs.map((doc) => {\n+      // Extract page number from metadata (PDFLoader provides this)\n+      const pageNum = doc.metadata?.loc?.pageNumber || doc.metadata?.page || 0;\n+\n+      return new Document({\n+        pageContent: doc.pageContent,\n+        metadata: {\n+          ...doc.metadata,\n+          page: pageNum,\n+          source: \"patient_leaflet\",\n+        },\n+      });\n+    });\n+\n+    // Create vector store with better embeddings model\n     const vectorStore = await MemoryVectorStore.fromDocuments(\n-      splitDocs,\n+      enhancedDocs,\n       new OpenAIEmbeddings({\n         openAIApiKey: process.env.OPENAI_API_KEY,\n+        modelName: \"text-embedding-3-small\", // Newer, better model (default is ada-002)\n       })\n     );\n \n-    // Create retriever\n+    // Create retriever with MMR for better diversity\n+    // MMR (Maximum Marginal Relevance) retrieves diverse but relevant documents\n     const retriever = vectorStore.asRetriever({\n-      k: 3, // Return top 3 most relevant chunks\n+      searchType: \"mmr\", // Use MMR instead of similarity\n+      searchKwargs: {\n+        k: 6, // Increased from 3 to 6 for more context\n+        fetchK: 20, // Fetch 20 candidates, then pick 6 best with MMR\n+        lambda: 0.5, // Balance between relevance (1.0) and diversity (0.0)\n+      },\n     });\n \n     return {\n       retriever,\n       vectorStore,\n-      documentCount: splitDocs.length,\n-      chunks: splitDocs,\n+      documentCount: enhancedDocs.length,\n+      chunks: enhancedDocs,\n     };\n   } catch (error) {\n     console.error(\"Error processing leaflet:\", error);\n     throw error;\n   }\n }\n \n-// Simple function to query the leaflet using retriever + LLM\n+// Improved function to query the leaflet with better RAG patterns\n export async function queryLeaflet(retriever: any, question: string) {\n   try {\n-    // Get relevant documents\n+    // Get relevant documents using the retriever\n     const relevantDocs = await retriever.getRelevantDocuments(question);\n \n-    // Create context from relevant documents\n-    const context = relevantDocs\n-      .map((doc: any) => doc.pageContent)\n-      .join(\"\\n\\n\");\n+    // Format context with page numbers for better citations\n+    const contextWithPages = relevantDocs\n+      .map((doc: any, idx: number) => {\n+        const page = doc.metadata?.page || \"desconhecida\";\n+        return `[P\u00e1gina ${page}]\\n${doc.pageContent}`;\n+      })\n+      .join(\"\\n\\n---\\n\\n\");\n \n-    // Create prompt template\n-    const prompt = ChatPromptTemplate.fromTemplate(`\n-You are a helpful medical assistant that provides information ONLY from the patient information leaflet.\n+    // Extract unique page numbers for reference\n+    const pageNumbers = [...new Set(\n+      relevantDocs\n+        .map((doc: any) => doc.metadata?.page)\n+        .filter((page: any) => page !== undefined && page !== 0)\n+    )].sort((a: number, b: number) => a - b);\n \n-Answer questions based ONLY on the following context from the patient leaflet:\n+    // Improved prompt template with explicit page citation instructions\n+    const prompt = ChatPromptTemplate.fromTemplate(`\n+Voc\u00ea \u00e9 um assistente m\u00e9dico especializado em fornecer informa\u00e7\u00f5es APENAS do folheto informativo do paciente.\n \n+Contexto do folheto (com indica\u00e7\u00e3o de p\u00e1ginas):\n {context}\n \n-Question: {question}\n+Quest\u00e3o do paciente: {question}\n \n-Instructions:\n-- Only use information explicitly stated in the leaflet context above\n-- If the information is not in the leaflet, say \"I don't see information about this in the patient leaflet\" and suggest consulting a healthcare professional\n-- Do not make up or infer information not explicitly stated in the leaflet\n-- Be precise and cite specific sections when possible\n-- Always recommend consulting healthcare professionals for personalized medical advice\n-- Always reply in portuguese.\n+Instru\u00e7\u00f5es importantes:\n+1. Responda APENAS com base no contexto fornecido acima\n+2. Quando citar informa\u00e7\u00f5es, mencione a p\u00e1gina: \"De acordo com a p\u00e1gina X, ...\" ou \"Conforme indicado na p\u00e1gina X, ...\"\n+3. Se a informa\u00e7\u00e3o n\u00e3o estiver no folheto, diga: \"N\u00e3o encontro essa informa\u00e7\u00e3o no folheto informativo. Recomendo consultar um profissional de sa\u00fade.\"\n+4. N\u00e3o invente ou infira informa\u00e7\u00f5es que n\u00e3o estejam explicitamente no contexto\n+5. Seja preciso e cite se\u00e7\u00f5es espec\u00edficas quando poss\u00edvel\n+6. Sempre recomende consultar profissionais de sa\u00fade para aconselhamento m\u00e9dico personalizado\n+7. Use uma linguagem clara e acess\u00edvel\n+8. Organize a resposta de forma estruturada quando apropriado\n \n-Answer:\n+P\u00e1ginas relevantes encontradas: {pages}\n+\n+Resposta:\n     `);\n \n-    // Create chat model\n+    // Use gpt-4o-mini - better quality, faster, and cheaper than gpt-4.1-nano\n+    // gpt-4o-mini has 128k context window and better instruction following\n     const llm = new ChatOpenAI({\n-      modelName: \"gpt-4.1-nano\",\n-      temperature: 0,\n+      modelName: \"gpt-4o-mini\", // Updated from gpt-4.1-nano\n+      temperature: 0.1, // Slightly increased for more natural language, but still mostly deterministic\n       openAIApiKey: process.env.OPENAI_API_KEY,\n+      maxTokens: 1000, // Limit response length\n     });\n \n-    // Format the prompt\n-    const formattedPrompt = await prompt.format({\n-      context: context,\n-      question: question,\n-    });\n-\n-    // Get response from LLM\n-    const response = await llm.invoke(formattedPrompt);\n+    // Create a LangChain runnable sequence (modern pattern)\n+    const chain = RunnableSequence.from([\n+      {\n+        context: () => contextWithPages,\n+        question: (input: { question: string }) => input.question,\n+        pages: () => pageNumbers.length > 0\n+          ? pageNumbers.join(\", \")\n+          : \"P\u00e1ginas n\u00e3o identificadas\",\n+      },\n+      prompt,\n+      llm,\n+      new StringOutputParser(),\n+    ]);\n+\n+    // Invoke the chain\n+    const answer = await chain.invoke({ question });\n \n     return {\n-      answer: response.content,\n+      answer,\n       sourceDocuments: relevantDocs,\n-      context: context,\n+      context: contextWithPages,\n+      pageNumbers, // Return page numbers for UI display\n+      relevantPages: pageNumbers,\n     };\n   } catch (error) {\n     console.error(\"Error querying leaflet:\", error);\n     throw error;\n   }\n }\n+\n+// Optional: Streaming version for better UX (can be implemented later)\n+export async function queryLeafletStream(retriever: any, question: string) {\n+  // Similar to above but with streaming support\n+  // Can be implemented if you want to show progressive responses\n+  // For now, this is a placeholder for future enhancement\n+  throw new Error(\"Streaming not implemented yet\");\n+}",
      "patch_lines": [
        "@@ -4,6 +4,9 @@ import { OpenAIEmbeddings } from \"@langchain/openai\";\n",
        " import { MemoryVectorStore } from \"langchain/vectorstores/memory\";\n",
        " import { ChatOpenAI } from \"@langchain/openai\";\n",
        " import { ChatPromptTemplate } from \"@langchain/core/prompts\";\n",
        "+import { StringOutputParser } from \"@langchain/core/output_parsers\";\n",
        "+import { RunnableSequence } from \"@langchain/core/runnables\";\n",
        "+import { Document } from \"@langchain/core/documents\";\n",
        " \n",
        " // Process PDF and create a retriever\n",
        " export async function processLeaflet(pdfBase64: string) {\n",
        "@@ -18,93 +21,151 @@ export async function processLeaflet(pdfBase64: string) {\n",
        "     const loader = new PDFLoader(blob);\n",
        "     const docs = await loader.load();\n",
        " \n",
        "-    // Split into chunks\n",
        "+    // Split into chunks with better parameters for medical documents\n",
        "+    // Medical PDFs often have dense information, so slightly smaller chunks work better\n",
        "     const splitter = new RecursiveCharacterTextSplitter({\n",
        "-      chunkSize: 1000,\n",
        "-      chunkOverlap: 200,\n",
        "+      chunkSize: 800,  // Reduced from 1000 for more precise retrieval\n",
        "+      chunkOverlap: 150, // Reduced from 200 to avoid too much duplication\n",
        "+      separators: [\"\\n\\n\", \"\\n\", \". \", \" \", \"\"], // Prioritize paragraph breaks\n",
        "     });\n",
        "+\n",
        "     const splitDocs = await splitter.splitDocuments(docs);\n",
        " \n",
        "-    // Create vector store\n",
        "+    // Enhance documents with page number metadata\n",
        "+    const enhancedDocs = splitDocs.map((doc) => {\n",
        "+      // Extract page number from metadata (PDFLoader provides this)\n",
        "+      const pageNum = doc.metadata?.loc?.pageNumber || doc.metadata?.page || 0;\n",
        "+\n",
        "+      return new Document({\n",
        "+        pageContent: doc.pageContent,\n",
        "+        metadata: {\n",
        "+          ...doc.metadata,\n",
        "+          page: pageNum,\n",
        "+          source: \"patient_leaflet\",\n",
        "+        },\n",
        "+      });\n",
        "+    });\n",
        "+\n",
        "+    // Create vector store with better embeddings model\n",
        "     const vectorStore = await MemoryVectorStore.fromDocuments(\n",
        "-      splitDocs,\n",
        "+      enhancedDocs,\n",
        "       new OpenAIEmbeddings({\n",
        "         openAIApiKey: process.env.OPENAI_API_KEY,\n",
        "+        modelName: \"text-embedding-3-small\", // Newer, better model (default is ada-002)\n",
        "       })\n",
        "     );\n",
        " \n",
        "-    // Create retriever\n",
        "+    // Create retriever with MMR for better diversity\n",
        "+    // MMR (Maximum Marginal Relevance) retrieves diverse but relevant documents\n",
        "     const retriever = vectorStore.asRetriever({\n",
        "-      k: 3, // Return top 3 most relevant chunks\n",
        "+      searchType: \"mmr\", // Use MMR instead of similarity\n",
        "+      searchKwargs: {\n",
        "+        k: 6, // Increased from 3 to 6 for more context\n",
        "+        fetchK: 20, // Fetch 20 candidates, then pick 6 best with MMR\n",
        "+        lambda: 0.5, // Balance between relevance (1.0) and diversity (0.0)\n",
        "+      },\n",
        "     });\n",
        " \n",
        "     return {\n",
        "       retriever,\n",
        "       vectorStore,\n",
        "-      documentCount: splitDocs.length,\n",
        "-      chunks: splitDocs,\n",
        "+      documentCount: enhancedDocs.length,\n",
        "+      chunks: enhancedDocs,\n",
        "     };\n",
        "   } catch (error) {\n",
        "     console.error(\"Error processing leaflet:\", error);\n",
        "     throw error;\n",
        "   }\n",
        " }\n",
        " \n",
        "-// Simple function to query the leaflet using retriever + LLM\n",
        "+// Improved function to query the leaflet with better RAG patterns\n",
        " export async function queryLeaflet(retriever: any, question: string) {\n",
        "   try {\n",
        "-    // Get relevant documents\n",
        "+    // Get relevant documents using the retriever\n",
        "     const relevantDocs = await retriever.getRelevantDocuments(question);\n",
        " \n",
        "-    // Create context from relevant documents\n",
        "-    const context = relevantDocs\n",
        "-      .map((doc: any) => doc.pageContent)\n",
        "-      .join(\"\\n\\n\");\n",
        "+    // Format context with page numbers for better citations\n",
        "+    const contextWithPages = relevantDocs\n",
        "+      .map((doc: any, idx: number) => {\n",
        "+        const page = doc.metadata?.page || \"desconhecida\";\n",
        "+        return `[P\u00e1gina ${page}]\\n${doc.pageContent}`;\n",
        "+      })\n",
        "+      .join(\"\\n\\n---\\n\\n\");\n",
        " \n",
        "-    // Create prompt template\n",
        "-    const prompt = ChatPromptTemplate.fromTemplate(`\n",
        "-You are a helpful medical assistant that provides information ONLY from the patient information leaflet.\n",
        "+    // Extract unique page numbers for reference\n",
        "+    const pageNumbers = [...new Set(\n",
        "+      relevantDocs\n",
        "+        .map((doc: any) => doc.metadata?.page)\n",
        "+        .filter((page: any) => page !== undefined && page !== 0)\n",
        "+    )].sort((a: number, b: number) => a - b);\n",
        " \n",
        "-Answer questions based ONLY on the following context from the patient leaflet:\n",
        "+    // Improved prompt template with explicit page citation instructions\n",
        "+    const prompt = ChatPromptTemplate.fromTemplate(`\n",
        "+Voc\u00ea \u00e9 um assistente m\u00e9dico especializado em fornecer informa\u00e7\u00f5es APENAS do folheto informativo do paciente.\n",
        " \n",
        "+Contexto do folheto (com indica\u00e7\u00e3o de p\u00e1ginas):\n",
        " {context}\n",
        " \n",
        "-Question: {question}\n",
        "+Quest\u00e3o do paciente: {question}\n",
        " \n",
        "-Instructions:\n",
        "-- Only use information explicitly stated in the leaflet context above\n",
        "-- If the information is not in the leaflet, say \"I don't see information about this in the patient leaflet\" and suggest consulting a healthcare professional\n",
        "-- Do not make up or infer information not explicitly stated in the leaflet\n",
        "-- Be precise and cite specific sections when possible\n",
        "-- Always recommend consulting healthcare professionals for personalized medical advice\n",
        "-- Always reply in portuguese.\n",
        "+Instru\u00e7\u00f5es importantes:\n",
        "+1. Responda APENAS com base no contexto fornecido acima\n",
        "+2. Quando citar informa\u00e7\u00f5es, mencione a p\u00e1gina: \"De acordo com a p\u00e1gina X, ...\" ou \"Conforme indicado na p\u00e1gina X, ...\"\n",
        "+3. Se a informa\u00e7\u00e3o n\u00e3o estiver no folheto, diga: \"N\u00e3o encontro essa informa\u00e7\u00e3o no folheto informativo. Recomendo consultar um profissional de sa\u00fade.\"\n",
        "+4. N\u00e3o invente ou infira informa\u00e7\u00f5es que n\u00e3o estejam explicitamente no contexto\n",
        "+5. Seja preciso e cite se\u00e7\u00f5es espec\u00edficas quando poss\u00edvel\n",
        "+6. Sempre recomende consultar profissionais de sa\u00fade para aconselhamento m\u00e9dico personalizado\n",
        "+7. Use uma linguagem clara e acess\u00edvel\n",
        "+8. Organize a resposta de forma estruturada quando apropriado\n",
        " \n",
        "-Answer:\n",
        "+P\u00e1ginas relevantes encontradas: {pages}\n",
        "+\n",
        "+Resposta:\n",
        "     `);\n",
        " \n",
        "-    // Create chat model\n",
        "+    // Use gpt-4o-mini - better quality, faster, and cheaper than gpt-4.1-nano\n",
        "+    // gpt-4o-mini has 128k context window and better instruction following\n",
        "     const llm = new ChatOpenAI({\n",
        "-      modelName: \"gpt-4.1-nano\",\n",
        "-      temperature: 0,\n",
        "+      modelName: \"gpt-4o-mini\", // Updated from gpt-4.1-nano\n",
        "+      temperature: 0.1, // Slightly increased for more natural language, but still mostly deterministic\n",
        "       openAIApiKey: process.env.OPENAI_API_KEY,\n",
        "+      maxTokens: 1000, // Limit response length\n",
        "     });\n",
        " \n",
        "-    // Format the prompt\n",
        "-    const formattedPrompt = await prompt.format({\n",
        "-      context: context,\n",
        "-      question: question,\n",
        "-    });\n",
        "-\n",
        "-    // Get response from LLM\n",
        "-    const response = await llm.invoke(formattedPrompt);\n",
        "+    // Create a LangChain runnable sequence (modern pattern)\n",
        "+    const chain = RunnableSequence.from([\n",
        "+      {\n",
        "+        context: () => contextWithPages,\n",
        "+        question: (input: { question: string }) => input.question,\n",
        "+        pages: () => pageNumbers.length > 0\n",
        "+          ? pageNumbers.join(\", \")\n",
        "+          : \"P\u00e1ginas n\u00e3o identificadas\",\n",
        "+      },\n",
        "+      prompt,\n",
        "+      llm,\n",
        "+      new StringOutputParser(),\n",
        "+    ]);\n",
        "+\n",
        "+    // Invoke the chain\n",
        "+    const answer = await chain.invoke({ question });\n",
        " \n",
        "     return {\n",
        "-      answer: response.content,\n",
        "+      answer,\n",
        "       sourceDocuments: relevantDocs,\n",
        "-      context: context,\n",
        "+      context: contextWithPages,\n",
        "+      pageNumbers, // Return page numbers for UI display\n",
        "+      relevantPages: pageNumbers,\n",
        "     };\n",
        "   } catch (error) {\n",
        "     console.error(\"Error querying leaflet:\", error);\n",
        "     throw error;\n",
        "   }\n",
        " }\n",
        "+\n",
        "+// Optional: Streaming version for better UX (can be implemented later)\n",
        "+export async function queryLeafletStream(retriever: any, question: string) {\n",
        "+  // Similar to above but with streaming support\n",
        "+  // Can be implemented if you want to show progressive responses\n",
        "+  // For now, this is a placeholder for future enhancement\n",
        "+  throw new Error(\"Streaming not implemented yet\");\n",
        "+}\n"
      ]
    },
    {
      "path": "app/hooks/useMediaQuery.ts",
      "status": "added",
      "additions": 23,
      "deletions": 0,
      "patch": "@@ -0,0 +1,23 @@\n+import { useState, useEffect } from \"react\";\n+\n+export const useMediaQuery = (query: string): boolean => {\n+  const [matches, setMatches] = useState<boolean>(false);\n+\n+  useEffect(() => {\n+    const media = window.matchMedia(query);\n+\n+    // Set initial value\n+    setMatches(media.matches);\n+\n+    // Create listener function\n+    const listener = (e: MediaQueryListEvent) => setMatches(e.matches);\n+\n+    // Add listener\n+    media.addEventListener(\"change\", listener);\n+\n+    // Cleanup\n+    return () => media.removeEventListener(\"change\", listener);\n+  }, [query]);\n+\n+  return matches;\n+};",
      "patch_lines": [
        "@@ -0,0 +1,23 @@\n",
        "+import { useState, useEffect } from \"react\";\n",
        "+\n",
        "+export const useMediaQuery = (query: string): boolean => {\n",
        "+  const [matches, setMatches] = useState<boolean>(false);\n",
        "+\n",
        "+  useEffect(() => {\n",
        "+    const media = window.matchMedia(query);\n",
        "+\n",
        "+    // Set initial value\n",
        "+    setMatches(media.matches);\n",
        "+\n",
        "+    // Create listener function\n",
        "+    const listener = (e: MediaQueryListEvent) => setMatches(e.matches);\n",
        "+\n",
        "+    // Add listener\n",
        "+    media.addEventListener(\"change\", listener);\n",
        "+\n",
        "+    // Cleanup\n",
        "+    return () => media.removeEventListener(\"change\", listener);\n",
        "+  }, [query]);\n",
        "+\n",
        "+  return matches;\n",
        "+};\n"
      ]
    },
    {
      "path": "app/hooks/useScrollToBottom.ts",
      "status": "added",
      "additions": 41,
      "deletions": 0,
      "patch": "@@ -0,0 +1,41 @@\n+import { useState, useEffect, RefObject } from \"react\";\n+\n+interface UseScrollToBottomOptions {\n+  threshold?: number; // pixels from bottom to show button\n+}\n+\n+export const useScrollToBottom = (\n+  scrollRef: RefObject<HTMLDivElement>,\n+  options: UseScrollToBottomOptions = {}\n+) => {\n+  const { threshold = 100 } = options;\n+  const [showScrollButton, setShowScrollButton] = useState(false);\n+  const [isAtBottom, setIsAtBottom] = useState(true);\n+\n+  useEffect(() => {\n+    const scrollContainer = scrollRef.current;\n+    if (!scrollContainer) return;\n+\n+    const handleScroll = () => {\n+      const { scrollTop, scrollHeight, clientHeight } = scrollContainer;\n+      const distanceFromBottom = scrollHeight - scrollTop - clientHeight;\n+\n+      setIsAtBottom(distanceFromBottom < threshold);\n+      setShowScrollButton(distanceFromBottom > threshold);\n+    };\n+\n+    scrollContainer.addEventListener(\"scroll\", handleScroll);\n+    handleScroll(); // Check initial state\n+\n+    return () => scrollContainer.removeEventListener(\"scroll\", handleScroll);\n+  }, [scrollRef, threshold]);\n+\n+  const scrollToBottom = (behavior: ScrollBehavior = \"smooth\") => {\n+    scrollRef.current?.scrollTo({\n+      top: scrollRef.current.scrollHeight,\n+      behavior,\n+    });\n+  };\n+\n+  return { showScrollButton, isAtBottom, scrollToBottom };\n+};",
      "patch_lines": [
        "@@ -0,0 +1,41 @@\n",
        "+import { useState, useEffect, RefObject } from \"react\";\n",
        "+\n",
        "+interface UseScrollToBottomOptions {\n",
        "+  threshold?: number; // pixels from bottom to show button\n",
        "+}\n",
        "+\n",
        "+export const useScrollToBottom = (\n",
        "+  scrollRef: RefObject<HTMLDivElement>,\n",
        "+  options: UseScrollToBottomOptions = {}\n",
        "+) => {\n",
        "+  const { threshold = 100 } = options;\n",
        "+  const [showScrollButton, setShowScrollButton] = useState(false);\n",
        "+  const [isAtBottom, setIsAtBottom] = useState(true);\n",
        "+\n",
        "+  useEffect(() => {\n",
        "+    const scrollContainer = scrollRef.current;\n",
        "+    if (!scrollContainer) return;\n",
        "+\n",
        "+    const handleScroll = () => {\n",
        "+      const { scrollTop, scrollHeight, clientHeight } = scrollContainer;\n",
        "+      const distanceFromBottom = scrollHeight - scrollTop - clientHeight;\n",
        "+\n",
        "+      setIsAtBottom(distanceFromBottom < threshold);\n",
        "+      setShowScrollButton(distanceFromBottom > threshold);\n",
        "+    };\n",
        "+\n",
        "+    scrollContainer.addEventListener(\"scroll\", handleScroll);\n",
        "+    handleScroll(); // Check initial state\n",
        "+\n",
        "+    return () => scrollContainer.removeEventListener(\"scroll\", handleScroll);\n",
        "+  }, [scrollRef, threshold]);\n",
        "+\n",
        "+  const scrollToBottom = (behavior: ScrollBehavior = \"smooth\") => {\n",
        "+    scrollRef.current?.scrollTo({\n",
        "+      top: scrollRef.current.scrollHeight,\n",
        "+      behavior,\n",
        "+    });\n",
        "+  };\n",
        "+\n",
        "+  return { showScrollButton, isAtBottom, scrollToBottom };\n",
        "+};\n"
      ]
    },
    {
      "path": "app/index.css",
      "status": "modified",
      "additions": 74,
      "deletions": 0,
      "patch": "@@ -1 +1,75 @@\n @import \"tailwindcss\";\n+\n+/* Global styles */\n+@layer base {\n+  * {\n+    @apply box-border;\n+  }\n+\n+  html {\n+    @apply h-full;\n+  }\n+\n+  body {\n+    @apply h-full m-0 p-0 font-sans antialiased;\n+  }\n+\n+  #root {\n+    @apply h-full;\n+  }\n+}\n+\n+/* Custom utilities */\n+@layer utilities {\n+  /* Smooth scrolling */\n+  .scroll-smooth {\n+    scroll-behavior: smooth;\n+  }\n+\n+  /* Custom scrollbar */\n+  .scrollbar-thin::-webkit-scrollbar {\n+    width: 0.5rem;\n+  }\n+\n+  .scrollbar-thin::-webkit-scrollbar-track {\n+    @apply bg-gray-100;\n+  }\n+\n+  .scrollbar-thin::-webkit-scrollbar-thumb {\n+    @apply bg-gray-300 rounded-full;\n+  }\n+\n+  .scrollbar-thin::-webkit-scrollbar-thumb:hover {\n+    @apply bg-gray-400;\n+  }\n+\n+  /* Fade in animation */\n+  @keyframes fadeIn {\n+    from {\n+      opacity: 0;\n+      transform: translateY(0.5rem);\n+    }\n+    to {\n+      opacity: 1;\n+      transform: translateY(0);\n+    }\n+  }\n+\n+  .animate-fade-in {\n+    animation: fadeIn 0.3s ease-in-out;\n+  }\n+\n+  /* Slide in from right */\n+  @keyframes slideInRight {\n+    from {\n+      transform: translateX(100%);\n+    }\n+    to {\n+      transform: translateX(0);\n+    }\n+  }\n+\n+  .animate-slide-in-right {\n+    animation: slideInRight 0.3s ease-out;\n+  }\n+}",
      "patch_lines": [
        "@@ -1 +1,75 @@\n",
        " @import \"tailwindcss\";\n",
        "+\n",
        "+/* Global styles */\n",
        "+@layer base {\n",
        "+  * {\n",
        "+    @apply box-border;\n",
        "+  }\n",
        "+\n",
        "+  html {\n",
        "+    @apply h-full;\n",
        "+  }\n",
        "+\n",
        "+  body {\n",
        "+    @apply h-full m-0 p-0 font-sans antialiased;\n",
        "+  }\n",
        "+\n",
        "+  #root {\n",
        "+    @apply h-full;\n",
        "+  }\n",
        "+}\n",
        "+\n",
        "+/* Custom utilities */\n",
        "+@layer utilities {\n",
        "+  /* Smooth scrolling */\n",
        "+  .scroll-smooth {\n",
        "+    scroll-behavior: smooth;\n",
        "+  }\n",
        "+\n",
        "+  /* Custom scrollbar */\n",
        "+  .scrollbar-thin::-webkit-scrollbar {\n",
        "+    width: 0.5rem;\n",
        "+  }\n",
        "+\n",
        "+  .scrollbar-thin::-webkit-scrollbar-track {\n",
        "+    @apply bg-gray-100;\n",
        "+  }\n",
        "+\n",
        "+  .scrollbar-thin::-webkit-scrollbar-thumb {\n",
        "+    @apply bg-gray-300 rounded-full;\n",
        "+  }\n",
        "+\n",
        "+  .scrollbar-thin::-webkit-scrollbar-thumb:hover {\n",
        "+    @apply bg-gray-400;\n",
        "+  }\n",
        "+\n",
        "+  /* Fade in animation */\n",
        "+  @keyframes fadeIn {\n",
        "+    from {\n",
        "+      opacity: 0;\n",
        "+      transform: translateY(0.5rem);\n",
        "+    }\n",
        "+    to {\n",
        "+      opacity: 1;\n",
        "+      transform: translateY(0);\n",
        "+    }\n",
        "+  }\n",
        "+\n",
        "+  .animate-fade-in {\n",
        "+    animation: fadeIn 0.3s ease-in-out;\n",
        "+  }\n",
        "+\n",
        "+  /* Slide in from right */\n",
        "+  @keyframes slideInRight {\n",
        "+    from {\n",
        "+      transform: translateX(100%);\n",
        "+    }\n",
        "+    to {\n",
        "+      transform: translateX(0);\n",
        "+    }\n",
        "+  }\n",
        "+\n",
        "+  .animate-slide-in-right {\n",
        "+    animation: slideInRight 0.3s ease-out;\n",
        "+  }\n",
        "+}\n"
      ]
    },
    {
      "path": "app/server/queryLeaflet.ts",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "patch": "@@ -22,13 +22,17 @@ export const queryLeafletPdf = createServerFn({\n         success: true,\n         answer: result.answer,\n         sourceCount: result.sourceDocuments.length,\n+        pageNumbers: result.pageNumbers || [], // Include page numbers for citation\n+        relevantPages: result.relevantPages || [], // Include relevant pages\n       };\n     } catch (error) {\n       console.error(\"Error querying leaflet:\", error);\n       return {\n         success: false,\n         error: error instanceof Error ? error.message : \"Unknown error\",\n-        answer: \"Sorry, I encountered an error while processing your question.\",\n+        answer: \"Desculpe, encontrei um erro ao processar a sua quest\u00e3o. Por favor, tente novamente.\",\n+        pageNumbers: [],\n+        relevantPages: [],\n       };\n     }\n   });",
      "patch_lines": [
        "@@ -22,13 +22,17 @@ export const queryLeafletPdf = createServerFn({\n",
        "         success: true,\n",
        "         answer: result.answer,\n",
        "         sourceCount: result.sourceDocuments.length,\n",
        "+        pageNumbers: result.pageNumbers || [], // Include page numbers for citation\n",
        "+        relevantPages: result.relevantPages || [], // Include relevant pages\n",
        "       };\n",
        "     } catch (error) {\n",
        "       console.error(\"Error querying leaflet:\", error);\n",
        "       return {\n",
        "         success: false,\n",
        "         error: error instanceof Error ? error.message : \"Unknown error\",\n",
        "-        answer: \"Sorry, I encountered an error while processing your question.\",\n",
        "+        answer: \"Desculpe, encontrei um erro ao processar a sua quest\u00e3o. Por favor, tente novamente.\",\n",
        "+        pageNumbers: [],\n",
        "+        relevantPages: [],\n",
        "       };\n",
        "     }\n",
        "   });\n"
      ]
    },
    {
      "path": "app/utils/parseReferences.tsx",
      "status": "added",
      "additions": 81,
      "deletions": 0,
      "patch": "@@ -0,0 +1,81 @@\n+import { ReactNode } from \"react\";\n+\n+interface ParseReferencesOptions {\n+  onPageClick: (page: number) => void;\n+}\n+\n+/**\n+ * Parses text content and converts page references into clickable buttons\n+ * Supports patterns like:\n+ * - \"p\u00e1gina 3\", \"p\u00e1ginas 3\", \"pagina 3\"\n+ * - \"page 3\", \"pages 3\"\n+ * - \"p. 3\", \"p.3\"\n+ * - \"p\u00e1g. 3\", \"pag. 3\"\n+ * - \"(ver p\u00e1gina 3)\", \"(consulte p\u00e1gina 3)\"\n+ * - \"sec\u00e7\u00e3o 3\", \"section 3\"\n+ * - Numbers alone in context like \"...informa\u00e7\u00f5es na 3 do folheto\"\n+ */\n+export function parseMessageWithReferences(\n+  text: string,\n+  options: ParseReferencesOptions\n+): ReactNode[] {\n+  const { onPageClick } = options;\n+\n+  // More comprehensive regex pattern to match various page reference formats\n+  // Matches: \"p\u00e1gina 3\", \"page 3\", \"p. 3\", \"p\u00e1g. 3\", \"sec\u00e7\u00e3o 3\", etc.\n+  // Also matches: \"na p\u00e1gina\", \"da p\u00e1gina\", \"para a p\u00e1gina\", etc.\n+  const pageReferencePattern =\n+    /(\\(?\\s*(?:ver|consulte|consultar|veja|check|see)?\\s*(?:(?:na|da|pela|pelo|para\\s+a|com\\s+a|de\\s+a|em\\s+a)\\s+|(?:a\\s+)?)(?:p\u00e1gina|pagina|p\u00e1ginas|paginas|page|pages|p\u00e1g\\.|pag\\.|p\\.|sec\u00e7\u00e3o|se\u00e7\u00e3o|seccion|section|folha)\\s*(\\d+)(?:\\s*[-\u2013\u2014]\\s*(\\d+))?\\s*\\)?)/gi;\n+\n+  const parts: ReactNode[] = [];\n+  let lastIndex = 0;\n+  let match;\n+\n+  // Reset regex lastIndex\n+  pageReferencePattern.lastIndex = 0;\n+\n+  let matchCount = 0;\n+  while ((match = pageReferencePattern.exec(text)) !== null) {\n+    matchCount++;\n+    const fullMatch = match[0];\n+    const pageNumber = parseInt(match[2], 10);\n+    const matchIndex = match.index;\n+\n+    // Add text before the match\n+    if (matchIndex > lastIndex) {\n+      parts.push(text.substring(lastIndex, matchIndex));\n+    }\n+\n+    // Add clickable page reference\n+    parts.push(\n+      <button\n+        key={`page-ref-${matchIndex}-${pageNumber}-${matchCount}`}\n+        onClick={(e) => {\n+          e.preventDefault();\n+          e.stopPropagation();\n+          console.log(`Clicking page reference: ${pageNumber}`);\n+          onPageClick(pageNumber);\n+        }}\n+        className=\"inline-flex items-center mx-1 px-2 py-0.5 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded text-xs font-medium transition-colors cursor-pointer border border-blue-300 hover:shadow-sm\"\n+        title={`Ir para p\u00e1gina ${pageNumber}`}\n+      >\n+        \ud83d\udcc4 {fullMatch.trim()}\n+      </button>\n+    );\n+\n+    lastIndex = matchIndex + fullMatch.length;\n+  }\n+\n+  // Add remaining text after last match\n+  if (lastIndex < text.length) {\n+    parts.push(text.substring(lastIndex));\n+  }\n+\n+  // Debug logging\n+  if (matchCount > 0) {\n+    console.log(`Found ${matchCount} page references in message`);\n+  }\n+\n+  // If no matches found, return original text\n+  return parts.length > 0 ? parts : [text];\n+}",
      "patch_lines": [
        "@@ -0,0 +1,81 @@\n",
        "+import { ReactNode } from \"react\";\n",
        "+\n",
        "+interface ParseReferencesOptions {\n",
        "+  onPageClick: (page: number) => void;\n",
        "+}\n",
        "+\n",
        "+/**\n",
        "+ * Parses text content and converts page references into clickable buttons\n",
        "+ * Supports patterns like:\n",
        "+ * - \"p\u00e1gina 3\", \"p\u00e1ginas 3\", \"pagina 3\"\n",
        "+ * - \"page 3\", \"pages 3\"\n",
        "+ * - \"p. 3\", \"p.3\"\n",
        "+ * - \"p\u00e1g. 3\", \"pag. 3\"\n",
        "+ * - \"(ver p\u00e1gina 3)\", \"(consulte p\u00e1gina 3)\"\n",
        "+ * - \"sec\u00e7\u00e3o 3\", \"section 3\"\n",
        "+ * - Numbers alone in context like \"...informa\u00e7\u00f5es na 3 do folheto\"\n",
        "+ */\n",
        "+export function parseMessageWithReferences(\n",
        "+  text: string,\n",
        "+  options: ParseReferencesOptions\n",
        "+): ReactNode[] {\n",
        "+  const { onPageClick } = options;\n",
        "+\n",
        "+  // More comprehensive regex pattern to match various page reference formats\n",
        "+  // Matches: \"p\u00e1gina 3\", \"page 3\", \"p. 3\", \"p\u00e1g. 3\", \"sec\u00e7\u00e3o 3\", etc.\n",
        "+  // Also matches: \"na p\u00e1gina\", \"da p\u00e1gina\", \"para a p\u00e1gina\", etc.\n",
        "+  const pageReferencePattern =\n",
        "+    /(\\(?\\s*(?:ver|consulte|consultar|veja|check|see)?\\s*(?:(?:na|da|pela|pelo|para\\s+a|com\\s+a|de\\s+a|em\\s+a)\\s+|(?:a\\s+)?)(?:p\u00e1gina|pagina|p\u00e1ginas|paginas|page|pages|p\u00e1g\\.|pag\\.|p\\.|sec\u00e7\u00e3o|se\u00e7\u00e3o|seccion|section|folha)\\s*(\\d+)(?:\\s*[-\u2013\u2014]\\s*(\\d+))?\\s*\\)?)/gi;\n",
        "+\n",
        "+  const parts: ReactNode[] = [];\n",
        "+  let lastIndex = 0;\n",
        "+  let match;\n",
        "+\n",
        "+  // Reset regex lastIndex\n",
        "+  pageReferencePattern.lastIndex = 0;\n",
        "+\n",
        "+  let matchCount = 0;\n",
        "+  while ((match = pageReferencePattern.exec(text)) !== null) {\n",
        "+    matchCount++;\n",
        "+    const fullMatch = match[0];\n",
        "+    const pageNumber = parseInt(match[2], 10);\n",
        "+    const matchIndex = match.index;\n",
        "+\n",
        "+    // Add text before the match\n",
        "+    if (matchIndex > lastIndex) {\n",
        "+      parts.push(text.substring(lastIndex, matchIndex));\n",
        "+    }\n",
        "+\n",
        "+    // Add clickable page reference\n",
        "+    parts.push(\n",
        "+      <button\n",
        "+        key={`page-ref-${matchIndex}-${pageNumber}-${matchCount}`}\n",
        "+        onClick={(e) => {\n",
        "+          e.preventDefault();\n",
        "+          e.stopPropagation();\n",
        "+          console.log(`Clicking page reference: ${pageNumber}`);\n",
        "+          onPageClick(pageNumber);\n",
        "+        }}\n",
        "+        className=\"inline-flex items-center mx-1 px-2 py-0.5 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded text-xs font-medium transition-colors cursor-pointer border border-blue-300 hover:shadow-sm\"\n",
        "+        title={`Ir para p\u00e1gina ${pageNumber}`}\n",
        "+      >\n",
        "+        \ud83d\udcc4 {fullMatch.trim()}\n",
        "+      </button>\n",
        "+    );\n",
        "+\n",
        "+    lastIndex = matchIndex + fullMatch.length;\n",
        "+  }\n",
        "+\n",
        "+  // Add remaining text after last match\n",
        "+  if (lastIndex < text.length) {\n",
        "+    parts.push(text.substring(lastIndex));\n",
        "+  }\n",
        "+\n",
        "+  // Debug logging\n",
        "+  if (matchCount > 0) {\n",
        "+    console.log(`Found ${matchCount} page references in message`);\n",
        "+  }\n",
        "+\n",
        "+  // If no matches found, return original text\n",
        "+  return parts.length > 0 ? parts : [text];\n",
        "+}\n"
      ]
    },
    {
      "path": "package-lock.json",
      "status": "modified",
      "additions": 317,
      "deletions": 2,
      "patch": "@@ -7,6 +7,7 @@\n     \"\": {\n       \"name\": \"medabot\",\n       \"version\": \"1.0.0\",\n+      \"hasInstallScript\": true,\n       \"license\": \"ISC\",\n       \"dependencies\": {\n         \"@langchain/community\": \"^0.3.44\",\n@@ -17,9 +18,11 @@\n         \"langchain\": \"^0.3.27\",\n         \"openai\": \"^4.87.3\",\n         \"pdf-parse\": \"^1.1.1\",\n+        \"pdfjs-dist\": \"^5.4.394\",\n         \"playwright\": \"^1.51.0\",\n         \"react\": \"^19.0.0\",\n         \"react-dom\": \"^19.0.0\",\n+        \"react-pdf\": \"^10.2.0\",\n         \"react-webcam\": \"^7.2.0\",\n         \"tailwindcss\": \"^4.0.14\",\n         \"vinxi\": \"^0.5.3\",\n@@ -1720,6 +1723,191 @@\n         \"node\": \">=10\"\n       }\n     },\n+    \"node_modules/@napi-rs/canvas\": {\n+      \"version\": \"0.1.81\",\n+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas/-/canvas-0.1.81.tgz\",\n+      \"integrity\": \"sha512-ReCjd5SYI/UKx/olaQLC4GtN6wUQGjlgHXs1lvUvWGXfBMR3Fxnik3cL+OxKN5ithNdoU0/GlCrdKcQDFh2XKQ==\",\n+      \"license\": \"MIT\",\n+      \"optional\": true,\n+      \"workspaces\": [\n+        \"e2e/*\"\n+      ],\n+      \"engines\": {\n+        \"node\": \">= 10\"\n+      },\n+      \"optionalDependencies\": {\n+        \"@napi-rs/canvas-android-arm64\": \"0.1.81\",\n+        \"@napi-rs/canvas-darwin-arm64\": \"0.1.81\",\n+        \"@napi-rs/canvas-darwin-x64\": \"0.1.81\",\n+        \"@napi-rs/canvas-linux-arm-gnueabihf\": \"0.1.81\",\n+        \"@napi-rs/canvas-linux-arm64-gnu\": \"0.1.81\",\n+        \"@napi-rs/canvas-linux-arm64-musl\": \"0.1.81\",\n+        \"@napi-rs/canvas-linux-riscv64-gnu\": \"0.1.81\",\n+        \"@napi-rs/canvas-linux-x64-gnu\": \"0.1.81\",\n+        \"@napi-rs/canvas-linux-x64-musl\": \"0.1.81\",\n+        \"@napi-rs/canvas-win32-x64-msvc\": \"0.1.81\"\n+      }\n+    },\n+    \"node_modules/@napi-rs/canvas-android-arm64\": {\n+      \"version\": \"0.1.81\",\n+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-android-arm64/-/canvas-android-arm64-0.1.81.tgz\",\n+      \"integrity\": \"sha512-78Lz+AUi+MsWupyZjXwpwQrp1QCwncPvRZrdvrROcZ9Gq9grP7LfQZiGdR8LKyHIq3OR18mDP+JESGT15V1nXw==\",\n+      \"cpu\": [\n+        \"arm64\"\n+      ],\n+      \"license\": \"MIT\",\n+      \"optional\": true,\n+      \"os\": [\n+        \"android\"\n+      ],\n+      \"engines\": {\n+        \"node\": \">= 10\"\n+      }\n+    },\n+    \"node_modules/@napi-rs/canvas-darwin-arm64\": {\n+      \"version\": \"0.1.81\",\n+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-darwin-arm64/-/canvas-darwin-arm64-0.1.81.tgz\",\n+      \"integrity\": \"sha512-omejuKgHWKDGoh8rsgsyhm/whwxMaryTQjJTd9zD7hiB9/rzcEEJLHnzXWR5ysy4/tTjHaQotE6k2t8eodTLnA==\",\n+      \"cpu\": [\n+        \"arm64\"\n+      ],\n+      \"license\": \"MIT\",\n+      \"optional\": true,\n+      \"os\": [\n+        \"darwin\"\n+      ],\n+      \"engines\": {\n+        \"node\": \">= 10\"\n+      }\n+    },\n+    \"node_modules/@napi-rs/canvas-darwin-x64\": {\n+      \"version\": \"0.1.81\",\n+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-darwin-x64/-/canvas-darwin-x64-0.1.81.tgz\",\n+      \"integrity\": \"sha512-EYfk+co6BElq5DXNH9PBLYDYwc4QsvIVbyrsVHsxVpn4p6Y3/s8MChgC69AGqj3vzZBQ1qx2CRCMtg5cub+XuQ==\",\n+      \"cpu\": [\n+        \"x64\"\n+      ],\n+      \"license\": \"MIT\",\n+      \"optional\": true,\n+      \"os\": [\n+        \"darwin\"\n+      ],\n+      \"engines\": {\n+        \"node\": \">= 10\"\n+      }\n+    },\n+    \"node_modules/@napi-rs/canvas-linux-arm-gnueabihf\": {\n+      \"version\": \"0.1.81\",\n+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-arm-gnueabihf/-/canvas-linux-arm-gnueabihf-0.1.81.tgz\",\n+      \"integrity\": \"sha512-teh6Q74CyAcH31yLNQGR9MtXSFxlZa5CI6vvNUISI14gWIJWrhOwUAOly+KRe1aztWR0FWTVSPxM4p5y+06aow==\",\n+      \"cpu\": [\n+        \"arm\"\n+      ],\n+      \"license\": \"MIT\",\n+      \"optional\": true,\n+      \"os\": [\n+        \"linux\"\n+      ],\n+      \"engines\": {\n+        \"node\": \">= 10\"\n+      }\n+    },\n+    \"node_modules/@napi-rs/canvas-linux-arm64-gnu\": {\n+      \"version\": \"0.1.81\",\n+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-arm64-gnu/-/canvas-linux-arm64-gnu-0.1.81.tgz\",\n+      \"integrity\": \"sha512-AGEopHFYRzJOjxY+2G1RmHPRnuWvO3Qdhq7sIazlSjxb3Z6dZHg7OB/4ZimXaimPjDACm9qWa6t5bn9bhXvkcw==\",\n+      \"cpu\": [\n+        \"arm64\"\n+      ],\n+      \"license\": \"MIT\",\n+      \"optional\": true,\n+      \"os\": [\n+        \"linux\"\n+      ],\n+      \"engines\": {\n+        \"node\": \">= 10\"\n+      }\n+    },\n+    \"node_modules/@napi-rs/canvas-linux-arm64-musl\": {\n+      \"version\": \"0.1.81\",\n+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-arm64-musl/-/canvas-linux-arm64-musl-0.1.81.tgz\",\n+      \"integrity\": \"sha512-Bj3m1cl4GIhsigkdwOxii4g4Ump3/QhNpx85IgAlCCYXpaly6mcsWpuDYEabfIGWOWhDUNBOndaQUPfWK1czOQ==\",\n+      \"cpu\": [\n+        \"arm64\"\n+      ],\n+      \"license\": \"MIT\",\n+      \"optional\": true,\n+      \"os\": [\n+        \"linux\"\n+      ],\n+      \"engines\": {\n+        \"node\": \">= 10\"\n+      }\n+    },\n+    \"node_modules/@napi-rs/canvas-linux-riscv64-gnu\": {\n+      \"version\": \"0.1.81\",\n+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-riscv64-gnu/-/canvas-linux-riscv64-gnu-0.1.81.tgz\",\n+      \"integrity\": \"sha512-yg/5NkHykVdwPlD3XObwCa/EswkOwLHswJcI9rHrac+znHsmCSj5AMX/RTU9Z9F6lZTwL60JM2Esit33XhAMiw==\",\n+      \"cpu\": [\n+        \"riscv64\"\n+      ],\n+      \"license\": \"MIT\",\n+      \"optional\": true,\n+      \"os\": [\n+        \"linux\"\n+      ],\n+      \"engines\": {\n+        \"node\": \">= 10\"\n+      }\n+    },\n+    \"node_modules/@napi-rs/canvas-linux-x64-gnu\": {\n+      \"version\": \"0.1.81\",\n+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-x64-gnu/-/canvas-linux-x64-gnu-0.1.81.tgz\",\n+      \"integrity\": \"sha512-tPfMpSEBuV5dJSKexO/UZxpOqnYTaNbG8aKa1ek8QsWu+4SJ/foWkaxscra/RUv85vepx6WWDjzBNbNJsTnO0w==\",\n+      \"cpu\": [\n+        \"x64\"\n+      ],\n+      \"license\": \"MIT\",\n+      \"optional\": true,\n+      \"os\": [\n+        \"linux\"\n+      ],\n+      \"engines\": {\n+        \"node\": \">= 10\"\n+      }\n+    },\n+    \"node_modules/@napi-rs/canvas-linux-x64-musl\": {\n+      \"version\": \"0.1.81\",\n+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-x64-musl/-/canvas-linux-x64-musl-0.1.81.tgz\",\n+      \"integrity\": \"sha512-1L0xnYgzqn8Baef+inPvY4dKqdmw3KCBoe0NEDgezuBZN7MA5xElwifoG8609uNdrMtJ9J6QZarsslLRVqri7g==\",\n+      \"cpu\": [\n+        \"x64\"\n+      ],\n+      \"license\": \"MIT\",\n+      \"optional\": true,\n+      \"os\": [\n+        \"linux\"\n+      ],\n+      \"engines\": {\n+        \"node\": \">= 10\"\n+      }\n+    },\n+    \"node_modules/@napi-rs/canvas-win32-x64-msvc\": {\n+      \"version\": \"0.1.81\",\n+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-win32-x64-msvc/-/canvas-win32-x64-msvc-0.1.81.tgz\",\n+      \"integrity\": \"sha512-57ryVbhm/z7RE9/UVcS7mrLPdlayLesy+9U0Uf6epCoeSGrs99tfieCcgZWFbIgmByQ1AZnNtFI2N6huqDLlWQ==\",\n+      \"cpu\": [\n+        \"x64\"\n+      ],\n+      \"license\": \"MIT\",\n+      \"optional\": true,\n+      \"os\": [\n+        \"win32\"\n+      ],\n+      \"engines\": {\n+        \"node\": \">= 10\"\n+      }\n+    },\n     \"node_modules/@netlify/functions\": {\n       \"version\": \"3.0.0\",\n       \"resolved\": \"https://registry.npmjs.org/@netlify/functions/-/functions-3.0.0.tgz\",\n@@ -4727,7 +4915,7 @@\n       \"version\": \"19.0.10\",\n       \"resolved\": \"https://registry.npmjs.org/@types/react/-/react-19.0.10.tgz\",\n       \"integrity\": \"sha512-JuRQ9KXLEjaUNjTWpzuR231Z2WpIwczOkBEIvbHNCzQefFIT0L8IqE6NV6ULLyC1SI/i234JnDoMkfg+RjQj2g==\",\n-      \"dev\": true,\n+      \"devOptional\": true,\n       \"license\": \"MIT\",\n       \"dependencies\": {\n         \"csstype\": \"^3.0.2\"\n@@ -5635,6 +5823,15 @@\n         \"url\": \"https://github.com/chalk/wrap-ansi?sponsor=1\"\n       }\n     },\n+    \"node_modules/clsx\": {\n+      \"version\": \"2.1.1\",\n+      \"resolved\": \"https://registry.npmjs.org/clsx/-/clsx-2.1.1.tgz\",\n+      \"integrity\": \"sha512-eYm0QWBtUrBWZWG0d386OGAw16Z995PiOVo2B7bjWSbHedGl5e0ZWaq65kOGgUSNesEIDkB9ISbTg/JK9dhCZA==\",\n+      \"license\": \"MIT\",\n+      \"engines\": {\n+        \"node\": \">=6\"\n+      }\n+    },\n     \"node_modules/cluster-key-slot\": {\n       \"version\": \"1.1.2\",\n       \"resolved\": \"https://registry.npmjs.org/cluster-key-slot/-/cluster-key-slot-1.1.2.tgz\",\n@@ -5835,7 +6032,7 @@\n       \"version\": \"3.1.3\",\n       \"resolved\": \"https://registry.npmjs.org/csstype/-/csstype-3.1.3.tgz\",\n       \"integrity\": \"sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw==\",\n-      \"dev\": true,\n+      \"devOptional\": true,\n       \"license\": \"MIT\"\n     },\n     \"node_modules/dax-sh\": {\n@@ -5980,6 +6177,15 @@\n         \"node\": \">= 0.8\"\n       }\n     },\n+    \"node_modules/dequal\": {\n+      \"version\": \"2.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/dequal/-/dequal-2.0.3.tgz\",\n+      \"integrity\": \"sha512-0je+qPKHEMohvfRTCEo3CrPG6cAzAYgmzKyxRiYSSDkS6eGJdyVJm7WaYA5ECaAD9wLB2T4EEeymA5aFVcYXCA==\",\n+      \"license\": \"MIT\",\n+      \"engines\": {\n+        \"node\": \">=6\"\n+      }\n+    },\n     \"node_modules/destr\": {\n       \"version\": \"2.0.3\",\n       \"resolved\": \"https://registry.npmjs.org/destr/-/destr-2.0.3.tgz\",\n@@ -8036,6 +8242,18 @@\n       \"integrity\": \"sha512-mNAgZ1GmyNhD7AuqnTG3/VQ26o760+ZYBPKjPvugO8+nLbYfX6TVpJPseBvopbdY+qpZ/lKUnmEc1LeZYS3QAA==\",\n       \"license\": \"Apache-2.0\"\n     },\n+    \"node_modules/loose-envify\": {\n+      \"version\": \"1.4.0\",\n+      \"resolved\": \"https://registry.npmjs.org/loose-envify/-/loose-envify-1.4.0.tgz\",\n+      \"integrity\": \"sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==\",\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"js-tokens\": \"^3.0.0 || ^4.0.0\"\n+      },\n+      \"bin\": {\n+        \"loose-envify\": \"cli.js\"\n+      }\n+    },\n     \"node_modules/lru-cache\": {\n       \"version\": \"5.1.1\",\n       \"resolved\": \"https://registry.npmjs.org/lru-cache/-/lru-cache-5.1.1.tgz\",\n@@ -8065,6 +8283,24 @@\n         \"source-map-js\": \"^1.2.0\"\n       }\n     },\n+    \"node_modules/make-cancellable-promise\": {\n+      \"version\": \"2.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/make-cancellable-promise/-/make-cancellable-promise-2.0.0.tgz\",\n+      \"integrity\": \"sha512-3SEQqTpV9oqVsIWqAcmDuaNeo7yBO3tqPtqGRcKkEo0lrzD3wqbKG9mkxO65KoOgXqj+zH2phJ2LiAsdzlogSw==\",\n+      \"license\": \"MIT\",\n+      \"funding\": {\n+        \"url\": \"https://github.com/wojtekmaj/make-cancellable-promise?sponsor=1\"\n+      }\n+    },\n+    \"node_modules/make-event-props\": {\n+      \"version\": \"2.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/make-event-props/-/make-event-props-2.0.0.tgz\",\n+      \"integrity\": \"sha512-G/hncXrl4Qt7mauJEXSg3AcdYzmpkIITTNl5I+rH9sog5Yw0kK6vseJjCaPfOXqOqQuPUP89Rkhfz5kPS8ijtw==\",\n+      \"license\": \"MIT\",\n+      \"funding\": {\n+        \"url\": \"https://github.com/wojtekmaj/make-event-props?sponsor=1\"\n+      }\n+    },\n     \"node_modules/math-intrinsics\": {\n       \"version\": \"1.1.0\",\n       \"resolved\": \"https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz\",\n@@ -8074,6 +8310,23 @@\n         \"node\": \">= 0.4\"\n       }\n     },\n+    \"node_modules/merge-refs\": {\n+      \"version\": \"2.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/merge-refs/-/merge-refs-2.0.0.tgz\",\n+      \"integrity\": \"sha512-3+B21mYK2IqUWnd2EivABLT7ueDhb0b8/dGK8LoFQPrU61YITeCMn14F7y7qZafWNZhUEKb24cJdiT5Wxs3prg==\",\n+      \"license\": \"MIT\",\n+      \"funding\": {\n+        \"url\": \"https://github.com/wojtekmaj/merge-refs?sponsor=1\"\n+      },\n+      \"peerDependencies\": {\n+        \"@types/react\": \"^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\"\n+      },\n+      \"peerDependenciesMeta\": {\n+        \"@types/react\": {\n+          \"optional\": true\n+        }\n+      }\n+    },\n     \"node_modules/merge-stream\": {\n       \"version\": \"2.0.0\",\n       \"resolved\": \"https://registry.npmjs.org/merge-stream/-/merge-stream-2.0.0.tgz\",\n@@ -8963,6 +9216,18 @@\n         \"ms\": \"^2.1.1\"\n       }\n     },\n+    \"node_modules/pdfjs-dist\": {\n+      \"version\": \"5.4.394\",\n+      \"resolved\": \"https://registry.npmjs.org/pdfjs-dist/-/pdfjs-dist-5.4.394.tgz\",\n+      \"integrity\": \"sha512-9ariAYGqUJzx+V/1W4jHyiyCep6IZALmDzoaTLZ6VNu8q9LWi1/ukhzHgE2Xsx96AZi0mbZuK4/ttIbqSbLypg==\",\n+      \"license\": \"Apache-2.0\",\n+      \"engines\": {\n+        \"node\": \">=20.16.0 || >=22.3.0\"\n+      },\n+      \"optionalDependencies\": {\n+        \"@napi-rs/canvas\": \"^0.1.81\"\n+      }\n+    },\n     \"node_modules/peek-readable\": {\n       \"version\": \"4.1.0\",\n       \"resolved\": \"https://registry.npmjs.org/peek-readable/-/peek-readable-4.1.0.tgz\",\n@@ -9287,6 +9552,47 @@\n         \"react\": \"^19.0.0\"\n       }\n     },\n+    \"node_modules/react-pdf\": {\n+      \"version\": \"10.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/react-pdf/-/react-pdf-10.2.0.tgz\",\n+      \"integrity\": \"sha512-zk0DIL31oCh8cuQycM0SJKfwh4Onz0/Nwi6wTOjgtEjWGUY6eM+/vuzvOP3j70qtEULn7m1JtaeGzud1w5fY2Q==\",\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"clsx\": \"^2.0.0\",\n+        \"dequal\": \"^2.0.3\",\n+        \"make-cancellable-promise\": \"^2.0.0\",\n+        \"make-event-props\": \"^2.0.0\",\n+        \"merge-refs\": \"^2.0.0\",\n+        \"pdfjs-dist\": \"5.4.296\",\n+        \"tiny-invariant\": \"^1.0.0\",\n+        \"warning\": \"^4.0.0\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://github.com/wojtekmaj/react-pdf?sponsor=1\"\n+      },\n+      \"peerDependencies\": {\n+        \"@types/react\": \"^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\",\n+        \"react\": \"^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\",\n+        \"react-dom\": \"^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\"\n+      },\n+      \"peerDependenciesMeta\": {\n+        \"@types/react\": {\n+          \"optional\": true\n+        }\n+      }\n+    },\n+    \"node_modules/react-pdf/node_modules/pdfjs-dist\": {\n+      \"version\": \"5.4.296\",\n+      \"resolved\": \"https://registry.npmjs.org/pdfjs-dist/-/pdfjs-dist-5.4.296.tgz\",\n+      \"integrity\": \"sha512-DlOzet0HO7OEnmUmB6wWGJrrdvbyJKftI1bhMitK7O2N8W2gc757yyYBbINy9IDafXAV9wmKr9t7xsTaNKRG5Q==\",\n+      \"license\": \"Apache-2.0\",\n+      \"engines\": {\n+        \"node\": \">=20.16.0 || >=22.3.0\"\n+      },\n+      \"optionalDependencies\": {\n+        \"@napi-rs/canvas\": \"^0.1.80\"\n+      }\n+    },\n     \"node_modules/react-refresh\": {\n       \"version\": \"0.14.2\",\n       \"resolved\": \"https://registry.npmjs.org/react-refresh/-/react-refresh-0.14.2.tgz\",\n@@ -11414,6 +11720,15 @@\n         }\n       }\n     },\n+    \"node_modules/warning\": {\n+      \"version\": \"4.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/warning/-/warning-4.0.3.tgz\",\n+      \"integrity\": \"sha512-rpJyN222KWIvHJ/F53XSZv0Zl/accqHR8et1kpaMTD/fLCRxtV8iX8czMzY7sVZupTI3zcUTg8eycS2kNF9l6w==\",\n+      \"license\": \"MIT\",\n+      \"dependencies\": {\n+        \"loose-envify\": \"^1.0.0\"\n+      }\n+    },\n     \"node_modules/weaviate-client\": {\n       \"version\": \"3.5.5\",\n       \"resolved\": \"https://registry.npmjs.org/weaviate-client/-/weaviate-client-3.5.5.tgz\",",
      "patch_lines": [
        "@@ -7,6 +7,7 @@\n",
        "     \"\": {\n",
        "       \"name\": \"medabot\",\n",
        "       \"version\": \"1.0.0\",\n",
        "+      \"hasInstallScript\": true,\n",
        "       \"license\": \"ISC\",\n",
        "       \"dependencies\": {\n",
        "         \"@langchain/community\": \"^0.3.44\",\n",
        "@@ -17,9 +18,11 @@\n",
        "         \"langchain\": \"^0.3.27\",\n",
        "         \"openai\": \"^4.87.3\",\n",
        "         \"pdf-parse\": \"^1.1.1\",\n",
        "+        \"pdfjs-dist\": \"^5.4.394\",\n",
        "         \"playwright\": \"^1.51.0\",\n",
        "         \"react\": \"^19.0.0\",\n",
        "         \"react-dom\": \"^19.0.0\",\n",
        "+        \"react-pdf\": \"^10.2.0\",\n",
        "         \"react-webcam\": \"^7.2.0\",\n",
        "         \"tailwindcss\": \"^4.0.14\",\n",
        "         \"vinxi\": \"^0.5.3\",\n",
        "@@ -1720,6 +1723,191 @@\n",
        "         \"node\": \">=10\"\n",
        "       }\n",
        "     },\n",
        "+    \"node_modules/@napi-rs/canvas\": {\n",
        "+      \"version\": \"0.1.81\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas/-/canvas-0.1.81.tgz\",\n",
        "+      \"integrity\": \"sha512-ReCjd5SYI/UKx/olaQLC4GtN6wUQGjlgHXs1lvUvWGXfBMR3Fxnik3cL+OxKN5ithNdoU0/GlCrdKcQDFh2XKQ==\",\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"optional\": true,\n",
        "+      \"workspaces\": [\n",
        "+        \"e2e/*\"\n",
        "+      ],\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">= 10\"\n",
        "+      },\n",
        "+      \"optionalDependencies\": {\n",
        "+        \"@napi-rs/canvas-android-arm64\": \"0.1.81\",\n",
        "+        \"@napi-rs/canvas-darwin-arm64\": \"0.1.81\",\n",
        "+        \"@napi-rs/canvas-darwin-x64\": \"0.1.81\",\n",
        "+        \"@napi-rs/canvas-linux-arm-gnueabihf\": \"0.1.81\",\n",
        "+        \"@napi-rs/canvas-linux-arm64-gnu\": \"0.1.81\",\n",
        "+        \"@napi-rs/canvas-linux-arm64-musl\": \"0.1.81\",\n",
        "+        \"@napi-rs/canvas-linux-riscv64-gnu\": \"0.1.81\",\n",
        "+        \"@napi-rs/canvas-linux-x64-gnu\": \"0.1.81\",\n",
        "+        \"@napi-rs/canvas-linux-x64-musl\": \"0.1.81\",\n",
        "+        \"@napi-rs/canvas-win32-x64-msvc\": \"0.1.81\"\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/@napi-rs/canvas-android-arm64\": {\n",
        "+      \"version\": \"0.1.81\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-android-arm64/-/canvas-android-arm64-0.1.81.tgz\",\n",
        "+      \"integrity\": \"sha512-78Lz+AUi+MsWupyZjXwpwQrp1QCwncPvRZrdvrROcZ9Gq9grP7LfQZiGdR8LKyHIq3OR18mDP+JESGT15V1nXw==\",\n",
        "+      \"cpu\": [\n",
        "+        \"arm64\"\n",
        "+      ],\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"optional\": true,\n",
        "+      \"os\": [\n",
        "+        \"android\"\n",
        "+      ],\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">= 10\"\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/@napi-rs/canvas-darwin-arm64\": {\n",
        "+      \"version\": \"0.1.81\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-darwin-arm64/-/canvas-darwin-arm64-0.1.81.tgz\",\n",
        "+      \"integrity\": \"sha512-omejuKgHWKDGoh8rsgsyhm/whwxMaryTQjJTd9zD7hiB9/rzcEEJLHnzXWR5ysy4/tTjHaQotE6k2t8eodTLnA==\",\n",
        "+      \"cpu\": [\n",
        "+        \"arm64\"\n",
        "+      ],\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"optional\": true,\n",
        "+      \"os\": [\n",
        "+        \"darwin\"\n",
        "+      ],\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">= 10\"\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/@napi-rs/canvas-darwin-x64\": {\n",
        "+      \"version\": \"0.1.81\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-darwin-x64/-/canvas-darwin-x64-0.1.81.tgz\",\n",
        "+      \"integrity\": \"sha512-EYfk+co6BElq5DXNH9PBLYDYwc4QsvIVbyrsVHsxVpn4p6Y3/s8MChgC69AGqj3vzZBQ1qx2CRCMtg5cub+XuQ==\",\n",
        "+      \"cpu\": [\n",
        "+        \"x64\"\n",
        "+      ],\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"optional\": true,\n",
        "+      \"os\": [\n",
        "+        \"darwin\"\n",
        "+      ],\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">= 10\"\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/@napi-rs/canvas-linux-arm-gnueabihf\": {\n",
        "+      \"version\": \"0.1.81\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-arm-gnueabihf/-/canvas-linux-arm-gnueabihf-0.1.81.tgz\",\n",
        "+      \"integrity\": \"sha512-teh6Q74CyAcH31yLNQGR9MtXSFxlZa5CI6vvNUISI14gWIJWrhOwUAOly+KRe1aztWR0FWTVSPxM4p5y+06aow==\",\n",
        "+      \"cpu\": [\n",
        "+        \"arm\"\n",
        "+      ],\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"optional\": true,\n",
        "+      \"os\": [\n",
        "+        \"linux\"\n",
        "+      ],\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">= 10\"\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/@napi-rs/canvas-linux-arm64-gnu\": {\n",
        "+      \"version\": \"0.1.81\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-arm64-gnu/-/canvas-linux-arm64-gnu-0.1.81.tgz\",\n",
        "+      \"integrity\": \"sha512-AGEopHFYRzJOjxY+2G1RmHPRnuWvO3Qdhq7sIazlSjxb3Z6dZHg7OB/4ZimXaimPjDACm9qWa6t5bn9bhXvkcw==\",\n",
        "+      \"cpu\": [\n",
        "+        \"arm64\"\n",
        "+      ],\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"optional\": true,\n",
        "+      \"os\": [\n",
        "+        \"linux\"\n",
        "+      ],\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">= 10\"\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/@napi-rs/canvas-linux-arm64-musl\": {\n",
        "+      \"version\": \"0.1.81\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-arm64-musl/-/canvas-linux-arm64-musl-0.1.81.tgz\",\n",
        "+      \"integrity\": \"sha512-Bj3m1cl4GIhsigkdwOxii4g4Ump3/QhNpx85IgAlCCYXpaly6mcsWpuDYEabfIGWOWhDUNBOndaQUPfWK1czOQ==\",\n",
        "+      \"cpu\": [\n",
        "+        \"arm64\"\n",
        "+      ],\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"optional\": true,\n",
        "+      \"os\": [\n",
        "+        \"linux\"\n",
        "+      ],\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">= 10\"\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/@napi-rs/canvas-linux-riscv64-gnu\": {\n",
        "+      \"version\": \"0.1.81\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-riscv64-gnu/-/canvas-linux-riscv64-gnu-0.1.81.tgz\",\n",
        "+      \"integrity\": \"sha512-yg/5NkHykVdwPlD3XObwCa/EswkOwLHswJcI9rHrac+znHsmCSj5AMX/RTU9Z9F6lZTwL60JM2Esit33XhAMiw==\",\n",
        "+      \"cpu\": [\n",
        "+        \"riscv64\"\n",
        "+      ],\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"optional\": true,\n",
        "+      \"os\": [\n",
        "+        \"linux\"\n",
        "+      ],\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">= 10\"\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/@napi-rs/canvas-linux-x64-gnu\": {\n",
        "+      \"version\": \"0.1.81\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-x64-gnu/-/canvas-linux-x64-gnu-0.1.81.tgz\",\n",
        "+      \"integrity\": \"sha512-tPfMpSEBuV5dJSKexO/UZxpOqnYTaNbG8aKa1ek8QsWu+4SJ/foWkaxscra/RUv85vepx6WWDjzBNbNJsTnO0w==\",\n",
        "+      \"cpu\": [\n",
        "+        \"x64\"\n",
        "+      ],\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"optional\": true,\n",
        "+      \"os\": [\n",
        "+        \"linux\"\n",
        "+      ],\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">= 10\"\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/@napi-rs/canvas-linux-x64-musl\": {\n",
        "+      \"version\": \"0.1.81\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-linux-x64-musl/-/canvas-linux-x64-musl-0.1.81.tgz\",\n",
        "+      \"integrity\": \"sha512-1L0xnYgzqn8Baef+inPvY4dKqdmw3KCBoe0NEDgezuBZN7MA5xElwifoG8609uNdrMtJ9J6QZarsslLRVqri7g==\",\n",
        "+      \"cpu\": [\n",
        "+        \"x64\"\n",
        "+      ],\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"optional\": true,\n",
        "+      \"os\": [\n",
        "+        \"linux\"\n",
        "+      ],\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">= 10\"\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/@napi-rs/canvas-win32-x64-msvc\": {\n",
        "+      \"version\": \"0.1.81\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/@napi-rs/canvas-win32-x64-msvc/-/canvas-win32-x64-msvc-0.1.81.tgz\",\n",
        "+      \"integrity\": \"sha512-57ryVbhm/z7RE9/UVcS7mrLPdlayLesy+9U0Uf6epCoeSGrs99tfieCcgZWFbIgmByQ1AZnNtFI2N6huqDLlWQ==\",\n",
        "+      \"cpu\": [\n",
        "+        \"x64\"\n",
        "+      ],\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"optional\": true,\n",
        "+      \"os\": [\n",
        "+        \"win32\"\n",
        "+      ],\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">= 10\"\n",
        "+      }\n",
        "+    },\n",
        "     \"node_modules/@netlify/functions\": {\n",
        "       \"version\": \"3.0.0\",\n",
        "       \"resolved\": \"https://registry.npmjs.org/@netlify/functions/-/functions-3.0.0.tgz\",\n",
        "@@ -4727,7 +4915,7 @@\n",
        "       \"version\": \"19.0.10\",\n",
        "       \"resolved\": \"https://registry.npmjs.org/@types/react/-/react-19.0.10.tgz\",\n",
        "       \"integrity\": \"sha512-JuRQ9KXLEjaUNjTWpzuR231Z2WpIwczOkBEIvbHNCzQefFIT0L8IqE6NV6ULLyC1SI/i234JnDoMkfg+RjQj2g==\",\n",
        "-      \"dev\": true,\n",
        "+      \"devOptional\": true,\n",
        "       \"license\": \"MIT\",\n",
        "       \"dependencies\": {\n",
        "         \"csstype\": \"^3.0.2\"\n",
        "@@ -5635,6 +5823,15 @@\n",
        "         \"url\": \"https://github.com/chalk/wrap-ansi?sponsor=1\"\n",
        "       }\n",
        "     },\n",
        "+    \"node_modules/clsx\": {\n",
        "+      \"version\": \"2.1.1\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/clsx/-/clsx-2.1.1.tgz\",\n",
        "+      \"integrity\": \"sha512-eYm0QWBtUrBWZWG0d386OGAw16Z995PiOVo2B7bjWSbHedGl5e0ZWaq65kOGgUSNesEIDkB9ISbTg/JK9dhCZA==\",\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">=6\"\n",
        "+      }\n",
        "+    },\n",
        "     \"node_modules/cluster-key-slot\": {\n",
        "       \"version\": \"1.1.2\",\n",
        "       \"resolved\": \"https://registry.npmjs.org/cluster-key-slot/-/cluster-key-slot-1.1.2.tgz\",\n",
        "@@ -5835,7 +6032,7 @@\n",
        "       \"version\": \"3.1.3\",\n",
        "       \"resolved\": \"https://registry.npmjs.org/csstype/-/csstype-3.1.3.tgz\",\n",
        "       \"integrity\": \"sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw==\",\n",
        "-      \"dev\": true,\n",
        "+      \"devOptional\": true,\n",
        "       \"license\": \"MIT\"\n",
        "     },\n",
        "     \"node_modules/dax-sh\": {\n",
        "@@ -5980,6 +6177,15 @@\n",
        "         \"node\": \">= 0.8\"\n",
        "       }\n",
        "     },\n",
        "+    \"node_modules/dequal\": {\n",
        "+      \"version\": \"2.0.3\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/dequal/-/dequal-2.0.3.tgz\",\n",
        "+      \"integrity\": \"sha512-0je+qPKHEMohvfRTCEo3CrPG6cAzAYgmzKyxRiYSSDkS6eGJdyVJm7WaYA5ECaAD9wLB2T4EEeymA5aFVcYXCA==\",\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">=6\"\n",
        "+      }\n",
        "+    },\n",
        "     \"node_modules/destr\": {\n",
        "       \"version\": \"2.0.3\",\n",
        "       \"resolved\": \"https://registry.npmjs.org/destr/-/destr-2.0.3.tgz\",\n",
        "@@ -8036,6 +8242,18 @@\n",
        "       \"integrity\": \"sha512-mNAgZ1GmyNhD7AuqnTG3/VQ26o760+ZYBPKjPvugO8+nLbYfX6TVpJPseBvopbdY+qpZ/lKUnmEc1LeZYS3QAA==\",\n",
        "       \"license\": \"Apache-2.0\"\n",
        "     },\n",
        "+    \"node_modules/loose-envify\": {\n",
        "+      \"version\": \"1.4.0\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/loose-envify/-/loose-envify-1.4.0.tgz\",\n",
        "+      \"integrity\": \"sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==\",\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"dependencies\": {\n",
        "+        \"js-tokens\": \"^3.0.0 || ^4.0.0\"\n",
        "+      },\n",
        "+      \"bin\": {\n",
        "+        \"loose-envify\": \"cli.js\"\n",
        "+      }\n",
        "+    },\n",
        "     \"node_modules/lru-cache\": {\n",
        "       \"version\": \"5.1.1\",\n",
        "       \"resolved\": \"https://registry.npmjs.org/lru-cache/-/lru-cache-5.1.1.tgz\",\n",
        "@@ -8065,6 +8283,24 @@\n",
        "         \"source-map-js\": \"^1.2.0\"\n",
        "       }\n",
        "     },\n",
        "+    \"node_modules/make-cancellable-promise\": {\n",
        "+      \"version\": \"2.0.0\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/make-cancellable-promise/-/make-cancellable-promise-2.0.0.tgz\",\n",
        "+      \"integrity\": \"sha512-3SEQqTpV9oqVsIWqAcmDuaNeo7yBO3tqPtqGRcKkEo0lrzD3wqbKG9mkxO65KoOgXqj+zH2phJ2LiAsdzlogSw==\",\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"funding\": {\n",
        "+        \"url\": \"https://github.com/wojtekmaj/make-cancellable-promise?sponsor=1\"\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/make-event-props\": {\n",
        "+      \"version\": \"2.0.0\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/make-event-props/-/make-event-props-2.0.0.tgz\",\n",
        "+      \"integrity\": \"sha512-G/hncXrl4Qt7mauJEXSg3AcdYzmpkIITTNl5I+rH9sog5Yw0kK6vseJjCaPfOXqOqQuPUP89Rkhfz5kPS8ijtw==\",\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"funding\": {\n",
        "+        \"url\": \"https://github.com/wojtekmaj/make-event-props?sponsor=1\"\n",
        "+      }\n",
        "+    },\n",
        "     \"node_modules/math-intrinsics\": {\n",
        "       \"version\": \"1.1.0\",\n",
        "       \"resolved\": \"https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz\",\n",
        "@@ -8074,6 +8310,23 @@\n",
        "         \"node\": \">= 0.4\"\n",
        "       }\n",
        "     },\n",
        "+    \"node_modules/merge-refs\": {\n",
        "+      \"version\": \"2.0.0\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/merge-refs/-/merge-refs-2.0.0.tgz\",\n",
        "+      \"integrity\": \"sha512-3+B21mYK2IqUWnd2EivABLT7ueDhb0b8/dGK8LoFQPrU61YITeCMn14F7y7qZafWNZhUEKb24cJdiT5Wxs3prg==\",\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"funding\": {\n",
        "+        \"url\": \"https://github.com/wojtekmaj/merge-refs?sponsor=1\"\n",
        "+      },\n",
        "+      \"peerDependencies\": {\n",
        "+        \"@types/react\": \"^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\"\n",
        "+      },\n",
        "+      \"peerDependenciesMeta\": {\n",
        "+        \"@types/react\": {\n",
        "+          \"optional\": true\n",
        "+        }\n",
        "+      }\n",
        "+    },\n",
        "     \"node_modules/merge-stream\": {\n",
        "       \"version\": \"2.0.0\",\n",
        "       \"resolved\": \"https://registry.npmjs.org/merge-stream/-/merge-stream-2.0.0.tgz\",\n",
        "@@ -8963,6 +9216,18 @@\n",
        "         \"ms\": \"^2.1.1\"\n",
        "       }\n",
        "     },\n",
        "+    \"node_modules/pdfjs-dist\": {\n",
        "+      \"version\": \"5.4.394\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/pdfjs-dist/-/pdfjs-dist-5.4.394.tgz\",\n",
        "+      \"integrity\": \"sha512-9ariAYGqUJzx+V/1W4jHyiyCep6IZALmDzoaTLZ6VNu8q9LWi1/ukhzHgE2Xsx96AZi0mbZuK4/ttIbqSbLypg==\",\n",
        "+      \"license\": \"Apache-2.0\",\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">=20.16.0 || >=22.3.0\"\n",
        "+      },\n",
        "+      \"optionalDependencies\": {\n",
        "+        \"@napi-rs/canvas\": \"^0.1.81\"\n",
        "+      }\n",
        "+    },\n",
        "     \"node_modules/peek-readable\": {\n",
        "       \"version\": \"4.1.0\",\n",
        "       \"resolved\": \"https://registry.npmjs.org/peek-readable/-/peek-readable-4.1.0.tgz\",\n",
        "@@ -9287,6 +9552,47 @@\n",
        "         \"react\": \"^19.0.0\"\n",
        "       }\n",
        "     },\n",
        "+    \"node_modules/react-pdf\": {\n",
        "+      \"version\": \"10.2.0\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/react-pdf/-/react-pdf-10.2.0.tgz\",\n",
        "+      \"integrity\": \"sha512-zk0DIL31oCh8cuQycM0SJKfwh4Onz0/Nwi6wTOjgtEjWGUY6eM+/vuzvOP3j70qtEULn7m1JtaeGzud1w5fY2Q==\",\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"dependencies\": {\n",
        "+        \"clsx\": \"^2.0.0\",\n",
        "+        \"dequal\": \"^2.0.3\",\n",
        "+        \"make-cancellable-promise\": \"^2.0.0\",\n",
        "+        \"make-event-props\": \"^2.0.0\",\n",
        "+        \"merge-refs\": \"^2.0.0\",\n",
        "+        \"pdfjs-dist\": \"5.4.296\",\n",
        "+        \"tiny-invariant\": \"^1.0.0\",\n",
        "+        \"warning\": \"^4.0.0\"\n",
        "+      },\n",
        "+      \"funding\": {\n",
        "+        \"url\": \"https://github.com/wojtekmaj/react-pdf?sponsor=1\"\n",
        "+      },\n",
        "+      \"peerDependencies\": {\n",
        "+        \"@types/react\": \"^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\",\n",
        "+        \"react\": \"^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\",\n",
        "+        \"react-dom\": \"^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\"\n",
        "+      },\n",
        "+      \"peerDependenciesMeta\": {\n",
        "+        \"@types/react\": {\n",
        "+          \"optional\": true\n",
        "+        }\n",
        "+      }\n",
        "+    },\n",
        "+    \"node_modules/react-pdf/node_modules/pdfjs-dist\": {\n",
        "+      \"version\": \"5.4.296\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/pdfjs-dist/-/pdfjs-dist-5.4.296.tgz\",\n",
        "+      \"integrity\": \"sha512-DlOzet0HO7OEnmUmB6wWGJrrdvbyJKftI1bhMitK7O2N8W2gc757yyYBbINy9IDafXAV9wmKr9t7xsTaNKRG5Q==\",\n",
        "+      \"license\": \"Apache-2.0\",\n",
        "+      \"engines\": {\n",
        "+        \"node\": \">=20.16.0 || >=22.3.0\"\n",
        "+      },\n",
        "+      \"optionalDependencies\": {\n",
        "+        \"@napi-rs/canvas\": \"^0.1.80\"\n",
        "+      }\n",
        "+    },\n",
        "     \"node_modules/react-refresh\": {\n",
        "       \"version\": \"0.14.2\",\n",
        "       \"resolved\": \"https://registry.npmjs.org/react-refresh/-/react-refresh-0.14.2.tgz\",\n",
        "@@ -11414,6 +11720,15 @@\n",
        "         }\n",
        "       }\n",
        "     },\n",
        "+    \"node_modules/warning\": {\n",
        "+      \"version\": \"4.0.3\",\n",
        "+      \"resolved\": \"https://registry.npmjs.org/warning/-/warning-4.0.3.tgz\",\n",
        "+      \"integrity\": \"sha512-rpJyN222KWIvHJ/F53XSZv0Zl/accqHR8et1kpaMTD/fLCRxtV8iX8czMzY7sVZupTI3zcUTg8eycS2kNF9l6w==\",\n",
        "+      \"license\": \"MIT\",\n",
        "+      \"dependencies\": {\n",
        "+        \"loose-envify\": \"^1.0.0\"\n",
        "+      }\n",
        "+    },\n",
        "     \"node_modules/weaviate-client\": {\n",
        "       \"version\": \"3.5.5\",\n",
        "       \"resolved\": \"https://registry.npmjs.org/weaviate-client/-/weaviate-client-3.5.5.tgz\",\n"
      ]
    },
    {
      "path": "package.json",
      "status": "modified",
      "additions": 6,
      "deletions": 2,
      "patch": "@@ -9,8 +9,10 @@\n   \"type\": \"module\",\n   \"scripts\": {\n     \"dev\": \"vinxi dev\",\n-    \"build\": \"vinxi build\",\n-    \"start\": \"vinxi start\"\n+    \"build\": \"npm run copy-pdf-worker && vinxi build\",\n+    \"start\": \"vinxi start\",\n+    \"copy-pdf-worker\": \"node scripts/copy-pdf-worker.js\",\n+    \"postinstall\": \"npm run copy-pdf-worker\"\n   },\n   \"dependencies\": {\n     \"@langchain/community\": \"^0.3.44\",\n@@ -21,9 +23,11 @@\n     \"langchain\": \"^0.3.27\",\n     \"openai\": \"^4.87.3\",\n     \"pdf-parse\": \"^1.1.1\",\n+    \"pdfjs-dist\": \"^5.4.394\",\n     \"playwright\": \"^1.51.0\",\n     \"react\": \"^19.0.0\",\n     \"react-dom\": \"^19.0.0\",\n+    \"react-pdf\": \"^10.2.0\",\n     \"react-webcam\": \"^7.2.0\",\n     \"tailwindcss\": \"^4.0.14\",\n     \"vinxi\": \"^0.5.3\",",
      "patch_lines": [
        "@@ -9,8 +9,10 @@\n",
        "   \"type\": \"module\",\n",
        "   \"scripts\": {\n",
        "     \"dev\": \"vinxi dev\",\n",
        "-    \"build\": \"vinxi build\",\n",
        "-    \"start\": \"vinxi start\"\n",
        "+    \"build\": \"npm run copy-pdf-worker && vinxi build\",\n",
        "+    \"start\": \"vinxi start\",\n",
        "+    \"copy-pdf-worker\": \"node scripts/copy-pdf-worker.js\",\n",
        "+    \"postinstall\": \"npm run copy-pdf-worker\"\n",
        "   },\n",
        "   \"dependencies\": {\n",
        "     \"@langchain/community\": \"^0.3.44\",\n",
        "@@ -21,9 +23,11 @@\n",
        "     \"langchain\": \"^0.3.27\",\n",
        "     \"openai\": \"^4.87.3\",\n",
        "     \"pdf-parse\": \"^1.1.1\",\n",
        "+    \"pdfjs-dist\": \"^5.4.394\",\n",
        "     \"playwright\": \"^1.51.0\",\n",
        "     \"react\": \"^19.0.0\",\n",
        "     \"react-dom\": \"^19.0.0\",\n",
        "+    \"react-pdf\": \"^10.2.0\",\n",
        "     \"react-webcam\": \"^7.2.0\",\n",
        "     \"tailwindcss\": \"^4.0.14\",\n",
        "     \"vinxi\": \"^0.5.3\",\n"
      ]
    },
    {
      "path": "scripts/copy-pdf-worker.js",
      "status": "added",
      "additions": 43,
      "deletions": 0,
      "patch": "@@ -0,0 +1,43 @@\n+#!/usr/bin/env node\n+\n+/**\n+ * Copy PDF.js worker file to public directory\n+ * This ensures the worker is available locally instead of loading from CDN\n+ */\n+\n+import { copyFileSync, existsSync, mkdirSync } from 'fs';\n+import { dirname, join } from 'path';\n+import { fileURLToPath } from 'url';\n+\n+const __filename = fileURLToPath(import.meta.url);\n+const __dirname = dirname(__filename);\n+\n+const projectRoot = join(__dirname, '..');\n+// Copy from react-pdf's bundled pdfjs-dist instead of top-level\n+const workerSource = join(projectRoot, 'node_modules/react-pdf/node_modules/pdfjs-dist/build/pdf.worker.min.mjs');\n+const publicDir = join(projectRoot, 'public');\n+const workerDest = join(publicDir, 'pdf.worker.min.mjs');\n+\n+try {\n+  // Create public directory if it doesn't exist\n+  if (!existsSync(publicDir)) {\n+    mkdirSync(publicDir, { recursive: true });\n+    console.log('\u2713 Created public directory');\n+  }\n+\n+  // Check if source file exists\n+  if (!existsSync(workerSource)) {\n+    console.error('\u2717 PDF.js worker source file not found:', workerSource);\n+    console.error('  Make sure pdfjs-dist is installed: npm install pdfjs-dist');\n+    process.exit(1);\n+  }\n+\n+  // Copy the worker file\n+  copyFileSync(workerSource, workerDest);\n+  console.log('\u2713 Copied PDF.js worker to public/pdf.worker.min.mjs');\n+  console.log('  This ensures the worker loads locally instead of from CDN');\n+\n+} catch (error) {\n+  console.error('\u2717 Error copying PDF.js worker:', error.message);\n+  process.exit(1);\n+}",
      "patch_lines": [
        "@@ -0,0 +1,43 @@\n",
        "+#!/usr/bin/env node\n",
        "+\n",
        "+/**\n",
        "+ * Copy PDF.js worker file to public directory\n",
        "+ * This ensures the worker is available locally instead of loading from CDN\n",
        "+ */\n",
        "+\n",
        "+import { copyFileSync, existsSync, mkdirSync } from 'fs';\n",
        "+import { dirname, join } from 'path';\n",
        "+import { fileURLToPath } from 'url';\n",
        "+\n",
        "+const __filename = fileURLToPath(import.meta.url);\n",
        "+const __dirname = dirname(__filename);\n",
        "+\n",
        "+const projectRoot = join(__dirname, '..');\n",
        "+// Copy from react-pdf's bundled pdfjs-dist instead of top-level\n",
        "+const workerSource = join(projectRoot, 'node_modules/react-pdf/node_modules/pdfjs-dist/build/pdf.worker.min.mjs');\n",
        "+const publicDir = join(projectRoot, 'public');\n",
        "+const workerDest = join(publicDir, 'pdf.worker.min.mjs');\n",
        "+\n",
        "+try {\n",
        "+  // Create public directory if it doesn't exist\n",
        "+  if (!existsSync(publicDir)) {\n",
        "+    mkdirSync(publicDir, { recursive: true });\n",
        "+    console.log('\u2713 Created public directory');\n",
        "+  }\n",
        "+\n",
        "+  // Check if source file exists\n",
        "+  if (!existsSync(workerSource)) {\n",
        "+    console.error('\u2717 PDF.js worker source file not found:', workerSource);\n",
        "+    console.error('  Make sure pdfjs-dist is installed: npm install pdfjs-dist');\n",
        "+    process.exit(1);\n",
        "+  }\n",
        "+\n",
        "+  // Copy the worker file\n",
        "+  copyFileSync(workerSource, workerDest);\n",
        "+  console.log('\u2713 Copied PDF.js worker to public/pdf.worker.min.mjs');\n",
        "+  console.log('  This ensures the worker loads locally instead of from CDN');\n",
        "+\n",
        "+} catch (error) {\n",
        "+  console.error('\u2717 Error copying PDF.js worker:', error.message);\n",
        "+  process.exit(1);\n",
        "+}\n"
      ]
    }
  ]
}
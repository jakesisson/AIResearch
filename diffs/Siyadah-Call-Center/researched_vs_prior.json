{
  "project": "Research Data/Siyadah-Call-Center",
  "repo": "Mohamed-B-ak/Siyadah-Call-Center-AI-maatmd-fryq",
  "prior_commit": "4874dabad7212cc6e5d6f6b6fcbb002f008a5fc9",
  "researched_commit": "57f9fd5529a48d9d4a79ece65d082c0d0e87d192",
  "compare_url": "https://github.com/Mohamed-B-ak/Siyadah-Call-Center-AI-maatmd-fryq/compare/4874dabad7212cc6e5d6f6b6fcbb002f008a5fc9...57f9fd5529a48d9d4a79ece65d082c0d0e87d192",
  "ahead_by": 1,
  "behind_by": 0,
  "changed_files": [
    {
      "path": "server/langgraph-integration.ts",
      "status": "modified",
      "additions": 23,
      "deletions": 35,
      "patch": "@@ -32,21 +32,26 @@ export class LangGraphService {\n \n   async processConversation(request: LangGraphProcessRequest): Promise<LangGraphResponse> {\n     try {\n-      const response = await fetch(`${this.serviceUrl}/api/langgraph/process`, {\n-        method: 'POST',\n-        headers: {\n-          'Content-Type': 'application/json',\n-        },\n-        body: JSON.stringify(request),\n-      });\n-\n-      if (!response.ok) {\n-        throw new Error(`LangGraph service error: ${response.statusText}`);\n+      const result = await nativeLangGraph.processConversation(\n+        request.message,\n+        request.customer_id,\n+        request.thread_id,\n+        request.context\n+      );\n+      \n+      if (result.success) {\n+        return {\n+          success: true,\n+          data: result.data\n+        };\n+      } else {\n+        return {\n+          success: false,\n+          error: result.error\n+        };\n       }\n-\n-      return await response.json() as LangGraphResponse;\n     } catch (error: any) {\n-      console.error('LangGraph service error:', error);\n+      console.error('Native LangGraph error:', error);\n       return {\n         success: false,\n         error: error.message,\n@@ -56,12 +61,7 @@ export class LangGraphService {\n \n   async getWorkflowVisualization(workflowId?: string): Promise<any> {\n     try {\n-      const url = workflowId \n-        ? `${this.serviceUrl}/api/langgraph/workflow/visualization?workflow_id=${workflowId}`\n-        : `${this.serviceUrl}/api/langgraph/workflow/visualization`;\n-        \n-      const response = await fetch(url);\n-      return await response.json();\n+      return await nativeLangGraph.getWorkflowVisualization(workflowId);\n     } catch (error: any) {\n       console.error('Error fetching workflow visualization:', error);\n       return { success: false, error: error.message };\n@@ -70,14 +70,7 @@ export class LangGraphService {\n \n   async getAgentPerformance(agentId?: string, dateFrom?: string, dateTo?: string): Promise<any> {\n     try {\n-      const params = new URLSearchParams();\n-      if (agentId) params.append('agent_id', agentId);\n-      if (dateFrom) params.append('date_from', dateFrom);\n-      if (dateTo) params.append('date_to', dateTo);\n-      \n-      const url = `${this.serviceUrl}/api/langgraph/agents/performance${params.toString() ? '?' + params.toString() : ''}`;\n-      const response = await fetch(url);\n-      return await response.json();\n+      return await nativeLangGraph.getAgentPerformance(agentId, dateFrom, dateTo);\n     } catch (error: any) {\n       console.error('Error fetching agent performance:', error);\n       return { success: false, error: error.message };\n@@ -86,8 +79,7 @@ export class LangGraphService {\n \n   async getSystemStats(): Promise<any> {\n     try {\n-      const response = await fetch(`${this.serviceUrl}/api/langgraph/stats`);\n-      return await response.json();\n+      return await nativeLangGraph.getSystemStats();\n     } catch (error: any) {\n       console.error('Error fetching system stats:', error);\n       return { success: false, error: error.message };\n@@ -208,8 +200,7 @@ export function createLangGraphRouter(): Router {\n   router.get('/api/langgraph/workflow/states/:thread_id', async (req: Request, res: Response) => {\n     try {\n       const { thread_id } = req.params;\n-      const response = await fetch(`${LANGGRAPH_SERVICE_URL}/api/langgraph/workflow/states/${thread_id}`);\n-      const result = await response.json();\n+      const result = await nativeLangGraph.getWorkflowStates(thread_id);\n       res.json(result);\n     } catch (error: any) {\n       res.status(500).json({\n@@ -223,10 +214,7 @@ export function createLangGraphRouter(): Router {\n   router.post('/api/langgraph/workflow/reset/:thread_id', async (req: Request, res: Response) => {\n     try {\n       const { thread_id } = req.params;\n-      const response = await fetch(`${LANGGRAPH_SERVICE_URL}/api/langgraph/workflow/reset/${thread_id}`, {\n-        method: 'POST',\n-      });\n-      const result = await response.json();\n+      const result = await nativeLangGraph.resetWorkflow(thread_id);\n       res.json(result);\n     } catch (error: any) {\n       res.status(500).json({",
      "patch_lines": [
        "@@ -32,21 +32,26 @@ export class LangGraphService {\n",
        " \n",
        "   async processConversation(request: LangGraphProcessRequest): Promise<LangGraphResponse> {\n",
        "     try {\n",
        "-      const response = await fetch(`${this.serviceUrl}/api/langgraph/process`, {\n",
        "-        method: 'POST',\n",
        "-        headers: {\n",
        "-          'Content-Type': 'application/json',\n",
        "-        },\n",
        "-        body: JSON.stringify(request),\n",
        "-      });\n",
        "-\n",
        "-      if (!response.ok) {\n",
        "-        throw new Error(`LangGraph service error: ${response.statusText}`);\n",
        "+      const result = await nativeLangGraph.processConversation(\n",
        "+        request.message,\n",
        "+        request.customer_id,\n",
        "+        request.thread_id,\n",
        "+        request.context\n",
        "+      );\n",
        "+      \n",
        "+      if (result.success) {\n",
        "+        return {\n",
        "+          success: true,\n",
        "+          data: result.data\n",
        "+        };\n",
        "+      } else {\n",
        "+        return {\n",
        "+          success: false,\n",
        "+          error: result.error\n",
        "+        };\n",
        "       }\n",
        "-\n",
        "-      return await response.json() as LangGraphResponse;\n",
        "     } catch (error: any) {\n",
        "-      console.error('LangGraph service error:', error);\n",
        "+      console.error('Native LangGraph error:', error);\n",
        "       return {\n",
        "         success: false,\n",
        "         error: error.message,\n",
        "@@ -56,12 +61,7 @@ export class LangGraphService {\n",
        " \n",
        "   async getWorkflowVisualization(workflowId?: string): Promise<any> {\n",
        "     try {\n",
        "-      const url = workflowId \n",
        "-        ? `${this.serviceUrl}/api/langgraph/workflow/visualization?workflow_id=${workflowId}`\n",
        "-        : `${this.serviceUrl}/api/langgraph/workflow/visualization`;\n",
        "-        \n",
        "-      const response = await fetch(url);\n",
        "-      return await response.json();\n",
        "+      return await nativeLangGraph.getWorkflowVisualization(workflowId);\n",
        "     } catch (error: any) {\n",
        "       console.error('Error fetching workflow visualization:', error);\n",
        "       return { success: false, error: error.message };\n",
        "@@ -70,14 +70,7 @@ export class LangGraphService {\n",
        " \n",
        "   async getAgentPerformance(agentId?: string, dateFrom?: string, dateTo?: string): Promise<any> {\n",
        "     try {\n",
        "-      const params = new URLSearchParams();\n",
        "-      if (agentId) params.append('agent_id', agentId);\n",
        "-      if (dateFrom) params.append('date_from', dateFrom);\n",
        "-      if (dateTo) params.append('date_to', dateTo);\n",
        "-      \n",
        "-      const url = `${this.serviceUrl}/api/langgraph/agents/performance${params.toString() ? '?' + params.toString() : ''}`;\n",
        "-      const response = await fetch(url);\n",
        "-      return await response.json();\n",
        "+      return await nativeLangGraph.getAgentPerformance(agentId, dateFrom, dateTo);\n",
        "     } catch (error: any) {\n",
        "       console.error('Error fetching agent performance:', error);\n",
        "       return { success: false, error: error.message };\n",
        "@@ -86,8 +79,7 @@ export class LangGraphService {\n",
        " \n",
        "   async getSystemStats(): Promise<any> {\n",
        "     try {\n",
        "-      const response = await fetch(`${this.serviceUrl}/api/langgraph/stats`);\n",
        "-      return await response.json();\n",
        "+      return await nativeLangGraph.getSystemStats();\n",
        "     } catch (error: any) {\n",
        "       console.error('Error fetching system stats:', error);\n",
        "       return { success: false, error: error.message };\n",
        "@@ -208,8 +200,7 @@ export function createLangGraphRouter(): Router {\n",
        "   router.get('/api/langgraph/workflow/states/:thread_id', async (req: Request, res: Response) => {\n",
        "     try {\n",
        "       const { thread_id } = req.params;\n",
        "-      const response = await fetch(`${LANGGRAPH_SERVICE_URL}/api/langgraph/workflow/states/${thread_id}`);\n",
        "-      const result = await response.json();\n",
        "+      const result = await nativeLangGraph.getWorkflowStates(thread_id);\n",
        "       res.json(result);\n",
        "     } catch (error: any) {\n",
        "       res.status(500).json({\n",
        "@@ -223,10 +214,7 @@ export function createLangGraphRouter(): Router {\n",
        "   router.post('/api/langgraph/workflow/reset/:thread_id', async (req: Request, res: Response) => {\n",
        "     try {\n",
        "       const { thread_id } = req.params;\n",
        "-      const response = await fetch(`${LANGGRAPH_SERVICE_URL}/api/langgraph/workflow/reset/${thread_id}`, {\n",
        "-        method: 'POST',\n",
        "-      });\n",
        "-      const result = await response.json();\n",
        "+      const result = await nativeLangGraph.resetWorkflow(thread_id);\n",
        "       res.json(result);\n",
        "     } catch (error: any) {\n",
        "       res.status(500).json({\n"
      ]
    },
    {
      "path": "server/langgraph-native-integration.ts",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "patch": "@@ -198,7 +198,7 @@ class NativeLangGraphIntegration {\n   }\n \n   private getAgentName(agentId: string): string {\n-    const agentNames = {\n+    const agentNames: Record<string, string> = {\n       'support_responder': '\u0645\u0633\u062a\u062c\u064a\u0628 \u0627\u0644\u062f\u0639\u0645',\n       'ticket_creator': '\u0645\u0646\u0634\u0626 \u0627\u0644\u062a\u0630\u0627\u0643\u0631',\n       'feedback_collector': '\u062c\u0627\u0645\u0639 \u0627\u0644\u062a\u0639\u0644\u064a\u0642\u0627\u062a',\n@@ -258,7 +258,7 @@ class NativeLangGraphIntegration {\n    * Get agent performance metrics\n    */\n   async getAgentPerformance(agentId?: string, dateFrom?: string, dateTo?: string): Promise<ProcessResult> {\n-    const performanceData = {\n+    const performanceData: Record<string, any> = {\n       'support_responder': {\n         total_interactions: 450,\n         satisfaction_score: 4.7,",
      "patch_lines": [
        "@@ -198,7 +198,7 @@ class NativeLangGraphIntegration {\n",
        "   }\n",
        " \n",
        "   private getAgentName(agentId: string): string {\n",
        "-    const agentNames = {\n",
        "+    const agentNames: Record<string, string> = {\n",
        "       'support_responder': '\u0645\u0633\u062a\u062c\u064a\u0628 \u0627\u0644\u062f\u0639\u0645',\n",
        "       'ticket_creator': '\u0645\u0646\u0634\u0626 \u0627\u0644\u062a\u0630\u0627\u0643\u0631',\n",
        "       'feedback_collector': '\u062c\u0627\u0645\u0639 \u0627\u0644\u062a\u0639\u0644\u064a\u0642\u0627\u062a',\n",
        "@@ -258,7 +258,7 @@ class NativeLangGraphIntegration {\n",
        "    * Get agent performance metrics\n",
        "    */\n",
        "   async getAgentPerformance(agentId?: string, dateFrom?: string, dateTo?: string): Promise<ProcessResult> {\n",
        "-    const performanceData = {\n",
        "+    const performanceData: Record<string, any> = {\n",
        "       'support_responder': {\n",
        "         total_interactions: 450,\n",
        "         satisfaction_score: 4.7,\n"
      ]
    }
  ]
}